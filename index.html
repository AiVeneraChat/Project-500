<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Project 500 - Угадай число</title>
    <style>
        :root {
            --primary-color: #0f0;
            --secondary-color: #0a0;
            --background-color: #000;
            --container-bg: #111;
            --game-area-bg: #050505;
            --text-color: #0f0;
        }
        
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: 'Courier New', Courier, monospace;
            margin: 0;
            padding: 15px;
            background-color: var(--background-color);
            color: var(--text-color);
            image-rendering: pixelated;
            position: relative;
            overflow-x: hidden;
            min-height: 100vh;
            font-size: 16px;
            line-height: 1.4;
        }

        /* Стили для скроллбаров */
        ::-webkit-scrollbar {
            width: 12px;
            height: 12px;
        }

        ::-webkit-scrollbar-track {
            background: #051005;
            border: 1px solid var(--secondary-color);
            border-radius: 0;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--secondary-color);
            border: 1px solid var(--primary-color);
            border-radius: 0;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-color);
            box-shadow: 0 0 5px var(--primary-color);
        }

        ::-webkit-scrollbar-thumb:active {
            background: #0f0;
            box-shadow: 0 0 10px var(--primary-color);
        }

        ::-webkit-scrollbar-corner {
            background: var(--background-color);
            border: 1px solid var(--secondary-color);
        }

        /* Стили для скроллбара в истории */
        .history-list::-webkit-scrollbar {
            width: 8px;
        }

        .history-list::-webkit-scrollbar-track {
            background: #051005;
            border: 1px solid var(--secondary-color);
        }

        .history-list::-webkit-scrollbar-thumb {
            background: var(--secondary-color);
            border: 1px solid var(--primary-color);
        }

        .history-list::-webkit-scrollbar-thumb:hover {
            background: var(--primary-color);
        }

        /* Стили для скроллбара в магазине */
        .shop-popup::-webkit-scrollbar {
            width: 10px;
        }

        .shop-popup::-webkit-scrollbar-track {
            background: #111;
            border: 1px solid #fff;
        }

        .shop-popup::-webkit-scrollbar-thumb {
            background: #fff;
            border: 1px solid #0ff;
        }

        .shop-popup::-webkit-scrollbar-thumb:hover {
            background: #0ff;
            box-shadow: 0 0 5px #0ff;
        }

        /* Стили для скроллбара в инвентаре */
        .inventory-list::-webkit-scrollbar {
            width: 8px;
        }

        .inventory-list::-webkit-scrollbar-track {
            background: #051005;
            border: 1px solid var(--secondary-color);
        }

        .inventory-list::-webkit-scrollbar-thumb {
            background: var(--secondary-color);
            border: 1px solid var(--primary-color);
        }

        .inventory-list::-webkit-scrollbar-thumb:hover {
            background: var(--primary-color);
        }

        /* Стили для скроллбара в правилах (если понадобится) */
        .rules::-webkit-scrollbar {
            width: 6px;
        }

        .rules::-webkit-scrollbar-track {
            background: #051005;
        }

        .rules::-webkit-scrollbar-thumb {
            background: var(--secondary-color);
        }

        /* Стили для скроллбара в режиме паники */
        .panic-mode ::-webkit-scrollbar-track {
            background: #300 !important;
            border: 1px solid #f00 !important;
        }

        .panic-mode ::-webkit-scrollbar-thumb {
            background: #a00 !important;
            border: 1px solid #f00 !important;
        }

        .panic-mode ::-webkit-scrollbar-thumb:hover {
            background: #f00 !important;
            box-shadow: 0 0 5px #f00 !important;
        }

        /* Стили для скроллбара в режиме тревоги */
        .alarm-mode ::-webkit-scrollbar-track {
            background: #333300 !important;
            border: 1px solid #ff0 !important;
        }

        .alarm-mode ::-webkit-scrollbar-thumb {
            background: #aa0 !important;
            border: 1px solid #ff0 !important;
        }

        .alarm-mode ::-webkit-scrollbar-thumb:hover {
            background: #ff0 !important;
            box-shadow: 0 0 5px #ff0 !important;
        }

        /* Стили для Firefox */
        .history-list,
        .shop-popup,
        .inventory-list {
            scrollbar-width: thin;
            scrollbar-color: var(--secondary-color) #051005;
        }

        .panic-mode .history-list,
        .panic-mode .shop-popup,
        .panic-mode .inventory-list {
            scrollbar-color: #a00 #300;
        }

        .alarm-mode .history-list,
        .alarm-mode .shop-popup,
        .alarm-mode .inventory-list {
            scrollbar-color: #aa0 #333300;
        }

        /* Анимация появления скроллбара */
        .history-list::-webkit-scrollbar-thumb,
        .shop-popup::-webkit-scrollbar-thumb,
        .inventory-list::-webkit-scrollbar-thumb {
            transition: all 0.3s ease;
        }

        /* Стили для тонкого скроллбара на мобильных устройствах */
        @media (max-width: 768px) {
            ::-webkit-scrollbar {
                width: 6px;
                height: 6px;
            }
            
            .history-list::-webkit-scrollbar,
            .inventory-list::-webkit-scrollbar {
                width: 4px;
            }
        }

        /* Эффект свечения для активного скроллбара */
        .history-list:focus::-webkit-scrollbar-thumb,
        .shop-popup:focus::-webkit-scrollbar-thumb,
        .inventory-list:focus::-webkit-scrollbar-thumb {
            box-shadow: 0 0 8px var(--primary-color);
        }

        /* Плавная прокрутка для всех элементов с скроллом */
        .history-list,
        .shop-popup,
        .inventory-list,
        .rules {
            scroll-behavior: smooth;
        }

        /* Стили для скроллбара в body (если понадобится) */
        body::-webkit-scrollbar {
            width: 12px;
        }

        body::-webkit-scrollbar-track {
            background: var(--background-color);
            border-left: 1px solid var(--secondary-color);
        }

        body::-webkit-scrollbar-thumb {
            background: var(--secondary-color);
            border: 1px solid var(--primary-color);
        }

        body::-webkit-scrollbar-thumb:hover {
            background: var(--primary-color);
        }
        
        /* Эффект старого ЭЛТ-монитора */
        .crt-effect::before {
            content: " ";
            display: block;
            position: fixed;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%),
                        linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 2px, 3px 100%;
            z-index: 10000;
            pointer-events: none;
        }
        
        .crt-effect::after {
            content: " ";
            display: block;
            position: fixed;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.1);
            opacity: 0;
            z-index: 10001;
            pointer-events: none;
            animation: flicker 0.15s infinite;
        }
        
        @keyframes flicker {
            0% { opacity: 0.1; }
            5% { opacity: 0.1; }
            10% { opacity: 0.2; }
            15% { opacity: 0.1; }
            20% { opacity: 0.3; }
            25% { opacity: 0.1; }
            30% { opacity: 0.2; }
            35% { opacity: 0.1; }
            40% { opacity: 0.2; }
            45% { opacity: 0.1; }
            50% { opacity: 0.3; }
            55% { opacity: 0.1; }
            60% { opacity: 0.2; }
            65% { opacity: 0.1; }
            70% { opacity: 0.1; }
            75% { opacity: 0.2; }
            80% { opacity: 0.1; }
            85% { opacity: 0.2; }
            90% { opacity: 0.1; }
            95% { opacity: 0.3; }
            100% { opacity: 0.1; }
        }
        
        .scan-line {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: rgba(0, 255, 0, 0.3);
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.5);
            z-index: 9999;
            pointer-events: none;
            animation: scan 3s linear infinite;
        }
        
        @keyframes scan {
            0% { top: 0%; }
            100% { top: 100%; }
        }
        
        .container {
            background-color: var(--container-bg);
            border-radius: 0;
            padding: 15px;
            box-shadow: 0 0 10px var(--primary-color);
            border: 2px solid var(--primary-color);
            position: relative;
            z-index: 1;
            max-width: 100%;
            margin: 0 auto;
        }
        
        h1 {
            color: var(--primary-color);
            text-align: center;
            margin: 0 0 10px;
            font-size: 22px;
            text-shadow: 2px 2px 0 #030;
            width: 100%;
        }
        
        .subtitle {
            text-align: center;
            color: var(--secondary-color);
            margin-bottom: 20px;
            font-size: 14px;
        }
        
        .game-area {
            margin: 15px 0;
            padding: 12px;
            border: 2px solid var(--secondary-color);
            border-radius: 0;
            background-color: var(--game-area-bg);
        }
        
        input[type="number"] {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 2px solid var(--secondary-color);
            border-radius: 0;
            box-sizing: border-box;
            background-color: var(--background-color);
            color: var(--text-color);
            font-family: 'Courier New', Courier, monospace;
            font-size: 18px;
            -webkit-appearance: none;
            -moz-appearance: textfield;
        }
        
        /* Убираем стрелки в input number */
        input[type=number]::-webkit-outer-spin-button,
        input[type=number]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        
        .buttons-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 15px 0;
        }
        
        button {
            background-color: var(--background-color);
            color: var(--text-color);
            border: 2px solid var(--primary-color);
            padding: 12px 15px;
            border-radius: 0;
            cursor: pointer;
            font-size: 16px;
            font-family: 'Courier New', Courier, monospace;
            image-rendering: pixelated;
            transition: all 0.3s ease;
            flex: 1;
            min-height: 50px;
        }
        
        button:hover, button:active {
            background-color: var(--primary-color);
            color: var(--background-color);
        }
        
        button:disabled {
            background-color: #222;
            color: #050;
            border-color: #050;
            cursor: not-allowed;
        }
        
        #newGameBtn {
            background-color: var(--background-color);
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
        }
        
        #newGameBtn:hover, #newGameBtn:active {
            background-color: var(--primary-color);
            color: var(--background-color);
        }
        
        .message {
            padding: 12px;
            margin: 15px 0;
            border-radius: 0;
            text-align: center;
            font-weight: bold;
            border: 2px solid var(--secondary-color);
            font-size: 16px;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .hint {
            background-color: #051005;
            border: 2px solid var(--secondary-color);
            color: var(--text-color);
        }
        
        .success {
            background-color: #051005;
            border: 2px solid var(--primary-color);
            color: var(--text-color);
            animation: pulse 0.5s infinite alternate;
        }
        
        @keyframes pulse {
            from { box-shadow: 0 0 5px var(--primary-color); }
            to { box-shadow: 0 0 20px var(--primary-color); }
        }
        
        .attempts {
            margin-top: 15px;
            font-style: italic;
            color: var(--secondary-color);
            text-align: center;
            font-size: 16px;
        }
        
        .rules {
            margin-top: 20px;
            padding: 12px;
            background-color: #051005;
            border-radius: 0;
            font-size: 14px;
            border: 2px solid var(--secondary-color);
        }
        
        .rules h3 {
            margin-top: 0;
            text-align: center;
        }
        
        .rules ul {
            padding-left: 20px;
            margin-bottom: 0;
        }
        
        .rules li {
            margin-bottom: 8px;
        }
        
        .pixel-border {
            border-style: solid;
            border-width: 4px;
            border-color: var(--primary-color) #050 #050 var(--primary-color);
        }
        
        .pixel-border-reverse {
            border-style: solid;
            border-width: 4px;
            border-color: #050 var(--primary-color) var(--primary-color) #050;
        }
        
        .history-section {
            margin: 15px 0;
            padding: 10px;
            background-color: #051005;
            border: 1px solid var(--secondary-color);
        }
        
        .history-section h3 {
            margin-top: 0;
            text-align: center;
        }
        
        .history-list {
            max-height: 120px;
            overflow-y: auto;
            margin-top: 10px;
            padding: 8px;
            background-color: var(--background-color);
            border: 1px dashed var(--secondary-color);
            font-size: 14px;
            color: var(--secondary-color);
        }
        
        .history-item {
            margin: 5px 0;
            padding: 3px;
            border-bottom: 1px solid var(--secondary-color);
        }
        
        /* Визуализация диапазона */
        .range-visualization {
            margin: 20px 0;
            padding: 10px;
            background-color: var(--background-color);
            border: 1px solid var(--secondary-color);
            position: relative;
        }
        
        .range-visualization.narrow-range {
            box-shadow: 0 0 15px var(--primary-color), 0 0 30px var(--primary-color);
            animation: narrow-pulse 1s infinite alternate;
        }
        
        @keyframes narrow-pulse {
            from { box-shadow: 0 0 10px var(--primary-color), 0 0 20px var(--primary-color); }
            to { box-shadow: 0 0 20px var(--primary-color), 0 0 40px var(--primary-color); }
        }
        
        .range-scale {
            position: relative;
            width: 100%;
            height: 40px;
            background-color: #051005;
            border: 1px solid var(--secondary-color);
            margin-bottom: 10px;
        }
        
        .range-numbers {
            display: flex;
            justify-content: space-between;
            color: var(--secondary-color);
            font-size: 12px;
            margin-top: 5px;
        }
        
        .range-current {
            position: absolute;
            height: 100%;
            background-color: rgba(0, 255, 0, 0.2);
            border: 1px solid var(--primary-color);
            transition: all 0.5s ease;
        }
        
        .range-marker {
            position: absolute;
            width: 2px;
            height: 100%;
            top: 0;
        }
        
        .range-marker.higher {
            background-color: #ff0;
        }
        
        .range-marker.lower {
            background-color: #0ff;
        }
        
        .range-marker.correct {
            background-color: var(--primary-color);
            width: 4px;
            height: 120%;
            top: -10%;
            box-shadow: 0 0 10px var(--primary-color);
            animation: correct-pulse 1s infinite;
        }
        
        @keyframes correct-pulse {
            0% { box-shadow: 0 0 5px var(--primary-color); }
            50% { box-shadow: 0 0 15px var(--primary-color); }
            100% { box-shadow: 0 0 5px var(--primary-color); }
        }
        
        .marker-label {
            position: absolute;
            top: -20px;
            left: -10px;
            font-size: 10px;
            color: var(--primary-color);
            background-color: var(--background-color);
            padding: 2px;
            border: 1px solid var(--secondary-color);
        }
        
        .stats {
            display: flex;
            flex-direction: column;
            gap: 5px;
            margin-top: 10px;
            font-size: 14px;
            color: var(--secondary-color);
        }
        
        .stats-row {
            display: flex;
            justify-content: space-between;
        }
        
        .glitch-text {
            position: relative;
            display: inline-block;
        }
        
        .glitch-text::before,
        .glitch-text::after {
            content: attr(data-text);
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        .glitch-text::before {
            left: 2px;
            text-shadow: -1px 0 red;
            clip: rect(24px, 550px, 90px, 0);
            animation: glitch-anim 5s infinite linear alternate-reverse;
        }
        
        .glitch-text::after {
            left: -2px;
            text-shadow: -1px 0 blue;
            clip: rect(85px, 550px, 140px, 0);
            animation: glitch-anim2 5s infinite linear alternate-reverse;
        }
        
        @keyframes glitch-anim {
            0% { clip: rect(42px, 9999px, 44px, 0); }
            5% { clip: rect(12px, 9999px, 59px, 0); }
            10% { clip: rect(48px, 9999px, 29px, 0); }
            15% { clip: rect(42px, 9999px, 73px, 0); }
            20% { clip: rect(63px, 9999px, 27px, 0); }
            25% { clip: rect(34px, 9999px, 55px, 0); }
            30% { clip: rect(86px, 9999px, 73px, 0); }
            35% { clip: rect(20px, 9999px, 20px, 0); }
            40% { clip: rect(26px, 9999px, 60px, 0); }
            45% { clip: rect(25px, 9999px, 66px, 0); }
            50% { clip: rect(57px, 9999px, 98px, 0); }
            55% { clip: rect(5px, 9999px, 46px, 0); }
            60% { clip: rect(30px, 9999px, 16px, 0); }
            65% { clip: rect(59px, 9999px, 50px, 0); }
            70% { clip: rect(41px, 9999px, 62px, 0); }
            75% { clip: rect(2px, 9999px, 82px, 0); }
            80% { clip: rect(47px, 9999px, 73px, 0); }
            85% { clip: rect(3px, 9999px, 27px, 0); }
            90% { clip: rect(26px, 9999px, 55px, 0); }
            95% { clip: rect(42px, 9999px, 97px, 0); }
            100% { clip: rect(38px, 9999px, 49px, 0); }
        }
        
        @keyframes glitch-anim2 {
            0% { clip: rect(65px, 9999px, 100px, 0); }
            5% { clip: rect(52px, 9999px, 74px, 0); }
            10% { clip: rect(79px, 9999px, 85px, 0); }
            15% { clip: rect(75px, 9999px, 5px, 0); }
            20% { clip: rect(67px, 9999px, 61px, 0); }
            25% { clip: rect(14px, 9999px, 79px, 0); }
            30% { clip: rect(1px, 9999px, 66px, 0); }
            35% { clip: rect(86px, 9999px, 30px, 0); }
            40% { clip: rect(23px, 9999px, 98px, 0); }
            45% { clip: rect(85px, 9999px, 72px, 0); }
            50% { clip: rect(71px, 9999px, 75px, 0); }
            55% { clip: rect(2px, 9999px, 48px, 0); }
            60% { clip: rect(30px, 9999px, 16px, 0); }
            65% { clip: rect(59px, 9999px, 50px, 0); }
            70% { clip: rect(41px, 9999px, 62px, 0); }
            75% { clip: rect(2px, 9999px, 82px, 0); }
            80% { clip: rect(47px, 9999px, 73px, 0); }
            85% { clip: rect(3px, 9999px, 27px, 0); }
            90% { clip: rect(26px, 9999px, 55px, 0); }
            95% { clip: rect(42px, 9999px, 97px, 0); }
            100% { clip: rect(38px, 9999px, 49px, 0); }
        }
        
        .terminal-text {
            color: var(--primary-color);
            border-right: 2px solid var(--primary-color);
            padding-right: 5px;
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 100% { border-color: var(--primary-color); }
            50% { border-color: transparent; }
        }
        
        /* Стили для статистики */
        .stats-section {
            margin: 20px 0;
            padding: 12px;
            background-color: #051005;
            border: 1px solid var(--secondary-color);
        }
        
        .stats-section h3 {
            margin-top: 0;
            text-align: center;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 10px;
        }
        
        .stat-item {
            padding: 8px;
            background-color: var(--background-color);
            border: 1px solid var(--secondary-color);
            text-align: center;
        }
        
        .stat-value {
            font-size: 18px;
            font-weight: bold;
            color: var(--primary-color);
            margin-top: 5px;
        }
        
        .stat-label {
            font-size: 12px;
            color: var(--secondary-color);
        }
        
        /* Новые эффекты */
        .crt-noise {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%"><filter id="noise"><feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="1" stitchTiles="stitch"/></filter><rect width="100%" height="100%" filter="url(%23noise)" opacity="0.1"/></svg>');
            z-index: 102;
            pointer-events: none;
            opacity: 0.05;
            animation: noise 0.2s infinite;
        }
        
        @keyframes noise {
            0% { transform: translate(0,0); }
            10% { transform: translate(-1%,-1%); }
            20% { transform: translate(-2%,1%); }
            30% { transform: translate(1%,-2%); }
            40% { transform: translate(-1%,2%); }
            50% { transform: translate(2%,-1%); }
            60% { transform: translate(-2%,1%); }
            70% { transform: translate(1%,-2%); }
            80% { transform: translate(-1%,2%); }
            90% { transform: translate(2%,-1%); }
            100% { transform: translate(0,0); }
        }
        
        .vignette {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            box-shadow: inset 0 0 150px rgba(0, 0, 0, 0.9);
            z-index: 103;
            pointer-events: none;
        }
        
        .power-light {
            position: fixed;
            bottom: 15px;
            right: 15px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: var(--primary-color);
            box-shadow: 0 0 10px var(--primary-color);
            z-index: 104;
            animation: power-flicker 3s infinite;
        }
        
        @keyframes power-flicker {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
            51% { opacity: 0.3; }
            52% { opacity: 0.7; }
            95% { opacity: 0.8; }
        }
        
        /* Стили для режима паники */
        .panic-mode {
            color: #f00 !important;
            border-color: #f00 !important;
            box-shadow: 0 0 10px #f00 !important;
        }
        
        .panic-mode .container {
            box-shadow: 0 0 10px #f00, 0 0 20px #f00 !important;
            border: 2px solid #f00 !important;
        }
        
        .panic-mode .game-area {
            border: 2px solid #f00 !important;
            box-shadow: 0 0 10px #f00 !important;
        }
        
        .panic-mode input[type="number"] {
            border: 2px solid #f00 !important;
            color: #f00 !important;
            box-shadow: 0 0 5px #f00 !important;
        }
        
        .panic-mode button {
            color: #f00 !important;
            border: 2px solid #f00 !important;
            box-shadow: 0 0 5px #f00 !important;
        }
        
        .panic-mode button:hover, .panic-mode button:active {
            background-color: #f00 !important;
            color: #000 !important;
        }
        
        .panic-mode .message {
            border: 2px solid #f00 !important;
            box-shadow: 0 0 5px #f00 !important;
        }
        
        .panic-mode .hint {
            background-color: #300 !important;
            border: 2px solid #f00 !important;
            color: #f00 !important;
        }
        
        .panic-mode .success {
            background-color: #300 !important;
            border: 2px solid #f00 !important;
            color: #f00 !important;
        }
        
        .panic-mode .attempts {
            color: #f00 !important;
        }
        
        .panic-mode .rules {
            background-color: #300 !important;
            border: 2px solid #f00 !important;
            color: #f00 !important;
        }
        
        .panic-mode .history-section {
            background-color: #300 !important;
            border: 1px solid #f00 !important;
        }
        
        .panic-mode .history-list {
            background-color: #200 !important;
            border: 1px dashed #f00 !important;
            color: #f00 !important;
        }
        
        .panic-mode .stats-section {
            background-color: #300 !important;
            border: 1px solid #f00 !important;
        }
        
        .panic-mode .stat-item {
            border: 1px solid #f00 !important;
        }
        
        .panic-mode .stat-value {
            color: #f00 !important;
        }
        
        .panic-mode .range-visualization {
            border: 1px solid #f00 !important;
            box-shadow: 0 0 10px #f00 !important;
        }
        
        .panic-mode .range-scale {
            background-color: #300 !important;
            border: 1px solid #f00 !important;
        }
        
        .panic-mode .range-numbers {
            color: #f00 !important;
        }
        
        .panic-mode .range-current {
            background-color: rgba(255, 0, 0, 0.2) !important;
            border: 1px solid #f00 !important;
        }
        
        .panic-mode .scan-line {
            background: rgba(255, 0, 0, 0.3) !important;
            box-shadow: 0 0 10px rgba(255, 0, 0, 0.5) !important;
        }
        
        .panic-mode .power-light {
            background-color: #f00 !important;
            box-shadow: 0 0 10px #f00 !important;
        }
        
        .shake-screen {
            animation: shake 0.5s infinite;
        }
        
        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            70% { transform: translate(3px, 1px) rotate(-1deg); }
            80% { transform: translate(-1px, -1px) rotate(1deg); }
            90% { transform: translate(1px, 2px) rotate(0deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }
        
        .panic-timer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.4);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 200;
            font-size: 36px;
            color: #f00;
            text-shadow: 0 0 10px #f00;
            flex-direction: column;
            display: none;
            pointer-events: none;
            padding: 20px;
            text-align: center;
        }
        
        .panic-timer.active {
            display: flex;
        }
        
        .timer-text {
            font-size: 24px;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .timer-count {
            font-size: 48px;
            font-weight: bold;
            color: #f00;
            text-shadow: 0 0 20px #f00;
            animation: timer-pulse 1s infinite;
            margin-bottom: 15px;
        }
        
        @keyframes timer-pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.5); }
            100% { transform: scale(1); }
        }
        
        .panic-warning {
            color: #f00;
            text-align: center;
            margin-top: 10px;
            font-size: 14px;
            animation: blink 1s infinite;
        }

        .hint-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: var(--background-color);
            border: 3px solid var(--primary-color);
            padding: 20px;
            z-index: 300;
            box-shadow: 0 0 20px var(--primary-color), 0 0 40px var(--primary-color);
            text-align: center;
            animation: hint-appear 0.5s ease-out;
            display: none;
            width: 80%;
            max-width: 300px;
        }
        
        .hint-popup.active {
            display: block;
        }
        
        .hint-popup.panic-mode {
            border: 3px solid #f00;
            box-shadow: 0 0 20px #f00, 0 0 40px #f00;
            color: #f00;
        }
        
        @keyframes hint-appear {
          0% { 
            opacity: 0;
            }
         100% { 
            opacity: 1;
            }
        }
        
        .hint-title {
            font-size: 18px;
            margin-bottom: 15px;
            color: var(--primary-color);
            text-shadow: 0 0 10px var(--primary-color);
        }
        
        .hint-value {
            font-size: 24px;
            font-weight: bold;
            margin: 15px 0;
            color: var(--primary-color);
            text-shadow: 0 0 15px var(--primary-color);
            animation: hint-pulse 1s infinite alternate;
        }
        
        .hint-popup.panic-mode .hint-title,
        .hint-popup.panic-mode .hint-value {
            color: #f00;
            text-shadow: 0 0 10px #f00;
        }
        
        @keyframes hint-pulse {
            from { transform: scale(1); }
            to { transform: scale(1.1); }
        }
        
        .hint-timer {
            margin-top: 15px;
            font-size: 14px;
            color: var(--secondary-color);
        }
        
        .hint-popup.panic-mode .hint-timer {
            color: #a00;
        }
        
        .hint-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 299;
            display: none;
        }
        
        .hint-overlay.active {
            display: block;
        }
        
        /* Стили для режима тревоги */
        .alarm-mode {
            color: #ff0 !important;
            border-color: #ff0 !important;
            box-shadow: 0 0 10px #ff0 !important;
        }
        
        .alarm-mode .container {
            box-shadow: 0 0 10px #ff0, 0 0 20px #ff0 !important;
            border: 2px solid #ff0 !important;
        }
        
        .alarm-mode .game-area {
            border: 2px solid #ff0 !important;
            box-shadow: 0 0 10px #ff0 !important;
        }
        
        .alarm-mode input[type="number"] {
            border: 2px solid #ff0 !important;
            color: #ff0 !important;
            box-shadow: 0 0 5px #ff0 !important;
        }
        
        .alarm-mode button {
            color: #ff0 !important;
            border: 2px solid #ff0 !important;
            box-shadow: 0 0 5px #ff0 !important;
        }
        
        .alarm-mode button:hover, .alarm-mode button:active {
            background-color: #ff0 !important;
            color: #000 !important;
        }
        
        .alarm-mode .message {
            border: 2px solid #ff0 !important;
            box-shadow: 0 0 5px #ff0 !important;
        }
        
        .alarm-mode .hint {
            background-color: #333300 !important;
            border: 2px solid #ff0 !important;
            color: #ff0 !important;
        }
        
        .alarm-mode .success {
            background-color: #333300 !important;
            border: 2px solid #ff0 !important;
            color: #ff0 !important;
        }
        
        .alarm-mode .attempts {
            color: #ff0 !important;
        }
        
        .alarm-mode .rules {
            background-color: #333300 !important;
            border: 2px solid #ff0 !important;
            color: #ff0 !important;
        }
        
        .alarm-mode .history-section {
            background-color: #333300 !important;
            border: 1px solid #ff0 !important;
        }
        
        .alarm-mode .history-list {
            background-color: #222200 !important;
            border: 1px dashed #ff0 !important;
            color: #ff0 !important;
        }
        
        .alarm-mode .stats-section {
            background-color: #333300 !important;
            border: 1px solid #ff0 !important;
        }
        
        .alarm-mode .stat-item {
            border: 1px solid #ff0 !important;
        }
        
        .alarm-mode .stat-value {
            color: #ff0 !important;
        }
        
        .alarm-mode .range-visualization {
            border: 1px solid #ff0 !important;
            box-shadow: 0 0 10px #ff0 !important;
        }
        
        .alarm-mode .range-scale {
            background-color: #333300 !important;
            border: 1px solid #ff0 !important;
        }
        
        .alarm-mode .range-numbers {
            color: #ff0 !important;
        }
        
        .alarm-mode .range-current {
            background-color: rgba(255, 255, 0, 0.2) !important;
            border: 1px solid #ff0 !important;
        }
        
        .alarm-mode .scan-line {
            background: rgba(255, 255, 0, 0.3) !important;
            box-shadow: 0 0 10px rgba(255, 255, 0, 0.5) !important;
        }
        
        .alarm-mode .power-light {
            background-color: #ff0 !important;
            box-shadow: 0 0 10px #ff0 !important;
        }
        
        .alarm-timer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.4);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 200;
            font-size: 36px;
            color: #ff0;
            text-shadow: 0 0 10px #ff0;
            flex-direction: column;
            display: none;
            pointer-events: none;
            padding: 20px;
            text-align: center;
        }
        
        .alarm-timer.active {
            display: flex;
        }
        
        .alarm-timer .timer-text {
            font-size: 24px;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .alarm-timer .timer-count {
            font-size: 48px;
            font-weight: bold;
            color: #ff0;
            text-shadow: 0 0 20px #ff0;
            animation: alarm-timer-pulse 1s infinite;
            margin-bottom: 15px;
        }
        
        @keyframes alarm-timer-pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .alarm-warning {
            color: #ff0;
            text-align: center;
            margin-top: 10px;
            font-size: 14px;
            animation: blink 1s infinite;
        }
        
        /* Стили для кнопки сброса прогресса */
        .reset-section {
            margin-top: 20px;
            padding: 12px;
            background-color: #200;
            border-radius: 0;
            font-size: 14px;
            border: 2px solid #500;
            text-align: center;
        }

        .reset-section p {
            margin: 15px 0;
            line-height: 1.5;
            color: #a00;
        }
        
        .reset-section h3 {
            margin-top: 0;
            text-align: center;
            color: #a00;
        }
        
        #resetProgressBtn {
            background-color: #200;
            color: #a00;
            border: 2px solid #a00;
            margin-top: 10px;
        }
        
        #resetProgressBtn:hover, #resetProgressBtn:active {
            background-color: #a00;
            color: #200;
        }
        
        /* Модальное окно подтверждения сброса */
        .reset-confirm-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 400;
            display: none;
            justify-content: center;
            align-items: center;
        }
        
        .reset-confirm-overlay.active {
            display: flex;
        }
        
        .reset-confirm-popup {
            background-color: var(--background-color);
            border: 3px solid #a00;
            padding: 25px;
            max-width: 90%;
            width: 400px;
            text-align: center;
            box-shadow: 0 0 20px #a00, 0 0 40px #a00;
            animation: hint-appear 0.5s ease-out;
        }
        
        .reset-confirm-popup h3 {
            margin-top: 0;
            color: #a00;
            text-shadow: 0 0 10px #a00;
            font-size: 20px;
        }
        
        .reset-confirm-popup p {
            margin: 15px 0;
            color: #a00;
            line-height: 1.5;
        }
        
        .reset-confirm-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }
        
        .reset-confirm-btn {
            padding: 10px 20px;
            border: 2px solid;
            background-color: var(--background-color);
            font-family: 'Courier New', Courier, monospace;
            font-size: 16px;
            cursor: pointer;
            flex: 1;
            transition: all 0.3s ease;
        }
        
        #confirmResetBtn {
            color: #a00;
            border-color: #a00;
        }
        
        #confirmResetBtn:hover, #confirmResetBtn:active {
            background-color: #a00;
            color: var(--background-color);
        }
        
        #cancelResetBtn {
            color: var(--secondary-color);
            border-color: var(--secondary-color);
        }
        
        #cancelResetBtn:hover, #cancelResetBtn:active {
            background-color: var(--secondary-color);
            color: var(--background-color);
        }

        .shop-section {
            margin-top: 20px;
            padding: 12px;
            background-color: #111;
            border-radius: 0;
            font-size: 14px;
            border: 2px solid #fff;
            text-align: center;
        }
        
        .shop-section h3 {
            margin-top: 0;
            text-align: center;
            color: #fff;
        }

        .shop-section p {
            margin: 15px 0;
            line-height: 1.5;
            color: #fff;
        }
        
        #shopBtn {
            background-color: #111;
            color: #fff;
            border: 2px solid #fff;
            margin-top: 10px;
        }
        
        #shopBtn:hover, #shopBtn:active {
            background-color: #fff;
            color: #111;
        }
        
        /* Стили для модального окна магазина */
        .shop-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 400;
            display: none;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .shop-overlay.active {
            display: flex;
            opacity: 1;
        }
        
        .shop-popup {
            background-color: var(--background-color);
            border: 3px solid #fff;
            padding: 25px;
            max-width: 90%;
            width: 500px;
            height: 80%;
            overflow: auto;
            text-align: center;
            box-shadow: 0 0 20px #fff, 0 0 40px #fff;
            animation: shop-appear 0.4s ease-out;
            transform: scale(0.9);
            opacity: 0;
            transition: all 0.3s ease;
        }
        
        .shop-overlay.active .shop-popup {
            transform: scale(1);
            opacity: 1;
        }
        
        @keyframes shop-appear {
            0% {
                transform: scale(0.7);
                opacity: 0;
            }
            70% {
                transform: scale(1.05);
                opacity: 0.8;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        .shop-popup h3 {
            margin-top: 0;
            color: #fff;
            text-shadow: 0 0 10px #fff;
            font-size: 20px;
        }
        
        .shop-popup p {
            margin: 15px 0;
            line-height: 1.5;
            color: #fff;
        }
        
        .shop-close-btn {
            padding: 10px 20px;
            border: 2px solid #fff;
            background-color: var(--background-color);
            color: #fff;
            font-family: 'Courier New', Courier, monospace;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 15px;
        }
        
        .shop-close-btn:hover, .shop-close-btn:active {
            background-color: #fff;
            color: var(--background-color);
        }

        .shop-info {
            margin: 15px 0;
            padding: 10px;
            background-color: #222;
            border: 1px solid #fff;
            text-align: center;
        }
        
        .shop-markup-value {
            font-size: 24px;
            font-weight: bold;
            color: #fff;
            text-shadow: 0 0 10px #fff;
            margin: 10px 0;
        }
        
        .shop-note {
            font-size: 12px;
            color: #aaa;
            margin-top: 10px;
        }

        .shop-markup-text {
            color: #fff;
            margin-top: 10px;
        }

        /* Стили для монеток */
        .coins-value {
            color: #ffffff !important;
            text-shadow: 0 0 10px #ffffff, 0 0 20px #ffffff, 0 0 30px #00ffff, 0 0 40px #00ffff;
            animation: coins-glow 2s infinite alternate;
            font-weight: bold;
            position: relative;
            display: inline-block;
            padding: 5px 10px;
            border-radius: 5px;
            background: linear-gradient(45deg, rgba(255,255,255,0.1), rgba(0,255,255,0.1));
            border: 1px solid rgba(255,255,255,0.3);
        }

        @keyframes coins-glow {
            0% {
                text-shadow: 0 0 5px #ffffff, 0 0 10px #ffffff, 0 0 15px #00ffff, 0 0 20px #00ffff;
                transform: scale(1);
            }
            100% {
                text-shadow: 0 0 10px #ffffff, 0 0 20px #ffffff, 0 0 30px #00ffff, 0 0 40px #00ffff, 0 0 50px #00ffff;
                transform: scale(1.05);
            }
        }

        .coins-value::before {
            content: "M";
            margin-right: 5px;
            display: inline-block;
            animation: coin-spin 3s infinite linear;
        }

        @keyframes coin-spin {
            0% { transform: rotateY(0deg); }
            100% { transform: rotateY(360deg); }
        }

        /* Эффект для увеличения счетчика монеток */
        @keyframes coins-count-up {
            0% { 
                transform: scale(1);
                text-shadow: 0 0 5px #ffffff;
            }
            50% { 
                transform: scale(1.3);
                text-shadow: 0 0 20px #ffff00, 0 0 30px #ffff00;
                color: #ffff00;
            }
            100% { 
                transform: scale(1);
                text-shadow: 0 0 10px #ffffff;
                color: #ffffff;
            }
        }

        .coins-count-up {
            animation: coins-count-up 0.5s ease-out;
        }

        /* Специальный стиль для монеток в магазине */
        .shop-coins-display {
            color: #ffffff !important;
            text-shadow: 0 0 10px #ffffff, 0 0 20px #ffff00, 0 0 30px #ffff00;
            animation: shop-coins-glow 3s infinite alternate;
            font-size: 24px !important;
            font-weight: bold;
            margin: 15px 0;
            padding: 10px;
            border-radius: 5px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.3);
        }

        @keyframes shop-coins-glow {
            0% {
                text-shadow: 0 0 5px #ffffff, 0 0 10px #ffff00, 0 0 15px #ffff00;
                transform: scale(1);
            }
            100% {
                text-shadow: 0 0 10px #ffffff, 0 0 20px #ffff00, 0 0 30px #ffff00, 0 0 40px #ffff00;
                transform: scale(1.05);
            }
        }

        .shop-coins-display::before {
            content: "M";
            margin-right: 10px;
            display: inline-block;
            animation: coin-spin 3s infinite linear;
        }

        /* Стили для товаров в магазине */
        .shop-items {
            margin: 20px 0;
        }

        .shop-item {
            padding: 15px;
            margin-bottom: 15px;
            background-color: #222;
            border: 1px solid #fff;
            border-radius: 0;
            text-align: left;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

    .shop-item:hover {
        transform: translateY(-5px) scale(1.02);
        box-shadow: 0 10px 20px rgba(255, 255, 255, 0.2);
    }
        .shop-item.purchased {
            opacity: 0.7;
            border-color: #0f0;
            background-color: #151515;
        }

        .shop-item-name {
            font-size: 18px;
            font-weight: bold;
            color: #fff;
            margin-bottom: 10px;
        }

        .shop-item-description {
            font-size: 14px;
            color: #aaa;
            margin-bottom: 10px;
            line-height: 1.4;
        }

        .shop-item-price {
            font-size: 16px;
            color: #ff0;
            margin-bottom: 10px;
        }
        
        .shop-original-price {
            text-decoration: line-through;
            color: #aaa;
            font-size: 14px;
            margin-right: 5px;
        }
        
        .shop-final-price {
            color: #ff0;
            font-weight: bold;
        }

        .shop-buy-btn {
            background-color: #333;
            color: #fff;
            border: 2px solid #fff;
            padding: 8px 15px;
            cursor: pointer;
            font-family: 'Courier New', Courier, monospace;
            transition: all 0.3s ease;
        }

        .shop-buy-btn:hover {
            background-color: #fff;
            color: #333;
        }

        .shop-buy-btn:disabled {
            background-color: #555;
            color: #888;
            border-color: #555;
            cursor: not-allowed;
        }

        .shop-item-owned {
            color: #0f0;
            font-weight: bold;
            margin-top: 5px;
        }

        .purchase-animation {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, rgba(255,255,255,0.1), rgba(0,255,255,0.1));
            z-index: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            animation: purchase-glow 1s ease-out;
        }

        @keyframes purchase-glow {
            0% {
                opacity: 0;
                transform: scale(0.5);
            }
            50% {
                opacity: 1;
                transform: scale(1);
            }
            100% {
                opacity: 0;
                transform: scale(1.5);
            }
        }

        .purchase-text {
            color: #0ff;
            font-size: 24px;
            font-weight: bold;
            text-shadow: 0 0 10px #0ff;
            animation: purchase-text-pulse 1s ease-out;
        }

        @keyframes purchase-text-pulse {
            0% {
                transform: scale(0.5);
                opacity: 0;
            }
            70% {
                transform: scale(1.2);
                opacity: 1;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

.inventory-section {
    margin-top: 20px;
    padding: 12px;
    background-color: #111;
    border-radius: 0;
    font-size: 14px;
    border: 2px solid #0a0;
    text-align: center;
}

.inventory-section h3 {
    margin-top: 0;
    text-align: center;
    color: #0a0;
}

.inventory-section p {
    margin: 15px 0;
    line-height: 1.5;
    color: #0a0;
}

.inventory-list {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    gap: 10px;
    margin-top: 15px;
}

.inventory-item {
    padding: 12px;
    background-color: #051005;
    border: 1px solid #0a0;
    border-radius: 0;
    text-align: center;
    transition: all 0.3s ease;
    position: relative;
    min-height: 120px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    opacity: 0;
    transform: translateY(20px);
    animation: inventory-item-appear 0.5s ease forwards;
}

@keyframes inventory-item-appear {
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.inventory-item.empty {
    grid-column: 1 / -1;
    opacity: 0.7;
}

.inventory-item:hover {
    transform: translateY(-3px);
    box-shadow: 0 5px 15px rgba(0, 255, 0, 0.2);
}

.inventory-icon {
    font-size: 24px;
    margin-bottom: 8px;
    transition: all 0.3s ease;
}

.inventory-item.active .inventory-icon {
    animation: item-active-pulse 1s infinite;
}

@keyframes item-active-pulse {
    0% {
        transform: scale(1);
        text-shadow: 0 0 5px currentColor;
    }
    50% {
        transform: scale(1.2);
        text-shadow: 0 0 15px currentColor, 0 0 20px currentColor;
    }
    100% {
        transform: scale(1);
        text-shadow: 0 0 5px currentColor;
    }
}

.inventory-name {
    font-weight: bold;
    color: #0f0;
    margin-bottom: 5px;
}

.inventory-description {
    font-size: 12px;
    color: #0a0;
    margin-bottom: 10px;
}

.inventory-count {
    position: absolute;
    top: 5px;
    right: 5px;
    background-color: #0f0;
    color: #000;
    border-radius: 50%;
    width: 20px;
    height: 20px;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 12px;
    font-weight: bold;
}

.inventory-use-btn {
    background-color: #0a0;
    color: #000;
    border: none;
    padding: 5px 10px;
    font-size: 12px;
    cursor: pointer;
    font-family: 'Courier New', Courier, monospace;
    margin-top: 5px;
}

.inventory-use-btn:hover {
    background-color: #0f0;
}

/* Стили для инвентаря в режиме паники */
.panic-mode .inventory-section {
    background-color: #300 !important;
    border: 2px solid #f00 !important;
}

.panic-mode .inventory-section h3,
.panic-mode .inventory-section p {
    color: #f00 !important;
}

.panic-mode .inventory-item {
    background-color: #200 !important;
    border: 1px solid #f00 !important;
}

.panic-mode .inventory-name {
    color: #f00 !important;
}

.panic-mode .inventory-description {
    color: #a00 !important;
}

.panic-mode .inventory-count {
    background-color: #f00 !important;
    color: #000 !important;
}

.panic-mode .inventory-use-btn {
    background-color: #a00 !important;
    color: #000 !important;
}

.panic-mode .inventory-use-btn:hover {
    background-color: #f00 !important;
}

/* Стили для инвентаря в режиме тревоги */
.alarm-mode .inventory-section {
    background-color: #333300 !important;
    border: 2px solid #ff0 !important;
}

.alarm-mode .inventory-section h3,
.alarm-mode .inventory-section p {
    color: #ff0 !important;
}

.alarm-mode .inventory-item {
    background-color: #222200 !important;
    border: 1px solid #ff0 !important;
}

.alarm-mode .inventory-name {
    color: #ff0 !important;
}

.alarm-mode .inventory-description {
    color: #aa0 !important;
}

.alarm-mode .inventory-count {
    background-color: #ff0 !important;
    color: #000 !important;
}

.alarm-mode .inventory-use-btn {
    background-color: #aa0 !important;
    color: #000 !important;
}

.alarm-mode .inventory-use-btn:hover {
    background-color: #ff0 !important;
}

        .shop-markup-note {
            font-size: 12px;
            color: #aaa;
            margin-top: 5px;
        }

        /* Стили для системы налога */
        .tax-notification {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 500;
            display: none;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .tax-notification.active {
            display: flex;
            opacity: 1;
        }
        
        .tax-popup {
            background-color: var(--background-color);
            border: 3px solid #f00;
            padding: 25px;
            max-width: 90%;
            width: 500px;
            text-align: center;
            box-shadow: 0 0 20px #f00, 0 0 40px #f00;
            animation: tax-appear 0.5s ease-out;
            transform: scale(0.9);
            opacity: 0;
        }
        
        .tax-notification.active .tax-popup {
            transform: scale(1);
            opacity: 1;
        }
        
        @keyframes tax-appear {
            0% {
                transform: scale(0.7);
                opacity: 0;
            }
            70% {
                transform: scale(1.05);
                opacity: 0.8;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        .tax-popup h3 {
            margin-top: 0;
            color: #f00;
            text-shadow: 0 0 10px #f00;
            font-size: 24px;
        }
        
        .tax-popup p {
            margin: 15px 0;
            line-height: 1.5;
            color: #f00;
        }
        
        .tax-amount {
            font-size: 32px;
            font-weight: bold;
            color: #f00;
            text-shadow: 0 0 15px #f00;
            margin: 20px 0;
            animation: tax-pulse 1s infinite alternate;
        }
        
        @keyframes tax-pulse {
            from { transform: scale(1); }
            to { transform: scale(1.1); }
        }
        
        .tax-formula {
            background-color: #300;
            padding: 10px;
            margin: 15px 0;
            border: 1px solid #f00;
            font-family: 'Courier New', Courier, monospace;
            font-size: 14px;
            color: #f00;
        }
        
        .tax-pay-btn {
            background-color: #300;
            color: #f00;
            border: 2px solid #f00;
            padding: 12px 25px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 15px;
        }
        
        .tax-pay-btn:hover, .tax-pay-btn:active {
            background-color: #f00;
            color: #300;
        }
        
        .tax-pay-btn:disabled {
            background-color: #555;
            color: #888;
            border-color: #555;
            cursor: not-allowed;
        }
        
        .tax-counter {
            text-align: center;
            color: #f00;
            margin-bottom: 10px;
            font-size: 16px;
            padding: 8px;
            background-color: #200;
            border: 1px solid #f00;
            opacity: 0;
            transform: translateY(-10px);
            transition: all 0.3s ease;
        }
        
        .tax-counter.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        .tax-warning {
            color: #f00;
            text-align: center;
            margin-top: 10px;
            font-size: 14px;
            animation: blink 1s infinite;
        }

        /* Анимации для зачисления монет */
        .coins-earned-animation {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 600;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            pointer-events: none;
        }

        .coins-earned-value {
            font-size: 48px;
            font-weight: bold;
            color: #ffff00;
            text-shadow: 0 0 10px #ffff00, 0 0 20px #ffff00, 0 0 30px #ff9900;
            animation: coins-earned-float 2s ease-out forwards;
            margin-bottom: 10px;
        }

        @keyframes coins-earned-float {
            0% {
                transform: translateY(0) scale(0.5);
                opacity: 0;
            }
            20% {
                transform: translateY(-20px) scale(1.2);
                opacity: 1;
            }
            80% {
                transform: translateY(-80px) scale(1);
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) scale(0.8);
                opacity: 0;
            }
        }

        .coins-breakdown {
            display: flex;
            flex-direction: column;
            gap: 5px;
            margin-top: 10px;
            opacity: 0;
            animation: coins-breakdown-appear 0.5s ease 0.5s forwards;
        }

        @keyframes coins-breakdown-appear {
            to {
                opacity: 1;
            }
        }

        .coins-breakdown-item {
            display: flex;
            justify-content: space-between;
            font-size: 16px;
            color: #fff;
            padding: 5px 10px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 5px;
            min-width: 200px;
        }

        .coins-breakdown-label {
            text-align: left;
        }

        .coins-breakdown-value {
            text-align: right;
            font-weight: bold;
        }

        .coins-breakdown-positive {
            color: #0f0;
        }

        .coins-breakdown-negative {
            color: #f00;
        }

        .coins-breakdown-bonus {
            color: #ff0;
        }

        /* Анимации для работы предметов */
        .item-activation {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 600;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            pointer-events: none;
        }

        .item-activation-icon {
            font-size: 64px;
            margin-bottom: 20px;
            animation: item-activation-pulse 1.5s ease-out forwards;
        }

        @keyframes item-activation-pulse {
            0% {
                transform: scale(0.5) rotate(0deg);
                opacity: 0;
            }
            30% {
                transform: scale(1.2) rotate(10deg);
                opacity: 1;
            }
            70% {
                transform: scale(1) rotate(-5deg);
                opacity: 1;
            }
            100% {
                transform: scale(1) rotate(0deg);
                opacity: 0;
            }
        }

        .item-activation-text {
            font-size: 24px;
            font-weight: bold;
            color: #fff;
            text-shadow: 0 0 10px currentColor;
            animation: item-activation-text-float 2s ease-out forwards;
        }

        @keyframes item-activation-text-float {
            0% {
                transform: translateY(0);
                opacity: 0;
            }
            30% {
                transform: translateY(-10px);
                opacity: 1;
            }
            70% {
                transform: translateY(-20px);
                opacity: 1;
            }
            100% {
                transform: translateY(-30px);
                opacity: 0;
            }
        }

        /* Медиа-запросы для адаптивности */
        @media (min-width: 480px) {
            .buttons-container {
                flex-direction: row;
            }
            
            .stats {
                flex-direction: row;
            }
            
            .stats-row {
                flex: 1;
            }
        }
        
        @media (min-width: 768px) {
            body {
                padding: 20px;
            }
            
            .container {
                max-width: 700px;
                margin: 0 auto;
                padding: 25px;
            }
            
            h1 {
                font-size: 24px;
            }
            
            .game-area {
                padding: 15px;
            }
            
            .buttons-container {
                flex-direction: row;
            }
        }
        
        /* Отключение анимаций для пользователей, предпочитающих уменьшенное движение */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body class="crt-effect">
    <div class="scan-line"></div>
    <div class="crt-noise"></div>
    <div class="vignette"></div>
    <div class="power-light"></div>
    
    <!-- Анимации для зачисления монет -->
    <div class="coins-earned-animation" id="coinsEarnedAnimation" style="display: none;">
        <div class="coins-earned-value" id="coinsEarnedValue">+0</div>
        <div class="coins-breakdown" id="coinsBreakdown">
            <!-- Будет заполнено динамически -->
        </div>
    </div>
    
    <!-- Анимации для работы предметов -->
    <div class="item-activation" id="itemActivation" style="display: none;">
        <div class="item-activation-icon" id="itemActivationIcon">⚡</div>
        <div class="item-activation-text" id="itemActivationText">Активирован!</div>
    </div>
    
    <!-- Счетчик до налога -->
    <div id="taxCounter" class="tax-counter">
        До налога осталось: <span id="taxCounterValue">10</span> игр
    </div>
    
    <!-- Уведомление о налоге -->
    <div id="taxNotification" class="tax-notification">
        <div class="tax-popup">
            <h3>НАЛОГОВАЯ СЛУЖБА</h3>
            <p>Вы достигли <span id="taxGamesPlayed">10</span> игр. Необходимо оплатить налог!</p>
            <div class="tax-amount" id="taxAmount">0 монеток</div>
            <div class="tax-formula" id="taxFormula">
                Формула налога: ((-Среднее * 3) + (Число игр * 30) - Анти-Рекорд) + Бонус Рекорда%
            </div>
            <p>Если налог не будет оплачен, весь прогресс будет сброшен!</p>
            <button id="payTaxBtn" class="tax-pay-btn">ОПЛАТИТЬ НАЛОГ</button>
        </div>
    </div>
    
    <!-- Новый элемент для подсказки -->
    <div class="hint-overlay" id="hintOverlay"></div>
    <div class="hint-popup" id="hintPopup">
        <div class="hint-title">ПОДСКАЗКА СИСТЕМЫ</div>
        <div>Попробуй число:</div>
        <div class="hint-value" id="hintNumber">500</div>
        <div class="hint-timer">Исчезнет через: <span id="hintTimer">5</span> сек.</div>
    </div>
    
    <!-- Таймер режима паники -->
    <div class="panic-timer" id="panicTimer">
        <div class="timer-text">РЕЖИМ ПАНИКИ!</div>
        <div class="timer-count" id="timerCount">10</div>
        <div class="timer-text">+15 попыток через:</div>
    </div>
    
    <!-- Таймер режима тревоги -->
    <div class="alarm-timer" id="alarmTimer">
        <div class="timer-text">РЕЖИМ ТРЕВОГИ!</div>
        <div class="timer-count" id="alarmTimerCount">20</div>
        <div class="timer-text">+10 попыток через:</div>
    </div>
    
    <!-- Окно подтверждения сброса прогресса -->
    <div class="reset-confirm-overlay" id="resetConfirmOverlay">
        <div class="reset-confirm-popup">
            <h3>СБРОС ПРОГРЕССА</h3>
            <p>Вы уверены, что хотите сбросить ВЕСЬ прогресс за ВСЕ игры?</p>
            <p>Это действие нельзя отменить!</p>
            <div class="reset-confirm-buttons">
                <button id="confirmResetBtn" class="reset-confirm-btn">ДА, СБРОСИТЬ</button>
                <button id="cancelResetBtn" class="reset-confirm-btn">ОТМЕНА</button>
            </div>
        </div>
    </div>

    <div class="shop-overlay" id="shopOverlay">
        <div class="shop-popup">
            <h3>МАГАЗИН</h3>
            <div class="shop-coins-display" id="shopCoinsDisplay">0</div>
            <div class="shop-info">
                <div class="shop-markup-text">Текущая наценка:</div>
                <div class="shop-markup-value" id="shopMarkup">0%</div>
                <div class="shop-note">Наценка равна среднему количеству попыток за все игры</div>
            </div>
            <div class="shop-items" id="shopItems">
                <!-- Товары будут добавляться динамически -->
            </div>
            <button class="shop-close-btn" id="shopCloseBtn">ЗАКРЫТЬ</button>
        </div>
    </div>
    
    <div class="container pixel-border">
        <h1 class="glitch-text" data-text="PROJECT 500">PROJECT 500</h1>
        <div class="subtitle terminal-text">МАКСИМ ЗАКИРОВ 0.9</div>
        
        <div class="game-area pixel-border-reverse">
            <p>Я загадал число от 1 до 1000. Попробуй угадать его!</p>
            
            <input type="number" id="guessInput" min="1" max="1000" placeholder="Введите число от 1 до 1000" inputmode="numeric">
            
            <div class="buttons-container">
                <button id="guessBtn" class="pixel-border">ПРОВЕРИТЬ</button>
                <button id="newGameBtn" class="pixel-border">НОВАЯ ИГРА</button>
            </div>
            
            <div id="message" class="message"></div>
            <div id="attempts" class="attempts">Попытки: 0</div>
            
            <!-- Визуализация диапазона -->
            <div class="range-visualization" id="rangeVisualization">
                <div class="range-scale" id="rangeScale">
                    <div class="range-current" id="rangeCurrent"></div>
                    <!-- Маркеры будут добавляться динамически -->
                </div>
                <div class="range-numbers">
                    <span>1</span>
                    <span>1000</span>
                </div>
                <div class="stats">
                    <div class="stats-row">
                        <div>Минимум: <span id="minValue">1</span></div>
                        <div>Максимум: <span id="maxValue">1000</span></div>
                    </div>
                    <div class="stats-row">
                        <div>Текущий диапазон: <span id="currentRange">1-1000</span></div>
                    </div>
                </div>
                <div id="panicWarning" class="panic-warning" style="display: none;">
                    ВНИМАНИЕ! Диапазон сужается! Скоро активируется режим паники!
                </div>
                <div id="alarmWarning" class="alarm-warning" style="display: none;">
                    ВНИМАНИЕ! Следующая активация режима тревоги через: <span id="alarmAttemptsLeft">2</span> попыток
                </div>
            </div>
            
            <!-- Секция истории -->
            <div class="history-section">
                <h3>ИСТОРИЯ ПОПЫТОК:</h3>
                <div id="historyList" class="history-list">
                    <!-- История будет добавляться сюда -->
                </div>
            </div>
            
            <!-- Секция статистики -->
            <div class="stats-section">
                <h3>СТАТИСТИКА:</h3>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-label">СЫГРАНО ИГР</div>
                        <div class="stat-value" id="gamesPlayed">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">РЕКОРД</div>
                        <div class="stat-value" id="bestScore">-</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">МОНЕТКИ</div>
                        <div class="stat-value coins-value" id="coins">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">АНТИ-РЕКОРД</div>
                        <div class="stat-value" id="worstScore">-</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">СРЕДНЕЕ</div>
                        <div class="stat-value" id="averageAttempts">-</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">ПОСЛЕДНЯЯ</div>
                        <div class="stat-value" id="lastAttempts">-</div>
                    </div>
                </div>
            </div>

            <div class="shop-section">
                <h3>МАГАЗИН</h3>
                <p>Тратьте заработанные монетки на улучшения!</p>
                <button id="shopBtn" class="pixel-border">ОТКРЫТЬ МАГАЗИН</button>
            </div>
            
            <div class="inventory-section">
                <h3>ИНВЕНТАРЬ</h3>
                <p>Здесь отображаются ваши приобретенные улучшения</p>
                <div id="inventoryList" class="inventory-list">
                    <div class="inventory-item empty">
                        <div class="inventory-icon">📦</div>
                        <div class="inventory-name">Инвентарь пуст</div>
                        <div class="inventory-description">Купите улучшения в магазине</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="rules pixel-border-reverse">
            <h3>ПРАВИЛА ИГРЫ:</h3>
            <ul>
                <li>Компьютер загадывает случайное число от 1 до 1000</li>
                <li>Вы вводите число в поле выше и нажимаете "ПРОВЕРИТЬ"</li>
                <li>Компьютер подскажет, больше или меньше загаданное число</li>
                <li>Цель - угадать число за минимальное количество попыток</li>
                <li>За каждую игру вы получаете монетки, количество равным загаданному числу</li>
                <li>Каждая попытка стоит 1 монетку</li>
                <li>Бонусы за рекорды: ≤2 попыток = +40%, ≤6 попыток = +20%, ≤8 попыток = +15%</li>
                <li>Для начала новой игры нажмите кнопку "НОВАЯ ИГРА"</li>
                <li>Все ваши попытки сохраняются в истории ниже</li>
                <li>Диапазон возможных чисел сужается после каждой попытки</li>
                <li>Когда диапазон становится узким, он начинает светиться!</li>
                <li>При сужении диапазона до 10 чисел активируется режим паники!</li>
                <li>После 10 попыток и затем каждые 2 попытки активируется режим тревоги!</li>
                <li>Каждые 5 попыток система предлагает подсказку</li>
                <li>Режим тревоги отключается после ввода числа</li>
                <li>В магазине можно приобрести улучшения за монетки</li>
                <li>Предмет "Бонусная Сложность": каждая попытка с вероятностью 50% активирует режим тревоги на 5 секунд. Если таймер истекает, добавляется 5 попыток. Если успеваете ввести число до истечения таймера, получаете +25% монеток. Работает до 3 раз за игру.</li>
                <li>Предмет "Успокаивающие": увеличивает таймер паники до 15 секунд</li>
    <li>Предмет "Отличник": повышает вероятность появления цифры 5 в загаданном числе на 60%</li>
    <li>Предмет "Золотые Пятёрки": даёт +10 монет за каждую цифру 5 в загаданном числе</li>
    <li>Предмет "Монетка": с вероятностью 1% удваивает все бонусы в конце игры</li>
                <li>Каждую 10-ю игру взимается налог: ((-Среднее * 3) + (Число игр * 30) - Анти-Рекорд) + Бонус Рекорда%</li>
                <li>Если налог не оплачен, весь прогресс сбрасывается</li>
            </ul>
        </div>
        
        <!-- Новая секция с кнопкой сброса прогресса -->
        <div class="reset-section">
            <h3>ОПАСНАЯ ЗОНА</h3>
            <p>Нажатие этой кнопки полностью сбросит всю статистику и прогресс</p>
            <button id="resetProgressBtn" class="pixel-border">СБРОСИТЬ ВЕСЬ ПРОГРЕСС</button>
        </div>
    </div>

    <script>
        // Игровые переменные
        let targetNumber;
        let attempts;
        let gameActive;
        let guessHistory;
        const minRange = 1;
        const maxRange = 1000;
        let currentMin;
        let currentMax;
        let panicModeActive = false;
        let panicTimer;
        let panicTimeLeft = 10;
        
        // Переменные для режима тревоги
        let alarmModeActive = false;
        let alarmTimer;
        let alarmTimeLeft = 30;
        let nextAlarmAttempt = 10; // Первая активация на 10-й попытке
        
        // Переменные для системы подсказок
        let hintActive = false;
        let hintTimer;
        let hintTimeLeft = 5;
        
        // Статистика
        let gamesPlayed = 0;
        let bestScore = null;
        let worstScore = null;
        let totalAttempts = 0;
        let lastAttempts = 0;
        let coins = 0;
        
        // Система налога
        let taxActive = false;
        let taxAmount = 0;
        let taxGamesPlayed = 0;
        
        // Инвентарь и магазин
        let inventory = [];
        let shopItems = [
            {
                id: 'bonus_difficulty',
                name: 'Бонусная Сложность',
                description: 'Каждая попытка с вероятностью 50% активирует режим тревоги на 5 секунд. Если таймер истекает, +5 попыток. Если успеваете ввести число, +25% монеток. Работает до 3 раз за игру.',
                price: 1000,
                icon: '⚡',
                owned: false
            },
            {
                id: 'calming_pills',
                name: 'Успокаивающие',
                description: 'Увеличивает таймер паники до 15 секунд, давая больше времени на реакцию.',
                price: 100,
                icon: '💊',
                owned: false
            },
            // НОВЫЕ ПРЕДМЕТЫ:
            {
                id: 'switch',
                name: 'Выключатель',
                description: 'С вероятностью 50% за игру отключает режим тревоги на всю текущую игру.',
                price: 500,
                icon: '🔌',
                owned: false
            },
            {
                id: 'attempts_falsification',
                name: 'Фальсификация Попыток',
                description: 'Снижает наценку в магазине на 20%, делая товары дешевле.',
                price: 150,
                icon: '📉',
                owned: false
            },
            {
                id: 'five_bonus',
                name: 'Пятёрочка выручает',
                description: 'Добавляет бонус 35% монеток от имеющихся в конце игры, если в загаданном числе присутствует цифра 5.',
                price: 55,
                icon: '5️',
                owned: false
            },
            {
      id: 'golden_fives',
      name: 'Золотые Пятёрки',
      description: 'Даёт +10 монет за каждую цифру 5 в загаданном числе',
      price: 155,
      icon: '💰',
      owned: false
    },
    {
      id: 'excellent_student',
      name: 'Отличник',
      description: 'Повышает вероятность появления цифры 5 в загаданном числе на 60%',
      price: 100,
      icon: '🎓',
      owned: false
    },
    {
      id: 'lucky_coin',
      name: 'Монетка',
      description: 'С вероятностью 1% удваивает все бонусы в конце игры',
      price: 800,
      icon: '🪙',
      owned: false
    }
        ];
        
        // Переменные для бонусной сложности
        let bonusDifficultyActive = false;
        let bonusDifficultyTimer;
        let bonusDifficultyTimeLeft = 5;
        let bonusDifficultyUses = 0;
        const maxBonusDifficultyUses = 3;
        
        // Элементы DOM
        const guessInput = document.getElementById('guessInput');
        const guessBtn = document.getElementById('guessBtn');
        const newGameBtn = document.getElementById('newGameBtn');
        const messageEl = document.getElementById('message');
        const attemptsEl = document.getElementById('attempts');
        const historyListEl = document.getElementById('historyList');
        const rangeScaleEl = document.getElementById('rangeScale');
        const rangeCurrentEl = document.getElementById('rangeCurrent');
        const minValueEl = document.getElementById('minValue');
        const maxValueEl = document.getElementById('maxValue');
        const currentRangeEl = document.getElementById('currentRange');
        const rangeVisualizationEl = document.getElementById('rangeVisualization');
        const panicTimerEl = document.getElementById('panicTimer');
        const timerCountEl = document.getElementById('timerCount');
        const panicWarningEl = document.getElementById('panicWarning');
        const bodyEl = document.body;
        const shopBtn = document.getElementById('shopBtn');
        const shopOverlay = document.getElementById('shopOverlay');
        const shopCloseBtn = document.getElementById('shopCloseBtn');
        const shopCoinsDisplay = document.getElementById('shopCoinsDisplay');
        const shopItemsEl = document.getElementById('shopItems');
        const inventoryListEl = document.getElementById('inventoryList');
        
        // Элементы для режима тревоги
        const alarmTimerEl = document.getElementById('alarmTimer');
        const alarmTimerCountEl = document.getElementById('alarmTimerCount');
        const alarmWarningEl = document.getElementById('alarmWarning');
        const alarmAttemptsLeftEl = document.getElementById('alarmAttemptsLeft');
        
        // Элементы для подсказок
        const hintPopup = document.getElementById('hintPopup');
        const hintOverlay = document.getElementById('hintOverlay');
        const hintNumberEl = document.getElementById('hintNumber');
        const hintTimerEl = document.getElementById('hintTimer');
        
        // Элементы статистики
        const gamesPlayedEl = document.getElementById('gamesPlayed');
        const bestScoreEl = document.getElementById('bestScore');
        const worstScoreEl = document.getElementById('worstScore');
        const coinsEl = document.getElementById('coins');
        const averageAttemptsEl = document.getElementById('averageAttempts');
        const lastAttemptsEl = document.getElementById('lastAttempts');
        
        // Элементы для сброса прогресса
        const resetProgressBtn = document.getElementById('resetProgressBtn');
        const resetConfirmOverlay = document.getElementById('resetConfirmOverlay');
        const confirmResetBtn = document.getElementById('confirmResetBtn');
        const cancelResetBtn = document.getElementById('cancelResetBtn');

        // Элементы для системы налога
        const taxCounter = document.getElementById('taxCounter');
        const taxCounterValue = document.getElementById('taxCounterValue');
        const taxNotification = document.getElementById('taxNotification');
        const taxGamesPlayedEl = document.getElementById('taxGamesPlayed');
        const taxAmountEl = document.getElementById('taxAmount');
        const payTaxBtn = document.getElementById('payTaxBtn');

        // Элементы для анимаций
        const coinsEarnedAnimation = document.getElementById('coinsEarnedAnimation');
        const coinsEarnedValue = document.getElementById('coinsEarnedValue');
        const coinsBreakdown = document.getElementById('coinsBreakdown');
        const itemActivation = document.getElementById('itemActivation');
        const itemActivationIcon = document.getElementById('itemActivationIcon');
        const itemActivationText = document.getElementById('itemActivationText');

        // Функции для анимаций
  function showCoinsEarnedAnimation(coinsCalculation) {
    // Устанавливаем значение
    coinsEarnedValue.textContent = `+${coinsCalculation.total}`;
    
    // Создаем разбивку заработка
    coinsBreakdown.innerHTML = '';
    
    // Базовая сумма
    const baseItem = document.createElement('div');
    baseItem.className = 'coins-breakdown-item';
    baseItem.innerHTML = `
      <span class="coins-breakdown-label">Базовая сумма:</span>
      <span class="coins-breakdown-value coins-breakdown-positive">+${coinsCalculation.base}</span>
    `;
    coinsBreakdown.appendChild(baseItem);
    
    // Штраф за попытки
    const penaltyItem = document.createElement('div');
    penaltyItem.className = 'coins-breakdown-item';
    penaltyItem.innerHTML = `
      <span class="coins-breakdown-label">Штраф за попытки:</span>
      <span class="coins-breakdown-value coins-breakdown-negative">-${coinsCalculation.penalty}</span>
    `;
    coinsBreakdown.appendChild(penaltyItem);
    
    // Бонус за рекорд (если есть)
    if (coinsCalculation.bonusPercent > 0) {
      const bonusItem = document.createElement('div');
      bonusItem.className = 'coins-breakdown-item';
      bonusItem.innerHTML = `
        <span class="coins-breakdown-label">Бонус за рекорд (${coinsCalculation.bonusPercent}%):</span>
        <span class="coins-breakdown-value coins-breakdown-bonus">+${coinsCalculation.bonus}</span>
      `;
      coinsBreakdown.appendChild(bonusItem);
    }
    
    // Бонус "Пятёрочка" (если есть)
    if (coinsCalculation.fiveBonus > 0) {
      const fiveBonusItem = document.createElement('div');
      fiveBonusItem.className = 'coins-breakdown-item';
      fiveBonusItem.innerHTML = `
        <span class="coins-breakdown-label">Бонус "Пятёрочка":</span>
        <span class="coins-breakdown-value coins-breakdown-bonus">+${coinsCalculation.fiveBonus}</span>
      `;
      coinsBreakdown.appendChild(fiveBonusItem);
    }
    
    // НОВЫЙ БОНУС: Золотые Пятёрки (если есть)
    if (coinsCalculation.goldenFives > 0) {
      const goldenFivesItem = document.createElement('div');
      goldenFivesItem.className = 'coins-breakdown-item';
      const fivesCount = countFivesInNumber(targetNumber);
      goldenFivesItem.innerHTML = `
        <span class="coins-breakdown-label">Золотые Пятёрки (${fivesCount} × 10):</span>
        <span class="coins-breakdown-value coins-breakdown-bonus">+${coinsCalculation.goldenFives}</span>
      `;
      coinsBreakdown.appendChild(goldenFivesItem);
    }
    
    // НОВЫЙ БОНУС: Монетка (если сработала)
    if (coinsCalculation.luckyCoin) {
      const luckyCoinItem = document.createElement('div');
      luckyCoinItem.className = 'coins-breakdown-item';
      luckyCoinItem.innerHTML = `
        <span class="coins-breakdown-label">УДВОЕНИЕ МОНЕТКОЙ!</span>
        <span class="coins-breakdown-value coins-breakdown-bonus">×2</span>
      `;
      coinsBreakdown.appendChild(luckyCoinItem);
      
      // Добавляем особый эффект к анимации
      coinsEarnedValue.style.color = '#ff0';
      coinsEarnedValue.style.textShadow = '0 0 20px #ff0, 0 0 30px #ff0, 0 0 40px #ff9900';
    }
    
    // Показываем анимацию
    coinsEarnedAnimation.style.display = 'flex';
    
    // Скрываем анимацию через 3 секунды
    setTimeout(() => {
      coinsEarnedAnimation.style.display = 'none';
      // Сбрасываем стили
      coinsEarnedValue.style.color = '';
      coinsEarnedValue.style.textShadow = '';
    }, 3000);
  }
        
        function showItemActivationAnimation(itemName, itemIcon) {
            // Устанавливаем иконку и текст
            itemActivationIcon.textContent = itemIcon;
            itemActivationText.textContent = `${itemName} активирован!`;
            
            // Показываем анимацию
            itemActivation.style.display = 'flex';
            
            // Скрываем анимацию через 2 секунды
            setTimeout(() => {
                itemActivation.style.display = 'none';
            }, 2000);
        }

  function generateTargetNumber() {
    let number;
    
    // Если предмет "Отличник" куплен, увеличиваем вероятность цифры 5
    if (inventory.includes('excellent_student')) {
      // 80% шанс сгенерировать число с цифрой 5
      if (Math.random() < 0.8) {
        // Генерируем число, гарантированно содержащее цифру 5
        const numbersWithFive = [];
        
        // Собираем все числа от 1 до 1000, содержащие цифру 5
        for (let i = 1; i <= 1000; i++) {
          if (i.toString().includes('55')) {
            numbersWithFive.push(i);
          }
        }
        
        // Выбираем случайное число из этого списка
        number = numbersWithFive[Math.floor(Math.random() * numbersWithFive.length)];
      } else {
        // Обычная генерация
        number = Math.floor(Math.random() * (maxRange - minRange + 1)) + minRange;
      }
    } else {
      // Обычная генерация
      number = Math.floor(Math.random() * (maxRange - minRange + 1)) + minRange;
    }
    
    return number;
  }

  function countFivesInNumber(number) {
    return number.toString().split('').filter(digit => digit === '5').length;
  }

  // Функция для проверки срабатывания Монетки
  function checkLuckyCoin() {
    if (inventory.includes('lucky_coin') && Math.random() < 0.01) {
      return true;
    }
    return false;
  }
        
        function showPurchaseAnimation(itemElement) {
            // Создаем элемент анимации покупки
            const purchaseAnimation = document.createElement('div');
            purchaseAnimation.className = 'purchase-animation';
            
            const purchaseText = document.createElement('div');
            purchaseText.className = 'purchase-text';
            purchaseText.textContent = 'КУПЛЕНО!';
            
            purchaseAnimation.appendChild(purchaseText);
            itemElement.appendChild(purchaseAnimation);
            
            // Удаляем анимацию после завершения
            setTimeout(() => {
                purchaseAnimation.remove();
            }, 1000);
        }

        // Функции для системы налога
        function calculateTax() {
            // Формула налога: ((-Среднее * 3) + (Число игр * 40) - Анти-Рекорд) + Бонус Рекорда%
            const average = gamesPlayed > 0 ? totalAttempts / gamesPlayed : 0;
            const gamesCount = taxGamesPlayed; // Число игр, на которое приходит налог (10, 20, 30...)
            const worst = worstScore || 0;
            
            // Бонус рекорда%
            let bonusPercent = 0;
            if (bestScore !== null) {
                if (bestScore <= 2) {
                    bonusPercent = 40;
                } else if (bestScore <= 6) {
                    bonusPercent = 20;
                } else if (bestScore <= 8) {
                    bonusPercent = 15;
                }
            }
            
            // Расчет налога
            let tax = ((-average * 3) + (gamesCount * 30) - worst);
            
            // Добавляем бонус рекорда%
            tax = tax + (tax * bonusPercent / 100);
            
            // Округляем и убеждаемся, что налог не отрицательный
            tax = Math.round(Math.max(0, tax));
            
            return tax;
        }
        
        function checkTax() {
            // Проверяем, не настало ли время для налога (каждые 10 игр)
            if (gamesPlayed > 0 && gamesPlayed % 10 === 0 && gamesPlayed !== taxGamesPlayed) {
                taxGamesPlayed = gamesPlayed;
                taxAmount = calculateTax();
                activateTax();
            }
            
            // Обновляем счетчик до следующего налога
            updateTaxCounter();
        }
        
        function updateTaxCounter() {
            if (taxActive) {
                taxCounter.classList.remove('show');
                return;
            }
            
            const gamesUntilTax = 10 - (gamesPlayed % 10);
            taxCounterValue.textContent = gamesUntilTax;
            
            if (gamesUntilTax < 10) {
                taxCounter.classList.add('show');
            } else {
                taxCounter.classList.remove('show');
            }
        }
        
        function activateTax() {
            taxActive = true;
            
            // Блокируем игровые кнопки
            guessInput.disabled = true;
            guessBtn.disabled = true;
            newGameBtn.disabled = true;
            
            // Показываем уведомление о налоге
            taxGamesPlayedEl.textContent = taxGamesPlayed;
            taxAmountEl.textContent = `${taxAmount} монеток`;
            taxNotification.classList.add('active');
            
            // Сохраняем состояние налога
            saveStats();
        }
        
        function payTax() {
            if (coins >= taxAmount) {
                // Списываем налог
                coins -= taxAmount;
                
                // Деактивируем налог
                taxActive = false;
                taxNotification.classList.remove('active');
                
                // Разблокируем игровые кнопки
                guessInput.disabled = false;
                guessBtn.disabled = false;
                newGameBtn.disabled = false;
                
                // Обновляем отображение статистики
                updateStatsDisplay(true);
                
                // Сохраняем состояние
                saveStats();
                
                // Показываем сообщение
                messageEl.textContent = `Налог оплачен! Списано ${taxAmount} монеток.`;
                messageEl.className = 'message success';
            } else {
                // Недостаточно монеток для оплаты налога - сбрасываем прогресс
                messageEl.textContent = 'Недостаточно монеток для оплаты налога! Прогресс будет сброшен.';
                messageEl.className = 'message hint';
                
                // Сбрасываем прогресс через небольшую задержку
                setTimeout(resetProgress, 3000);
            }
        }
        
        // Функции для магазина
        function openShop() {
            updateShopDisplay();
            shopOverlay.classList.add('active');
        }
        
        function closeShop() {
            shopOverlay.classList.remove('active');
        }
        
        function updateShopDisplay() {
            // Обновляем отображение монеток в магазине
            shopCoinsDisplay.textContent = coins;
            
            // Обновляем наценку
            const shopMarkupEl = document.getElementById('shopMarkup');
            let markup = 0;
            
            if (gamesPlayed > 0) {
                // Наценка равна среднему количеству попыток (округляем до целого)
                markup = Math.round(totalAttempts / gamesPlayed);
            }
            
            // НОВЫЙ ЭФФЕКТ: Фальсификация Попыток снижает наценку на 20%
            if (inventory.includes('attempts_falsification')) {
                markup = markup - 20;
            }
            
            shopMarkupEl.textContent = `${markup}%`;
            
            // Обновляем список товаров
            renderShopItems(markup);
        }
        
        function renderShopItems(markup) {
            shopItemsEl.innerHTML = '';
            
            shopItems.forEach(item => {
                const shopItemEl = document.createElement('div');
                shopItemEl.className = 'shop-item';
                if (item.owned) {
                    shopItemEl.classList.add('purchased');
                }
                
                const owned = inventory.includes(item.id);
                
                // Рассчитываем окончательную цену с учетом наценки
                const finalPrice = Math.round(item.price * (1 + markup / 100));
                
                shopItemEl.innerHTML = `
                    <div class="shop-item-name">${item.icon} ${item.name}</div>
                    <div class="shop-item-description">${item.description}</div>
                    <div class="shop-item-price">
                        <span class="shop-original-price">${item.price} монеток</span>
                        <span class="shop-final-price">${finalPrice} монеток</span>
                    </div>
                    <div class="shop-markup-note">(Наценка: +${markup}%)</div>
                    ${owned ? 
                        '<div class="shop-item-owned">✓ УЖЕ КУПЛЕНО</div>' : 
                        `<button class="shop-buy-btn" data-item="${item.id}" data-price="${finalPrice}" ${coins < finalPrice ? 'disabled' : ''}>КУПИТЬ</button>`
                    }
                `;
                
                shopItemsEl.appendChild(shopItemEl);
            });
            
            // Добавляем обработчики событий для кнопок покупки
            document.querySelectorAll('.shop-buy-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const itemId = this.getAttribute('data-item');
                    const price = parseInt(this.getAttribute('data-price'));
                    buyItem(itemId, price, this.closest('.shop-item'));
                });
            });
        }
        
        function buyItem(itemId, price, itemElement) {
            const item = shopItems.find(i => i.id === itemId);
            
            if (!item) return;
            
            if (coins < price) {
                messageEl.textContent = 'Недостаточно монеток для покупки!';
                messageEl.className = 'message hint';
                return;
            }
            
            if (inventory.includes(itemId)) {
                messageEl.textContent = 'Этот предмет уже куплен!';
                messageEl.className = 'message hint';
                return;
            }
            
            // Покупка предмета
            coins -= price;
            inventory.push(itemId);
            item.owned = true;
            
            // Показываем анимацию покупки
            showPurchaseAnimation(itemElement);
            
            // Сохраняем обновленные данные
            saveStats();
            updateStatsDisplay(true);
            updateShopDisplay();
            updateInventoryDisplay();
            
            messageEl.textContent = `Поздравляем! Вы купили "${item.name}"!`;
            messageEl.className = 'message success';
            
            // Показываем анимацию активации предмета
            setTimeout(() => {
                showItemActivationAnimation(item.name, item.icon);
            }, 500);
            
            // Закрываем магазин после покупки
            setTimeout(() => {
                closeShop();
            }, 1500);
        }
        
        // Функции для инвентаря
        function updateInventoryDisplay() {
            inventoryListEl.innerHTML = '';
            
            if (inventory.length === 0) {
                inventoryListEl.innerHTML = `
                    <div class="inventory-item empty">
                        <div class="inventory-icon">📦</div>
                        <div class="inventory-name">Инвентарь пуст</div>
                        <div class="inventory-description">Купите улучшения в магазине</div>
                    </div>
                `;
                return;
            }
            
            inventory.forEach(itemId => {
                const item = shopItems.find(i => i.id === itemId);
                if (!item) return;
                
                const inventoryItemEl = document.createElement('div');
                inventoryItemEl.className = 'inventory-item';
                
                // Добавляем класс активности для предметов, которые могут быть активны
                if (itemId === 'bonus_difficulty' && bonusDifficultyActive) {
                    inventoryItemEl.classList.add('active');
                }
                
                inventoryItemEl.innerHTML = `
                    <div class="inventory-icon">${item.icon}</div>
                    <div class="inventory-name">${item.name}</div>
                    <div class="inventory-description">${item.description}</div>
                `;
                
                inventoryListEl.appendChild(inventoryItemEl);
            });
        }
        
        // Функции для бонусной сложности
        function activateBonusDifficulty() {
            if (bonusDifficultyActive || !inventory.includes('bonus_difficulty') || bonusDifficultyUses >= maxBonusDifficultyUses) return;
            
            // С вероятностью 50% активируем бонусную сложность
            if (Math.random() < 0.5) {
                bonusDifficultyActive = true;
                bonusDifficultyUses++;
                
                // Показываем анимацию активации
                showItemActivationAnimation('Бонусная Сложность', '⚡');
                
                bodyEl.classList.add('alarm-mode');
                alarmTimerEl.classList.add('active');
                bonusDifficultyTimeLeft = 5;
                alarmTimerCountEl.textContent = bonusDifficultyTimeLeft;
                
                // Обновляем текст для бонусной сложности
                document.querySelector('.alarm-timer .timer-text').textContent = 'БОНУСНАЯ СЛОЖНОСТЬ!';
                document.querySelectorAll('.alarm-timer .timer-text')[1].textContent = '+25% монеток если успеете!';
                
                // Обновляем инвентарь для отображения активности предмета
                updateInventoryDisplay();
                
                // Запускаем таймер
                bonusDifficultyTimer = setInterval(function() {
                    bonusDifficultyTimeLeft--;
                    alarmTimerCountEl.textContent = bonusDifficultyTimeLeft;
                    
                    if (bonusDifficultyTimeLeft <= 0) {
                        deactivateBonusDifficulty(false);
                        attempts += 5;
                        attemptsEl.textContent = `Попытки: ${attempts}`;
                        messageEl.textContent = 'Время вышло! +5 попыток!';
                        messageEl.className = 'message hint';
                    }
                }, 1000);
            }
        }
        
        function deactivateBonusDifficulty(success) {
            bonusDifficultyActive = false;
            bodyEl.classList.remove('alarm-mode');
            alarmTimerEl.classList.remove('active');
            clearInterval(bonusDifficultyTimer);
            
            // Обновляем инвентарь для снятия активности предмета
            updateInventoryDisplay();
            
            // Восстанавливаем стандартный текст для режима тревоги
            document.querySelector('.alarm-timer .timer-text').textContent = 'РЕЖИМ ТРЕВОГИ!';
            document.querySelectorAll('.alarm-timer .timer-text')[1].textContent = '+10 попыток через:';
            
            if (success) {
                // Начисляем бонусные монетки
                const bonusCoins = Math.floor(coins * 0.25);
                coins += bonusCoins;
                updateStatsDisplay(true);
                messageEl.textContent = `Отлично! Вы успели! +${bonusCoins} монеток!`;
                messageEl.className = 'message success';
            }
        }
        
        // Функция сброса прогресса
        function resetProgress() {
            // Сброс статистики
            gamesPlayed = 0;
            bestScore = null;
            worstScore = null;
            totalAttempts = 0;
            lastAttempts = 0;
            coins = 0;
            inventory = [];
            taxActive = false;
            taxGamesPlayed = 0;
            
            // Сброс состояния предметов магазина
            shopItems.forEach(item => {
                item.owned = false;
            });
            
            // Очистка localStorage
            localStorage.removeItem('project500_stats');
            
            // Обновление отображения статистики
            updateStatsDisplay();
            updateInventoryDisplay();
            updateTaxCounter();
            
            // Скрываем уведомление о налоге
            taxNotification.classList.remove('active');
            
            // Перезапуск игры
            initGame();
            
            // Закрытие окна подтверждения
            resetConfirmOverlay.classList.remove('active');
            
            // Показ сообщения о сбросе
            messageEl.textContent = 'ПРОГРЕСС СБРОШЕН!';
            messageEl.className = 'message hint';
        }
        
        // Показать окно подтверждения сброса
        function showResetConfirm() {
            resetConfirmOverlay.classList.add('active');
        }
        
        // Скрыть окно подтверждения сброса
        function hideResetConfirm() {
            resetConfirmOverlay.classList.remove('active');
        }
        
        // Функции для системы подсказок
        function showHint() {
            if (!gameActive || hintActive || taxActive) return;
            
            // Вычисляем подсказку - среднее между текущим минимумом и максимумом
            const hintNumber = Math.round((currentMin + currentMax) / 2);
            hintNumberEl.textContent = hintNumber;
            hintTimeLeft = 5;
            hintTimerEl.textContent = hintTimeLeft;
            
            // Активируем подсказку
            hintActive = true;
            hintOverlay.classList.add('active');
            hintPopup.classList.add('active');
            
            // Если активен режим паники или тревоги, добавляем соответствующий стиль
            if (panicModeActive) {
                hintPopup.classList.add('panic-mode');
            } else if (alarmModeActive || bonusDifficultyActive) {
                hintPopup.classList.add('alarm-mode');
            } else {
                hintPopup.classList.remove('panic-mode', 'alarm-mode');
            }
            
            // Запускаем таймер подсказки
            hintTimer = setInterval(function() {
                hintTimeLeft--;
                hintTimerEl.textContent = hintTimeLeft;
                
                if (hintTimeLeft <= 0) {
                    hideHint();
                }
            }, 1000);
        }
        
        function hideHint() {
            hintActive = false;
            hintOverlay.classList.remove('active');
            hintPopup.classList.remove('active');
            clearInterval(hintTimer);
        }
        
        // Функции для режима тревоги
        function activateAlarmMode() {
            // НОВАЯ ПРОВЕРКА: Выключатель
            if (inventory.includes('switch')) {
                // С вероятностью 50% отключаем режим тревоги на всю игру
                if (Math.random() < 0.5) {
                    // Отключаем режим тревоги на эту игру
                    nextAlarmAttempt = 99999; // Очень большое число, чтобы тревога не активировалась
                    messageEl.textContent = 'ВЫКЛЮЧАТЕЛЬ СРАБОТАЛ! Режим тревоги отключен на эту игру!';
                    messageEl.className = 'message success';
                    return;
                }
            }
            
            if (alarmModeActive || (currentMax - currentMin) < 15 || bonusDifficultyActive || taxActive) return;
            
            alarmModeActive = true;
            bodyEl.classList.add('alarm-mode');
            alarmTimerEl.classList.add('active');
            alarmTimeLeft = 20;
            alarmTimerCountEl.textContent = alarmTimeLeft;
            
            // Если подсказка активна, обновляем ее стиль
            if (hintActive) {
                hintPopup.classList.add('alarm-mode');
            }
            
            // Запускаем таймер
            alarmTimer = setInterval(function() {
                alarmTimeLeft--;
                alarmTimerCountEl.textContent = alarmTimeLeft;
                
                if (alarmTimeLeft <= 0) {
                    deactivateAlarmMode();
                    attempts += 15;
                    attemptsEl.textContent = `Попытки: ${attempts}`;
                    messageEl.textContent = 'РЕЖИМ ТРЕВОГИ ЗАВЕРШЕН! +15 попыток!';
                    messageEl.className = 'message hint';
                    
                    // Устанавливаем следующую активацию через 2 попытки
                    nextAlarmAttempt = attempts + 2;
                }
            }, 1000);
        }
        
        function deactivateAlarmMode() {
            alarmModeActive = false;
            bodyEl.classList.remove('alarm-mode');
            alarmTimerEl.classList.remove('active');
            clearInterval(alarmTimer);
            
            // Если подсказка активна, убираем стиль тревоги
            if (hintActive) {
                hintPopup.classList.remove('alarm-mode');
            }
        }
        
        // Функции для режима паники
        function activatePanicMode() {
            if (panicModeActive || taxActive) return;
            
            panicModeActive = true;
            bodyEl.classList.add('panic-mode', 'shake-screen');
            panicTimerEl.classList.add('active');
            
            // Устанавливаем время паники в зависимости от наличия предмета "Успокаивающие"
            panicTimeLeft = inventory.includes('calming_pills') ? 15 : 10;
            timerCountEl.textContent = panicTimeLeft;
            
            // Если подсказка активна, обновляем ее стиль
            if (hintActive) {
                hintPopup.classList.add('panic-mode');
            }
            
            // Запускаем таймер
            panicTimer = setInterval(function() {
                panicTimeLeft--;
                timerCountEl.textContent = panicTimeLeft;
                
                if (panicTimeLeft <= 0) {
                    deactivatePanicMode();
                    attempts += 10;
                    attemptsEl.textContent = `Попытки: ${attempts}`;
                    messageEl.textContent = 'РЕЖИМ ПАНИКИ ЗАВЕРШЕН! +10 попыток!';
                    messageEl.className = 'message hint';
                }
            }, 1000);
        }
        
        function deactivatePanicMode() {
            panicModeActive = false;
            bodyEl.classList.remove('panic-mode', 'shake-screen');
            panicTimerEl.classList.remove('active');
            clearInterval(panicTimer);
            
            // Если подсказка активна, убираем стиль паники
            if (hintActive) {
                hintPopup.classList.remove('panic-mode');
            }
        }
        
        // Загрузка статистики из localStorage
        function loadStats() {
            const savedStats = localStorage.getItem('project500_stats');
            if (savedStats) {
                const stats = JSON.parse(savedStats);
                gamesPlayed = stats.gamesPlayed || 0;
                bestScore = stats.bestScore || null;
                worstScore = stats.worstScore || null;
                totalAttempts = stats.totalAttempts || 0;
                lastAttempts = stats.lastAttempts || 0;
                coins = stats.coins || 0;
                inventory = stats.inventory || [];
                taxActive = stats.taxActive || false;
                taxGamesPlayed = stats.taxGamesPlayed || 0;
                
                // Обновляем состояние предметов магазина
                shopItems.forEach(item => {
                    item.owned = inventory.includes(item.id);
                });
                
                // Если налог активен, активируем его
                if (taxActive) {
                    taxAmount = calculateTax();
                    activateTax();
                }
            }
            updateStatsDisplay();
            updateInventoryDisplay();
            updateTaxCounter();
        }
        
        // Сохранение статистики в localStorage
        function saveStats() {
            const stats = {
                gamesPlayed,
                bestScore,
                worstScore,
                totalAttempts,
                lastAttempts,
                coins,
                inventory,
                taxActive,
                taxGamesPlayed
            };
            localStorage.setItem('project500_stats', JSON.stringify(stats));
        }
        
        // Функция для обновления отображения монеток с анимацией
        function updateCoinsDisplay(withAnimation = false) {
            if (withAnimation) {
                coinsEl.classList.add('coins-count-up');
                setTimeout(() => {
                    coinsEl.classList.remove('coins-count-up');
                }, 500);
            }
            
            coinsEl.textContent = coins;
            
            // Обновляем отображение монеток в магазине, если он открыт
            if (shopOverlay.classList.contains('active')) {
                shopCoinsDisplay.textContent = coins;
            }
        }
        
        // Обновление отображения статистики
        function updateStatsDisplay(withCoinAnimation = false) {
            gamesPlayedEl.textContent = gamesPlayed;
            
            if (bestScore !== null) {
                bestScoreEl.textContent = bestScore;
            } else {
                bestScoreEl.textContent = '-';
            }
            
            if (worstScore !== null) {
                worstScoreEl.textContent = worstScore;
            } else {
                worstScoreEl.textContent = '-';
            }
            
            // Обновляем отображение монеток с возможной анимацией
            updateCoinsDisplay(withCoinAnimation);
            
            if (gamesPlayed > 0) {
                const average = (totalAttempts / gamesPlayed).toFixed(1);
                averageAttemptsEl.textContent = average;
            } else {
                averageAttemptsEl.textContent = '-';
            }
            
            if (lastAttempts > 0) {
                lastAttemptsEl.textContent = lastAttempts;
            } else {
                lastAttemptsEl.textContent = '-';
            }
        }
        
  function calculateCoinsEarned() {
    // Базовое количество монеток пропорционально загаданному числу
    let baseCoins = Math.floor(targetNumber / 10);
    
    // Вычитаем 1 монетку за каждую попытку
    let coinsEarned = baseCoins - attempts;
    
    // Не позволяем уйти в отрицательное значение
    if (coinsEarned < 0) coinsEarned = 0;
    
    // Применяем бонусы за рекорд
    let bonusPercent = 0;
    if (bestScore <= 2) {
      bonusPercent = 40; // +40% за 2 и менее попыток
    } else if (bestScore <= 6) {
      bonusPercent = 20;  // +20% за 6 и менее попыток
    } else if (bestScore <= 8) {
      bonusPercent = 15;  // +15% за 8 и менее попыток
    }
    
    // Добавляем бонус за рекорд
    const bonusAmount = Math.floor(coinsEarned * bonusPercent / 100);
    coinsEarned += bonusAmount;
    
    // Бонус "Пятёрочка выручает"
    let fiveBonusAmount = 0;
    if (inventory.includes('five_bonus')) {
      // Проверяем, есть ли цифра 5 в загаданном числе
      const targetString = targetNumber.toString();
      if (targetString.includes('5')) {
        fiveBonusAmount = Math.floor(coinsEarned * 0.35);
        coinsEarned += fiveBonusAmount;
      }
    }
    
    // НОВЫЙ БОНУС: Золотые Пятёрки
    let goldenFivesBonus = 0;
    if (inventory.includes('golden_fives')) {
      const fivesCount = countFivesInNumber(targetNumber);
      goldenFivesBonus = fivesCount * 10;
      coinsEarned += goldenFivesBonus;
    }
    
    // НОВЫЙ БОНУС: Монетка (удвоение всех бонусов с вероятностью 1%)
    let luckyCoinMultiplier = 1;
    let luckyCoinActive = false;
    if (checkLuckyCoin()) {
      luckyCoinMultiplier = 2;
      luckyCoinActive = true;
      // Удваиваем только бонусные части, а не базовые монетки
      const basePart = baseCoins - attempts;
      const bonusPart = coinsEarned - basePart;
      coinsEarned = basePart + (bonusPart * 2);
    }
    
    return {
      base: baseCoins,
      penalty: attempts,
      bonus: bonusAmount,
      total: coinsEarned,
      bonusPercent: bonusPercent,
      fiveBonus: fiveBonusAmount,
      goldenFives: goldenFivesBonus,
      luckyCoin: luckyCoinActive,
      luckyCoinMultiplier: luckyCoinMultiplier
    };
  }
        
        // Обновление статистики после победы
  function updateStats() {
    gamesPlayed++;
    totalAttempts += attempts;
    lastAttempts = attempts;
    
    if (bestScore === null || attempts < bestScore) {
      bestScore = attempts;
    }
    
    if (worstScore === null || attempts > worstScore) {
      worstScore = attempts;
    }
    
    // Расчет заработанных монеток
    const coinsCalculation = calculateCoinsEarned();
    
    // Показываем анимацию зачисления монет
    showCoinsEarnedAnimation(coinsCalculation);
    
    coins += coinsCalculation.total;
    
    // Обновляем статистику с анимацией для монеток
    updateStatsDisplay(true);
    saveStats();
    
    // Проверяем, не настало ли время для налога
    checkTax();
    
    // Показываем сообщение о победе с информацией о монетках
    let messageHTML = `ПОЗДРАВЛЯЕМ! Вы угадали число ${targetNumber} за ${attempts} попыток!<br>Получено монеток: ${coinsCalculation.total} (базово: ${coinsCalculation.base} - штраф: ${coinsCalculation.penalty}`;
    
    if (coinsCalculation.bonusPercent > 0) {
      messageHTML += ` + бонус ${coinsCalculation.bonusPercent}%: ${coinsCalculation.bonus}`;
    }
    
    // Добавляем информацию о бонусе "Пятёрочка выручает"
    if (coinsCalculation.fiveBonus > 0) {
      messageHTML += ` + бонус "Пятёрочка": ${coinsCalculation.fiveBonus}`;
    }
    
    // НОВОЕ: Добавляем информацию о бонусе "Золотые Пятёрки"
    if (coinsCalculation.goldenFives > 0) {
      const fivesCount = countFivesInNumber(targetNumber);
      messageHTML += ` + Золотые Пятёрки (${fivesCount}×10): ${coinsCalculation.goldenFives}`;
    }
    
    // НОВОЕ: Добавляем информацию о срабатывании Монетки
    if (coinsCalculation.luckyCoin) {
      messageHTML += ` + УДВОЕНИЕ МОНЕТКОЙ!`;
    }
    
    messageHTML += `)`;
    
    messageEl.innerHTML = messageHTML;
    
    // НОВОЕ: Специальное сообщение если сработала Монетка
    if (coinsCalculation.luckyCoin) {
      setTimeout(() => {
        messageEl.innerHTML += `<br><span style="color: #ff0; text-shadow: 0 0 10px #ff0;">✨ УДАЧА! МОНЕТКА УДВОИЛА ВАШИ БОНУСЫ! ✨</span>`;
      }, 1000);
    }
  }
        
        // Инициализация игры
        function initGame() {
            // Если активен налог, не начинаем новую игру
            if (taxActive) {
                messageEl.textContent = 'Сначала оплатите налог для продолжения игры!';
                messageEl.className = 'message hint';
                return;
            }
            
            currentMin = minRange;
            currentMax = maxRange;
            targetNumber = Math.floor(Math.random() * (maxRange - minRange + 1)) + minRange;
            attempts = 0;
            gameActive = true;
            guessHistory = [];
            
            // Сбрасываем режимы
            deactivatePanicMode();
            deactivateAlarmMode();
            deactivateBonusDifficulty(false);
            hideHint();
            
            // Сбрасываем счетчик использования бонусной сложности
            bonusDifficultyUses = 0;
            
            // Сбрасываем следующую активацию тревоги
            nextAlarmAttempt = 10;
    targetNumber = generateTargetNumber();
            
            // Обновление UI
            messageEl.textContent = '';
            messageEl.className = 'message';
            attemptsEl.textContent = 'Попытки: 0';
            historyListEl.innerHTML = '';
            guessInput.value = '';
            guessInput.disabled = false;
            guessBtn.disabled = false;
            guessInput.min = minRange;
            guessInput.max = maxRange;
            guessInput.placeholder = `Введите число от ${minRange} до ${maxRange}`;
            panicWarningEl.style.display = 'none';
            alarmWarningEl.style.display = 'none';
            
            // Убираем эффект свечения диапазона
            rangeVisualizationEl.classList.remove('narrow-range');
            
            // Обновление визуализации диапазона
            updateRangeVisualization();
            
            // Фокус на поле ввода
            guessInput.focus();
            
            console.log('Загаданное число: ' + targetNumber); // Для отладки
        }
        
        // Обновление визуализации диапазона
        function updateRangeVisualization() {
            // Очистка предыдущих маркеров
            const markers = document.querySelectorAll('.range-marker');
            markers.forEach(marker => marker.remove());
            
            // Обновление текущего диапазона
            const rangeWidth = ((currentMax - currentMin) / (maxRange - minRange)) * 100;
            const rangeLeft = ((currentMin - minRange) / (maxRange - minRange)) * 100;
            
            rangeCurrentEl.style.width = rangeWidth + '%';
            rangeCurrentEl.style.left = rangeLeft + '%';
            
            // Обновление статистики
            minValueEl.textContent = currentMin;
            maxValueEl.textContent = currentMax;
            currentRangeEl.textContent = `${currentMin}-${currentMax}`;
            
            // Проверка на узкий диапазон для эффекта свечения
            const rangeDiff = currentMax - currentMin;
            if (rangeDiff <= 50) {
                rangeVisualizationEl.classList.add('narrow-range');
            } else {
                rangeVisualizationEl.classList.remove('narrow-range');
            }
            
            // Проверка на активацию режима паники
            if (rangeDiff <= 10 && gameActive && !panicModeActive && !taxActive) {
                activatePanicMode();
            }
            
            // Показ предупреждения о приближающемся режиме паники
            if (rangeDiff <= 20 && rangeDiff > 10 && gameActive && !panicModeActive && !taxActive) {
                panicWarningEl.style.display = 'block';
            } else {
                panicWarningEl.style.display = 'none';
            }
            
            // Показ предупреждения о приближающемся режиме тревоги
            if (attempts >= 8 && attempts < nextAlarmAttempt && gameActive && !alarmModeActive && rangeDiff >= 10 && !taxActive) {
                alarmWarningEl.style.display = 'block';
                alarmAttemptsLeftEl.textContent = nextAlarmAttempt - attempts;
            } else {
                alarmWarningEl.style.display = 'none';
            }
            
            // Добавление маркеров для каждой попытки
            guessHistory.forEach(attempt => {
                const marker = document.createElement('div');
                marker.className = 'range-marker';
                
                // Позиционирование маркера
                const markerPosition = ((attempt.guess - minRange) / (maxRange - minRange)) * 100;
                marker.style.left = markerPosition + '%';
                
                // Определение типа маркера
                if (attempt.result === 'correct') {
                    marker.classList.add('correct');
                } else if (attempt.result === 'higher') {
                    marker.classList.add('higher');
                } else {
                    marker.classList.add('lower');
                }
                
                // Добавление подписи
                const label = document.createElement('div');
                label.className = 'marker-label';
                label.textContent = attempt.guess;
                marker.appendChild(label);
                
                rangeScaleEl.appendChild(marker);
            });
        }
        
        // Обновление истории
        function updateHistory() {
            historyListEl.innerHTML = '';
            
            if (guessHistory.length === 0) {
                historyListEl.innerHTML = '<div class="history-item">История пуста</div>';
                return;
            }
            
            // Показываем историю в обратном порядке (последние попытки сверху)
            guessHistory.slice().reverse().forEach(item => {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                
                let resultText = '';
                if (item.result === 'correct') {
                    resultText = '✓ УГАДАЛ';
                } else if (item.result === 'higher') {
                    resultText = '↑ БОЛЬШЕ';
                } else {
                    resultText = '↓ МЕНЬШЕ';
                }
                
                historyItem.textContent = `Попытка ${item.attempt}: ${item.guess} - ${resultText}`;
                historyListEl.appendChild(historyItem);
            });
        }
        
        // Обработка попытки угадать
        function makeGuess() {
            if (!gameActive || taxActive) return;
            
            // Если активно окно подсказки, скрываем его
            if (hintActive) {
                hideHint();
            }
            
            // Если активна бонусная сложность, деактивируем ее с успехом
            if (bonusDifficultyActive) {
                deactivateBonusDifficulty(true);
            }
            
            // Отключаем режим тревоги при вводе числа
            if (alarmModeActive) {
                deactivateAlarmMode();
                // Устанавливаем следующую активацию через 2 попытки
                nextAlarmAttempt = attempts + 2;
            }
            
            const userGuess = parseInt(guessInput.value);
            
            // Проверка ввода
            if (isNaN(userGuess) || userGuess < minRange || userGuess > maxRange) {
                messageEl.textContent = `Пожалуйста, введите число от ${minRange} до ${maxRange}!`;
                messageEl.className = 'message hint';
                return;
            }
            
            attempts++;
            attemptsEl.textContent = `Попытки: ${attempts}`;
            
            // Проверяем, нужно ли активировать режим тревоги
            if (attempts === nextAlarmAttempt && (currentMax - currentMin) >= 10 && !taxActive) {
                activateAlarmMode();
            }
            
            // Проверяем, нужно ли показать подсказку (каждые 5 попыток)
            if (attempts % 5 === 0 && attempts > 0 && !taxActive) {
                // Показываем подсказку через небольшую задержку
                setTimeout(showHint, 500);
            }
            
            // Проверяем, нужно ли активировать бонусную сложность
            if (inventory.includes('bonus_difficulty') && bonusDifficultyUses < maxBonusDifficultyUses && !taxActive) {
                activateBonusDifficulty();
            }
            
            // Записываем попытку в историю
            let result;
            if (userGuess === targetNumber) {
                result = 'correct';
                gameActive = false;
                guessInput.disabled = true;
                guessBtn.disabled = true;
                
                // Деактивируем режимы при победе
                deactivatePanicMode();
                deactivateAlarmMode();
                deactivateBonusDifficulty(false);
                hideHint();
                
                // Обновляем статистику
                updateStats();
                
                messageEl.className = 'message success';
            } else if (userGuess < targetNumber) {
                result = 'higher';
                messageEl.textContent = 'Загаданное число БОЛЬШЕ!';
                messageEl.className = 'message hint';
                // Обновляем минимальное значение диапазона
                if (userGuess > currentMin) {
                    currentMin = userGuess + 1;
                }
            } else {
                result = 'lower';
                messageEl.textContent = 'Загаданное число МЕНЬШЕ!';
                messageEl.className = 'message hint';
                // Обновляем максимальное значение диапазона
                if (userGuess < currentMax) {
                    currentMax = userGuess - 1;
                }
            }
            
            // Добавляем попытку в историю
            guessHistory.push({
                attempt: attempts,
                guess: userGuess,
                result: result
            });
            
            // Обновляем отображение истории и диапазона
            updateHistory();
            updateRangeVisualization();
            
            guessInput.value = '';
            guessInput.focus();
        }
        
        // Обработчики событий
        guessBtn.addEventListener('click', makeGuess);
        
        newGameBtn.addEventListener('click', initGame);
        
        guessInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                makeGuess();
            }
        });
        
        // Закрытие подсказки при клике на оверлей
        hintOverlay.addEventListener('click', hideHint);
        
        // Обработчики для сброса прогресса
        resetProgressBtn.addEventListener('click', showResetConfirm);
        cancelResetBtn.addEventListener('click', hideResetConfirm);
        confirmResetBtn.addEventListener('click', resetProgress);
        
        // Закрытие окна подтверждения при клике на оверлей
        resetConfirmOverlay.addEventListener('click', function(e) {
            if (e.target === resetConfirmOverlay) {
                hideResetConfirm();
            }
        });
        
        // Обработчики событий для магазина
        shopBtn.addEventListener('click', openShop);
        shopCloseBtn.addEventListener('click', closeShop);
        
        // Закрытие магазина при клике на оверлей
        shopOverlay.addEventListener('click', function(e) {
            if (e.target === shopOverlay) {
                closeShop();
            }
        });
        
        // Обработчик для оплаты налога
        payTaxBtn.addEventListener('click', payTax);
        
        // Начало игры при загрузке страницы
        window.onload = function() {
            loadStats();
            initGame();
        };
    </script>
</body>
</html>
