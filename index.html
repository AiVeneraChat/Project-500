<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Project 500 | HTML Edition</title>
    <style>
        /* ===========================================
           БАЗОВЫЕ СТИЛИ И ПЕРЕМЕННЫЕ
           =========================================== */

        /* CSS-переменные для цветов и переходов */
        :root {
            --primary-color: #0f0;      /* Основной зеленый */
            --secondary-color: #0a0;    /* Темно-зеленый */
            --background-color: #000;   /* Черный фон */
            --container-bg: #111;       /* Темно-серый контейнер */
            --game-area-bg: #050505;    /* Темный фон игровой зоны */
            --text-color: #0f0;         /* Зеленый текст */
            --accent-color: #0ff;       /* Голубой акцент */
            --danger-color: #f00;       /* Красный опасность */
            --warning-color: #ff0;      /* Желтый предупреждение */
            --success-color: #0f0;      /* Зеленый успех */
            --transition-fast: 0.2s;   /* Быстрый переход */
            --transition-medium: 0.4s; /* Средний переход */
            --transition-slow: 0.8s;   /* Медленный переход */
            --glow-intensity: 5px;     /* Интенсивность свечения */
        }

        /* Универсальные правила сброса */
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        /* Стили основного документа */
        body {
            font-family: 'Courier New', Courier, monospace;
            margin: 0;
            padding: 15px;
            background-color: var(--background-color);
            color: var(--text-color);
            image-rendering: pixelated;
            position: relative;
            overflow-x: hidden;
            min-height: 100vh;
            font-size: 16px;
            line-height: 1.4;
            transition: all var(--transition-medium) ease;
        }

        /* Эффект старого ЭЛТ-монитора */
        .crt-effect::before {
            content: " ";
            display: block;
            position: fixed;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%),
                        linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 2px, 3px 100%;
            z-index: 10000;
            pointer-events: none;
        }
        
        .crt-effect::after {
            content: " ";
            display: block;
            position: fixed;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.1);
            opacity: 0;
            z-index: 10001;
            pointer-events: none;
            animation: flicker 0.15s infinite;
        }
        
        @keyframes flicker {
            0% { opacity: 0.1; }
            5% { opacity: 0.1; }
            10% { opacity: 0.2; }
            15% { opacity: 0.1; }
            20% { opacity: 0.3; }
            25% { opacity: 0.1; }
            30% { opacity: 0.2; }
            35% { opacity: 0.1; }
            40% { opacity: 0.2; }
            45% { opacity: 0.1; }
            50% { opacity: 0.3; }
            55% { opacity: 0.1; }
            60% { opacity: 0.2; }
            65% { opacity: 0.1; }
            70% { opacity: 0.1; }
            75% { opacity: 0.2; }
            80% { opacity: 0.1; }
            85% { opacity: 0.2; }
            90% { opacity: 0.1; }
            95% { opacity: 0.3; }
            100% { opacity: 0.1; }
        }
        
        .scan-line {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: rgba(0, 255, 0, 0.3);
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.5);
            z-index: 9999;
            pointer-events: none;
            animation: scan 3s linear infinite;
        }
        
        @keyframes scan {
            0% { top: 0%; }
            100% { top: 100%; }
        }
        
        .container {
            background-color: var(--container-bg);
            border-radius: 0;
            padding: 15px;
            box-shadow: 0 0 10px var(--primary-color);
            border: 2px solid var(--primary-color);
            position: relative;
            z-index: 1;
            max-width: 100%;
            margin: 0 auto;
            transform: translateY(0);
            transition: all var(--transition-medium) ease;
            animation: container-glow 3s infinite alternate;
        }
        
        @keyframes container-glow {
            0% { box-shadow: 0 0 5px var(--primary-color); }
            100% { box-shadow: 0 0 15px var(--primary-color), 0 0 25px var(--primary-color); }
        }
        
        .container.appear {
            animation: containerAppear 0.8s ease-out;
        }
        
        @keyframes containerAppear {
            0% {
                opacity: 0;
                transform: translateY(20px) scale(0.95);
            }
            100% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        h1 {
            color: var(--primary-color);
            text-align: center;
            margin: 0 0 10px;
            font-size: 22px;
            text-shadow: 2px 2px 0 #030;
            width: 100%;
            animation: titleGlow 4s infinite alternate;
            position: relative;
            overflow: hidden;
            padding: 10px;
        }
        
        @keyframes titleGlow {
            0% {
                text-shadow: 2px 2px 0 #030, 0 0 5px var(--primary-color);
            }
            100% {
                text-shadow: 2px 2px 0 #030, 0 0 15px var(--primary-color), 0 0 25px var(--primary-color);
            }
        }
        
        .subtitle {
            text-align: center;
            color: var(--secondary-color);
            margin-bottom: 20px;
            font-size: 14px;
            animation: subtitlePulse 3s infinite;
            position: relative;
        }
        
        @keyframes subtitlePulse {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }
        
        .game-area {
            margin: 15px 0;
            padding: 12px;
            border: 2px solid var(--secondary-color);
            border-radius: 0;
            background-color: var(--game-area-bg);
            transform: translateY(0);
            transition: all var(--transition-medium) ease;
            animation: game-area-glow 5s infinite alternate;
        }
        
        @keyframes game-area-glow {
            0% { box-shadow: inset 0 0 5px var(--secondary-color); }
            100% { box-shadow: inset 0 0 15px var(--secondary-color); }
        }
        
        .game-area.appear {
            animation: gameAreaAppear 0.6s ease-out 0.2s both;
        }
        
        @keyframes gameAreaAppear {
            0% {
                opacity: 0;
                transform: translateY(15px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        input[type="number"] {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 2px solid var(--secondary-color);
            border-radius: 0;
            box-sizing: border-box;
            background-color: var(--background-color);
            color: var(--text-color);
            font-family: 'Courier New', Courier, monospace;
            font-size: 18px;
            -webkit-appearance: none;
            -moz-appearance: textfield;
            transition: all var(--transition-fast) ease;
            animation: input-pulse 4s infinite alternate;
        }
        
        @keyframes input-pulse {
            0% { box-shadow: 0 0 0px var(--secondary-color); }
            100% { box-shadow: 0 0 5px var(--secondary-color); }
        }
        
        input[type="number"]:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 10px var(--accent-color);
            animation: none;
        }
        
        /* Убираем стрелки в input number */
        input[type=number]::-webkit-outer-spin-button,
        input[type=number]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        
        .buttons-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 15px 0;
        }
        
        button {
            background-color: var(--background-color);
            color: var(--text-color);
            border: 2px solid var(--primary-color);
            padding: 12px 15px;
            border-radius: 0;
            cursor: pointer;
            font-size: 16px;
            font-family: 'Courier New', Courier, monospace;
            image-rendering: pixelated;
            transition: all var(--transition-fast) ease;
            flex: 1;
            min-height: 50px;
            position: relative;
            overflow: hidden;
            animation: button-glow 3s infinite alternate;
        }
        
        @keyframes button-glow {
            0% { box-shadow: 0 0 0px var(--primary-color); }
            100% { box-shadow: 0 0 5px var(--primary-color); }
        }
        
        button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 0, 0.2), transparent);
            transition: left var(--transition-slow) ease;
        }
        
        button:hover::before {
            left: 100%;
        }
        
        button:hover, button:active {
            background-color: var(--primary-color);
            color: var(--background-color);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 255, 0, 0.3);
            animation: none;
        }
        
        button:disabled {
            background-color: #222;
            color: #050;
            border-color: #050;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
            animation: none;
        }
        
        button:disabled::before {
            display: none;
        }
        
        #newGameBtn {
            background-color: var(--background-color);
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
        }
        
        #newGameBtn:hover, #newGameBtn:active {
            background-color: var(--primary-color);
            color: var(--background-color);
        }
        
        .message {
            padding: 12px;
            margin: 15px 0;
            border-radius: 0;
            text-align: center;
            font-weight: bold;
            border: 2px solid var(--secondary-color);
            font-size: 16px;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            transform: scale(1);
            transition: all var(--transition-medium) ease;
            animation: message-pulse 5s infinite alternate;
        }
        
        @keyframes message-pulse {
            0% { box-shadow: 0 0 0px var(--secondary-color); }
            100% { box-shadow: 0 0 5px var(--secondary-color); }
        }
        
        .message.appear {
            animation: messageAppear 0.5s ease-out;
        }
        
        @keyframes messageAppear {
            0% {
                opacity: 0;
                transform: scale(0.8);
            }
            70% {
                transform: scale(1.05);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        .hint {
            background-color: #051005;
            border: 2px solid var(--secondary-color);
            color: var(--text-color);
        }
        
        .success {
            background-color: #051005;
            border: 2px solid var(--primary-color);
            color: var(--text-color);
            animation: pulse 0.5s infinite alternate, successGlow 2s infinite alternate;
        }
        
        @keyframes pulse {
            from { box-shadow: 0 0 5px var(--primary-color); }
            to { box-shadow: 0 0 20px var(--primary-color); }
        }
        
        @keyframes successGlow {
            0% {
                border-color: var(--primary-color);
                box-shadow: 0 0 10px var(--primary-color);
            }
            50% {
                border-color: var(--accent-color);
                box-shadow: 0 0 20px var(--accent-color);
            }
            100% {
                border-color: var(--primary-color);
                box-shadow: 0 0 10px var(--primary-color);
            }
        }
        
        .attempts {
            margin-top: 15px;
            font-style: italic;
            color: var(--secondary-color);
            text-align: center;
            font-size: 16px;
            animation: attemptsPulse 3s infinite;
        }
        
        @keyframes attemptsPulse {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }
        
        .rules {
            margin-top: 20px;
            padding: 12px;
            background-color: #051005;
            border-radius: 0;
            font-size: 14px;
            border: 2px solid var(--secondary-color);
            transform: translateY(0);
            transition: all var(--transition-medium) ease;
            animation: rules-glow 6s infinite alternate;
        }
        
        @keyframes rules-glow {
            0% { box-shadow: 0 0 0px var(--secondary-color); }
            100% { box-shadow: 0 0 5px var(--secondary-color); }
        }
        
        .rules.appear {
            animation: rulesAppear 0.7s ease-out 0.4s both;
        }
        
        @keyframes rulesAppear {
            0% {
                opacity: 0;
                transform: translateY(20px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .rules h3 {
            margin-top: 0;
            text-align: center;
        }
        
        .rules ul {
            padding-left: 20px;
            margin-bottom: 0;
        }
        
        .rules li {
            margin-bottom: 8px;
            opacity: 0;
            animation: rulesItemAppear 0.5s ease-out forwards;
        }
        
        .rules li:nth-child(1) { animation-delay: 0.5s; }
        .rules li:nth-child(2) { animation-delay: 0.6s; }
        .rules li:nth-child(3) { animation-delay: 0.7s; }
        .rules li:nth-child(4) { animation-delay: 0.8s; }
        .rules li:nth-child(5) { animation-delay: 0.9s; }
        .rules li:nth-child(6) { animation-delay: 1.0s; }
        .rules li:nth-child(7) { animation-delay: 1.1s; }
        .rules li:nth-child(8) { animation-delay: 1.2s; }
        .rules li:nth-child(9) { animation-delay: 1.3s; }
        .rules li:nth-child(10) { animation-delay: 1.4s; }
        .rules li:nth-child(11) { animation-delay: 1.5s; }
        .rules li:nth-child(12) { animation-delay: 1.6s; }
        .rules li:nth-child(13) { animation-delay: 1.7s; }
        .rules li:nth-child(14) { animation-delay: 1.8s; }
        .rules li:nth-child(15) { animation-delay: 1.9s; }
        .rules li:nth-child(16) { animation-delay: 2.0s; }
        .rules li:nth-child(17) { animation-delay: 2.1s; }
        .rules li:nth-child(18) { animation-delay: 2.2s; }
        .rules li:nth-child(19) { animation-delay: 2.3s; }
        .rules li:nth-child(20) { animation-delay: 2.4s; }
        
        @keyframes rulesItemAppear {
            0% {
                opacity: 0;
                transform: translateX(-10px);
            }
            100% {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .pixel-border {
            border-style: solid;
            border-width: 4px;
            border-color: var(--primary-color) #050 #050 var(--primary-color);
        }
        
        .pixel-border-reverse {
            border-style: solid;
            border-width: 4px;
            border-color: #050 var(--primary-color) var(--primary-color) #050;
        }
        
        .history-section {
            margin: 15px 0;
            padding: 10px;
            background-color: #051005;
            border: 1px solid var(--secondary-color);
            transform: translateY(0);
            transition: all var(--transition-medium) ease;
            animation: history-glow 4s infinite alternate;
        }
        
        @keyframes history-glow {
            0% { box-shadow: 0 0 0px var(--secondary-color); }
            100% { box-shadow: 0 0 5px var(--secondary-color); }
        }
        
        .history-section.appear {
            animation: historyAppear 0.6s ease-out 0.3s both;
        }
        
        @keyframes historyAppear {
            0% {
                opacity: 0;
                transform: translateY(15px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .history-section h3 {
            margin-top: 0;
            text-align: center;
        }
        
        .history-list {
            max-height: 120px;
            overflow-y: auto;
            margin-top: 10px;
            padding: 8px;
            background-color: var(--background-color);
            border: 1px dashed var(--secondary-color);
            font-size: 14px;
            color: var(--secondary-color);
        }
        
        .history-item {
            margin: 5px 0;
            padding: 3px;
            border-bottom: 1px solid var(--secondary-color);
            opacity: 0;
            animation: historyItemAppear 0.3s ease-out forwards;
        }
        
        @keyframes historyItemAppear {
            0% {
                opacity: 0;
                transform: translateX(-10px);
            }
            100% {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        /* Визуализация диапазона */
        .range-visualization {
            margin: 20px 0;
            padding: 10px;
            background-color: var(--background-color);
            border: 1px solid var(--secondary-color);
            position: relative;
            transform: translateY(0);
            transition: all var(--transition-medium) ease;
            animation: range-glow 4s infinite alternate;
        }
        
        @keyframes range-glow {
            0% { box-shadow: 0 0 0px var(--secondary-color); }
            100% { box-shadow: 0 0 5px var(--secondary-color); }
        }
        
        .range-visualization.appear {
            animation: rangeAppear 0.7s ease-out 0.1s both;
        }
        
        @keyframes rangeAppear {
            0% {
                opacity: 0;
                transform: translateY(15px) scale(0.95);
            }
            100% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        .range-visualization.narrow-range {
            box-shadow: 0 0 15px var(--primary-color), 0 0 30px var(--primary-color);
            animation: narrow-pulse 1s infinite alternate;
        }
        
        @keyframes narrow-pulse {
            from { box-shadow: 0 0 10px var(--primary-color), 0 0 20px var(--primary-color); }
            to { box-shadow: 0 0 20px var(--primary-color), 0 0 40px var(--primary-color); }
        }
        
        .range-scale {
            position: relative;
            width: 100%;
            height: 40px;
            background-color: #051005;
            border: 1px solid var(--secondary-color);
            margin-bottom: 10px;
            overflow: visible; /* Изменено с hidden на visible */
        }
        
        .range-numbers {
            display: flex;
            justify-content: space-between;
            color: var(--secondary-color);
            font-size: 12px;
            margin-top: 5px;
        }
        
        .range-current {
            position: absolute;
            height: 100%;
            background-color: rgba(0, 255, 0, 0.2);
            border: 1px solid var(--primary-color);
            transition: all 0.5s ease;
            z-index: 1;
        }
        
        .range-marker {
            position: absolute;
            width: 4px;
            height: 100%;
            top: 0;
            z-index: 10;
            transform: translateX(-50%);
            opacity: 0;
            animation: markerAppear 0.5s ease-out forwards;
        }
        
        @keyframes markerAppear {
            0% {
                opacity: 0;
                transform: translateX(-50%) scaleY(0);
            }
            100% {
                opacity: 1;
                transform: translateX(-50%) scaleY(1);
            }
        }
        
        .range-marker.higher {
            background-color: #ff0;
            box-shadow: 0 0 5px #ff0;
        }
        
        .range-marker.lower {
            background-color: #0ff;
            box-shadow: 0 0 5px #0ff;
        }
        
        .range-marker.correct {
            background-color: var(--primary-color);
            width: 6px;
            height: 120%;
            top: -10%;
            box-shadow: 0 0 10px var(--primary-color);
            animation: correct-pulse 1s infinite, markerAppear 0.5s ease-out forwards;
        }
        
        @keyframes correct-pulse {
            0% { box-shadow: 0 0 5px var(--primary-color); }
            50% { box-shadow: 0 0 15px var(--primary-color); }
            100% { box-shadow: 0 0 5px var(--primary-color); }
        }
        
        .marker-label {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 10px;
            color: var(--primary-color);
            background-color: var(--background-color);
            padding: 2px 5px;
            border: 1px solid var(--secondary-color);
            border-radius: 3px;
            white-space: nowrap;
            opacity: 0;
            animation: labelAppear 0.3s ease-out 0.3s forwards;
            z-index: 11;
        }
        
        @keyframes labelAppear {
            0% { opacity: 0; transform: translateX(-50%) translateY(-5px); }
            100% { opacity: 1; transform: translateX(-50%) translateY(0); }
        }
        
        .stats {
            display: flex;
            flex-direction: column;
            gap: 5px;
            margin-top: 10px;
            font-size: 14px;
            color: var(--secondary-color);
        }
        
        .stats-row {
            display: flex;
            justify-content: space-between;
        }
        
        .glitch-text {
            position: relative;
            display: inline-block;
        }
        
        .glitch-text::before,
        .glitch-text::after {
            content: attr(data-text);
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        .glitch-text::before {
            left: 2px;
            text-shadow: -1px 0 red;
            clip: rect(24px, 550px, 90px, 0);
            animation: glitch-anim 5s infinite linear alternate-reverse;
        }
        
        .glitch-text::after {
            left: -2px;
            text-shadow: -1px 0 blue;
            clip: rect(85px, 550px, 140px, 0);
            animation: glitch-anim2 5s infinite linear alternate-reverse;
        }
        
        @keyframes glitch-anim {
            0% { clip: rect(42px, 9999px, 44px, 0); }
            5% { clip: rect(12px, 9999px, 59px, 0); }
            10% { clip: rect(48px, 9999px, 29px, 0); }
            15% { clip: rect(42px, 9999px, 73px, 0); }
            20% { clip: rect(63px, 9999px, 27px, 0); }
            25% { clip: rect(34px, 9999px, 55px, 0); }
            30% { clip: rect(86px, 9999px, 73px, 0); }
            35% { clip: rect(20px, 9999px, 20px, 0); }
            40% { clip: rect(26px, 9999px, 60px, 0); }
            45% { clip: rect(25px, 9999px, 66px, 0); }
            50% { clip: rect(57px, 9999px, 98px, 0); }
            55% { clip: rect(5px, 9999px, 46px, 0); }
            60% { clip: rect(30px, 9999px, 16px, 0); }
            65% { clip: rect(59px, 9999px, 50px, 0); }
            70% { clip: rect(41px, 9999px, 62px, 0); }
            75% { clip: rect(2px, 9999px, 82px, 0); }
            80% { clip: rect(47px, 9999px, 73px, 0); }
            85% { clip: rect(3px, 9999px, 27px, 0); }
            90% { clip: rect(26px, 9999px, 55px, 0); }
            95% { clip: rect(42px, 9999px, 97px, 0); }
            100% { clip: rect(38px, 9999px, 49px, 0); }
        }
        
        @keyframes glitch-anim2 {
            0% { clip: rect(65px, 9999px, 100px, 0); }
            5% { clip: rect(52px, 9999px, 74px, 0); }
            10% { clip: rect(79px, 9999px, 85px, 0); }
            15% { clip: rect(75px, 9999px, 5px, 0); }
            20% { clip: rect(67px, 9999px, 61px, 0); }
            25% { clip: rect(14px, 9999px, 79px, 0); }
            30% { clip: rect(1px, 9999px, 66px, 0); }
            35% { clip: rect(86px, 9999px, 30px, 0); }
            40% { clip: rect(23px, 9999px, 98px, 0); }
            45% { clip: rect(85px, 9999px, 72px, 0); }
            50% { clip: rect(71px, 9999px, 75px, 0); }
            55% { clip: rect(2px, 9999px, 48px, 0); }
            60% { clip: rect(30px, 9999px, 16px, 0); }
            65% { clip: rect(59px, 9999px, 50px, 0); }
            70% { clip: rect(41px, 9999px, 62px, 0); }
            75% { clip: rect(2px, 9999px, 82px, 0); }
            80% { clip: rect(47px, 9999px, 73px, 0); }
            85% { clip: rect(3px, 9999px, 27px, 0); }
            90% { clip: rect(26px, 9999px, 55px, 0); }
            95% { clip: rect(42px, 9999px, 97px, 0); }
            100% { clip: rect(38px, 9999px, 49px, 0); }
        }
        
        .terminal-text {
            color: var(--primary-color);
            border-right: 2px solid var(--primary-color);
            padding-right: 5px;
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 100% { border-color: var(--primary-color); }
            50% { border-color: transparent; }
        }
        
        /* Стили для статистики */
        .stats-section {
            margin: 20px 0;
            padding: 12px;
            background-color: #051005;
            border: 1px solid var(--secondary-color);
            transform: translateY(0);
            transition: all var(--transition-medium) ease;
            animation: stats-glow 4s infinite alternate;
        }
        
        @keyframes stats-glow {
            0% { box-shadow: 0 0 0px var(--secondary-color); }
            100% { box-shadow: 0 0 5px var(--secondary-color); }
        }
        
        .stats-section.appear {
            animation: statsAppear 0.6s ease-out 0.2s both;
        }
        
        @keyframes statsAppear {
            0% {
                opacity: 0;
                transform: translateY(15px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .stats-section h3 {
            margin-top: 0;
            text-align: center;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 10px;
        }
        
        .stat-item {
            padding: 8px;
            background-color: var(--background-color);
            border: 1px solid var(--secondary-color);
            text-align: center;
            transform: scale(1);
            transition: all var(--transition-fast) ease;
            animation: stat-pulse 4s infinite alternate;
        }
        
        @keyframes stat-pulse {
            0% { box-shadow: 0 0 0px var(--secondary-color); }
            100% { box-shadow: 0 0 5px var(--secondary-color); }
        }
        
        .stat-item:hover {
            transform: scale(1.05);
            box-shadow: 0 0 10px var(--secondary-color);
            animation: none;
        }
        
        .stat-value {
            font-size: 18px;
            font-weight: bold;
            color: var(--primary-color);
            margin-top: 5px;
            transition: all var(--transition-fast) ease;
        }
        
        .stat-item:hover .stat-value {
            color: var(--accent-color);
            text-shadow: 0 0 10px var(--accent-color);
        }
        
        .stat-label {
            font-size: 12px;
            color: var(--secondary-color);
        }
        
        /* Новые эффекты */
        .crt-noise {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%"><filter id="noise"><feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="1" stitchTiles="stitch"/></filter><rect width="100%" height="100%" filter="url(%23noise)" opacity="0.1"/></svg>');
            z-index: 102;
            pointer-events: none;
            opacity: 0.05;
            animation: noise 0.2s infinite;
        }
        
        @keyframes noise {
            0% { transform: translate(0,0); }
            10% { transform: translate(-1%,-1%); }
            20% { transform: translate(-2%,1%); }
            30% { transform: translate(1%,-2%); }
            40% { transform: translate(-1%,2%); }
            50% { transform: translate(2%,-1%); }
            60% { transform: translate(-2%,1%); }
            70% { transform: translate(1%,-2%); }
            80% { transform: translate(-1%,2%); }
            90% { transform: translate(2%,-1%); }
            100% { transform: translate(0,0); }
        }
        
        .vignette {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            box-shadow: inset 0 0 150px rgba(0, 0, 0, 0.9);
            z-index: 103;
            pointer-events: none;
        }
        
        .power-light {
            position: fixed;
            bottom: 15px;
            right: 15px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: var(--primary-color);
            box-shadow: 0 0 10px var(--primary-color);
            z-index: 104;
            animation: power-flicker 3s infinite;
        }
        
        @keyframes power-flicker {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
            51% { opacity: 0.3; }
            52% { opacity: 0.7; }
            95% { opacity: 0.8; }
        }
        
        /* Стили для режима паники */
        .panic-mode {
            color: #f00 !important;
            border-color: #f00 !important;
            box-shadow: 0 0 10px #f00 !important;
            animation: panicBackground 2s infinite alternate;
        }
        
        @keyframes panicBackground {
            0% { background-color: #100; }
            100% { background-color: #300; }
        }
        
        .panic-mode .container {
            box-shadow: 0 0 10px #f00, 0 0 20px #f00 !important;
            border: 2px solid #f00 !important;
            animation: panicContainer 1s infinite alternate;
        }
        
        @keyframes panicContainer {
            0% { transform: translateX(-2px); }
            100% { transform: translateX(2px); }
        }
        
        .panic-mode .game-area {
            border: 2px solid #f00 !important;
            box-shadow: 0 0 10px #f00 !important;
        }
        
        .panic-mode input[type="number"] {
            border: 2px solid #f00 !important;
            color: #f00 !important;
            box-shadow: 0 0 5px #f00 !important;
            animation: panicInput 0.5s infinite alternate;
        }
        
        @keyframes panicInput {
            0% { box-shadow: 0 0 5px #f00; }
            100% { box-shadow: 0 0 15px #f00; }
        }
        
        .panic-mode button {
            color: #f00 !important;
            border: 2px solid #f00 !important;
            box-shadow: 0 0 5px #f00 !important;
            animation: panicButton 1s infinite alternate;
        }
        
        @keyframes panicButton {
            0% { transform: translateY(0); }
            100% { transform: translateY(-3px); }
        }
        
        .panic-mode button:hover, .panic-mode button:active {
            background-color: #f00 !important;
            color: #000 !important;
        }
        
        .panic-mode .message {
            border: 2px solid #f00 !important;
            box-shadow: 0 0 5px #f00 !important;
            animation: panicMessage 0.8s infinite alternate;
        }
        
        @keyframes panicMessage {
            0% { transform: scale(1); }
            100% { transform: scale(1.02); }
        }
        
        .panic-mode .hint {
            background-color: #300 !important;
            border: 2px solid #f00 !important;
            color: #f00 !important;
        }
        
        .panic-mode .success {
            background-color: #300 !important;
            border: 2px solid #f00 !important;
            color: #f00 !important;
            animation: panicSuccess 1s infinite alternate;
        }
        
        @keyframes panicSuccess {
            0% { 
                box-shadow: 0 0 10px #f00;
                border-color: #f00;
            }
            100% { 
                box-shadow: 0 0 20px #f00, 0 0 30px #f00;
                border-color: #ff0;
            }
        }
        
        .panic-mode .attempts {
            color: #f00 !important;
            animation: panicAttempts 1s infinite alternate;
        }
        
        @keyframes panicAttempts {
            0% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        .panic-mode .rules {
            background-color: #300 !important;
            border: 2px solid #f00 !important;
            color: #f00 !important;
        }
        
        .panic-mode .history-section {
            background-color: #300 !important;
            border: 1px solid #f00 !important;
        }
        
        .panic-mode .history-list {
            background-color: #200 !important;
            border: 1px dashed #f00 !important;
            color: #f00 !important;
        }
        
        .panic-mode .stats-section {
            background-color: #300 !important;
            border: 1px solid #f00 !important;
        }
        
        .panic-mode .stat-item {
            border: 1px solid #f00 !important;
            animation: panicStatItem 2s infinite alternate;
        }
        
        @keyframes panicStatItem {
            0% { transform: scale(1); }
            100% { transform: scale(1.03); }
        }
        
        .panic-mode .stat-value {
            color: #f00 !important;
            animation: panicStatValue 1s infinite alternate;
        }
        
        @keyframes panicStatValue {
            0% { text-shadow: 0 0 5px #f00; }
            100% { text-shadow: 0 0 15px #f00, 0 0 20px #f00; }
        }
        
        .panic-mode .range-visualization {
            border: 1px solid #f00 !important;
            box-shadow: 0 0 10px #f00 !important;
            animation: panicRange 1s infinite alternate;
        }
        
        @keyframes panicRange {
            0% { transform: translateY(0); }
            100% { transform: translateY(-3px); }
        }
        
        .panic-mode .range-scale {
            background-color: #300 !important;
            border: 1px solid #f00 !important;
        }
        
        .panic-mode .range-numbers {
            color: #f00 !important;
        }
        
        .panic-mode .range-current {
            background-color: rgba(255, 0, 0, 0.2) !important;
            border: 1px solid #f00 !important;
            animation: panicRangeCurrent 1s infinite alternate;
        }
        
        @keyframes panicRangeCurrent {
            0% { background-color: rgba(255, 0, 0, 0.2); }
            100% { background-color: rgba(255, 0, 0, 0.4); }
        }
        
        .panic-mode .scan-line {
            background: rgba(255, 0, 0, 0.3) !important;
            box-shadow: 0 0 10px rgba(255, 0, 0, 0.5) !important;
            animation: panicScan 2s linear infinite;
        }
        
        @keyframes panicScan {
            0% { top: 0%; }
            100% { top: 100%; }
        }
        
        .panic-mode .power-light {
            background-color: #f00 !important;
            box-shadow: 0 0 10px #f00 !important;
            animation: panicPowerLight 0.5s infinite alternate;
        }
        
        @keyframes panicPowerLight {
            0% { transform: scale(1); }
            100% { transform: scale(1.2); }
        }
        
        .shake-screen {
            animation: shake 0.5s infinite;
        }
        
        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            70% { transform: translate(3px, 1px) rotate(-1deg); }
            80% { transform: translate(-1px, -1px) rotate(1deg); }
            90% { transform: translate(1px, 2px) rotate(0deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }
        
        .panic-timer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.4);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 200;
            font-size: 36px;
            color: #f00;
            text-shadow: 0 0 10px #f00;
            flex-direction: column;
            display: none;
            pointer-events: none;
            padding: 20px;
            text-align: center;
        }
        
        .panic-timer.active {
            display: flex;
            animation: panicTimerAppear 0.5s ease-out;
        }
        
        @keyframes panicTimerAppear {
            0% { opacity: 0; }
            100% { opacity: 1; }
        }
        
        .timer-text {
            font-size: 24px;
            margin-bottom: 15px;
            text-align: center;
            animation: timerTextPulse 2s infinite;
        }
        
        @keyframes timerTextPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .timer-count {
            font-size: 48px;
            font-weight: bold;
            color: #f00;
            text-shadow: 0 0 20px #f00;
            animation: timer-pulse 1s infinite;
            margin-bottom: 15px;
        }
        
        @keyframes timer-pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.5); }
            100% { transform: scale(1); }
        }
        
        .panic-warning {
            color: #f00;
            text-align: center;
            margin-top: 10px;
            font-size: 14px;
            animation: blink 1s infinite;
        }

        .hint-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: var(--background-color);
            border: 3px solid var(--primary-color);
            padding: 20px;
            z-index: 300;
            box-shadow: 0 0 20px var(--primary-color), 0 0 40px var(--primary-color);
            text-align: center;
            animation: hint-appear 0.5s ease-out;
            display: none;
            width: 80%;
            max-width: 300px;
        }
        
        .hint-popup.active {
            display: block;
            animation: hintActive 0.5s ease-out;
        }
        
        @keyframes hintActive {
            0% {
                transform: translate(-50%, -50%) scale(0.8);
                opacity: 0;
            }
            70% {
                transform: translate(-50%, -50%) scale(1.05);
            }
            100% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
        }
        
        .hint-popup.panic-mode {
            border: 3px solid #f00;
            box-shadow: 0 0 20px #f00, 0 0 40px #f00;
            color: #f00;
            animation: hintPanic 0.5s ease-out;
        }
        
        @keyframes hintPanic {
            0% {
                transform: translate(-50%, -50%) scale(0.8) rotate(-5deg);
                opacity: 0;
            }
            70% {
                transform: translate(-50%, -50%) scale(1.05) rotate(2deg);
            }
            100% {
                transform: translate(-50%, -50%) scale(1) rotate(0);
                opacity: 1;
            }
        }
        
        @keyframes hint-appear {
          0% { 
            opacity: 0;
            }
         100% { 
            opacity: 1;
            }
        }
        
        .hint-title {
            font-size: 18px;
            margin-bottom: 15px;
            color: var(--primary-color);
            text-shadow: 0 0 10px var(--primary-color);
            animation: hintTitlePulse 2s infinite;
        }
        
        @keyframes hintTitlePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .hint-value {
            font-size: 24px;
            font-weight: bold;
            margin: 15px 0;
            color: var(--primary-color);
            text-shadow: 0 0 15px var(--primary-color);
            animation: hint-pulse 1s infinite alternate;
        }
        
        .hint-popup.panic-mode .hint-title,
        .hint-popup.panic-mode .hint-value {
            color: #f00;
            text-shadow: 0 0 10px #f00;
        }
        
        @keyframes hint-pulse {
            from { transform: scale(1); }
            to { transform: scale(1.1); }
        }
        
        .hint-timer {
            margin-top: 15px;
            font-size: 14px;
            color: var(--secondary-color);
            animation: hintTimerPulse 1s infinite;
        }
        
        @keyframes hintTimerPulse {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }
        
        .hint-popup.panic-mode .hint-timer {
            color: #a00;
        }
        
        .hint-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 299;
            display: none;
        }
        
        .hint-overlay.active {
            display: block;
            animation: overlayAppear 0.3s ease-out;
        }
        
        @keyframes overlayAppear {
            0% { opacity: 0; }
            100% { opacity: 1; }
        }
        
        /* Стили для режима тревоги */
        .alarm-mode {
            color: #ff0 !important;
            border-color: #ff0 !important;
            box-shadow: 0 0 10px #ff0 !important;
            animation: alarmBackground 2s infinite alternate;
        }
        
        @keyframes alarmBackground {
            0% { background-color: #111100; }
            100% { background-color: #333300; }
        }
        
        .alarm-mode .container {
            box-shadow: 0 0 10px #ff0, 0 0 20px #ff0 !important;
            border: 2px solid #ff0 !important;
            animation: alarmContainer 1s infinite alternate;
        }
        
        @keyframes alarmContainer {
            0% { transform: translateY(-2px); }
            100% { transform: translateY(2px); }
        }
        
        .alarm-mode .game-area {
            border: 2px solid #ff0 !important;
            box-shadow: 0 0 10px #ff0 !important;
        }
        
        .alarm-mode input[type="number"] {
            border: 2px solid #ff0 !important;
            color: #ff0 !important;
            box-shadow: 0 0 5px #ff0 !important;
            animation: alarmInput 0.5s infinite alternate;
        }
        
        @keyframes alarmInput {
            0% { box-shadow: 0 0 5px #ff0; }
            100% { box-shadow: 0 0 15px #ff0; }
        }
        
        .alarm-mode button {
            color: #ff0 !important;
            border: 2px solid #ff0 !important;
            box-shadow: 0 0 5px #ff0 !important;
            animation: alarmButton 1s infinite alternate;
        }
        
        @keyframes alarmButton {
            0% { transform: translateX(0); }
            100% { transform: translateX(-3px); }
        }
        
        .alarm-mode button:hover, .alarm-mode button:active {
            background-color: #ff0 !important;
            color: #000 !important;
        }
        
        .alarm-mode .message {
            border: 2px solid #ff0 !important;
            box-shadow: 0 0 5px #ff0 !important;
            animation: alarmMessage 0.8s infinite alternate;
        }
        
        @keyframes alarmMessage {
            0% { transform: rotate(-1deg); }
            100% { transform: rotate(1deg); }
        }
        
        .alarm-mode .hint {
            background-color: #333300 !important;
            border: 2px solid #ff0 !important;
            color: #ff0 !important;
        }
        
        .alarm-mode .success {
            background-color: #333300 !important;
            border: 2px solid #ff0 !important;
            color: #ff0 !important;
            animation: alarmSuccess 1s infinite alternate;
        }
        
        @keyframes alarmSuccess {
            0% { 
                box-shadow: 0 0 10px #ff0;
                border-color: #ff0;
            }
            100% { 
                box-shadow: 0 0 20px #ff0, 0 0 30px #ff0;
                border-color: #fff;
            }
        }
        
        .alarm-mode .attempts {
            color: #ff0 !important;
            animation: alarmAttempts 1s infinite alternate;
        }
        
        @keyframes alarmAttempts {
            0% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        .alarm-mode .rules {
            background-color: #333300 !important;
            border: 2px solid #ff0 !important;
            color: #ff0 !important;
        }
        
        .alarm-mode .history-section {
            background-color: #333300 !important;
            border: 1px solid #ff0 !important;
        }
        
        .alarm-mode .history-list {
            background-color: #222200 !important;
            border: 1px dashed #ff0 !important;
            color: #ff0 !important;
        }
        
        .alarm-mode .stats-section {
            background-color: #333300 !important;
            border: 1px solid #ff0 !important;
        }
        
        .alarm-mode .stat-item {
            border: 1px solid #ff0 !important;
            animation: alarmStatItem 2s infinite alternate;
        }
        
        @keyframes alarmStatItem {
            0% { transform: scale(1); }
            100% { transform: scale(1.03); }
        }
        
        .alarm-mode .stat-value {
            color: #ff0 !important;
            animation: alarmStatValue 1s infinite alternate;
        }
        
        @keyframes alarmStatValue {
            0% { text-shadow: 0 0 5px #ff0; }
            100% { text-shadow: 0 0 15px #ff0, 0 0 20px #ff0; }
        }
        
        .alarm-mode .range-visualization {
            border: 1px solid #ff0 !important;
            box-shadow: 0 0 10px #ff0 !important;
            animation: alarmRange 1s infinite alternate;
        }
        
        @keyframes alarmRange {
            0% { transform: translateY(0); }
            100% { transform: translateY(-3px); }
        }
        
        .alarm-mode .range-scale {
            background-color: #333300 !important;
            border: 1px solid #ff0 !important;
        }
        
        .alarm-mode .range-numbers {
            color: #ff0 !important;
        }
        
        .alarm-mode .range-current {
            background-color: rgba(255, 255, 0, 0.2) !important;
            border: 1px solid #ff0 !important;
            animation: alarmRangeCurrent 1s infinite alternate;
        }
        
        @keyframes alarmRangeCurrent {
            0% { background-color: rgba(255, 255, 0, 0.2); }
            100% { background-color: rgba(255, 255, 0, 0.4); }
        }
        
        .alarm-mode .scan-line {
            background: rgba(255, 255, 0, 0.3) !important;
            box-shadow: 0 0 10px rgba(255, 255, 0, 0.5) !important;
            animation: alarmScan 2s linear infinite;
        }
        
        @keyframes alarmScan {
            0% { top: 0%; }
            100% { top: 100%; }
        }
        
        .alarm-mode .power-light {
            background-color: #ff0 !important;
            box-shadow: 0 0 10px #ff0 !important;
            animation: alarmPowerLight 0.5s infinite alternate;
        }
        
        @keyframes alarmPowerLight {
            0% { transform: scale(1); }
            100% { transform: scale(1.2); }
        }
        
        .alarm-timer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.4);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 200;
            font-size: 36px;
            color: #ff0;
            text-shadow: 0 0 10px #ff0;
            flex-direction: column;
            display: none;
            pointer-events: none;
            padding: 20px;
            text-align: center;
        }
        
        .alarm-timer.active {
            display: flex;
            animation: alarmTimerAppear 0.5s ease-out;
        }
        
        @keyframes alarmTimerAppear {
            0% { opacity: 0; }
            100% { opacity: 1; }
        }
        
        .alarm-timer .timer-text {
            font-size: 24px;
            margin-bottom: 15px;
            text-align: center;
            animation: alarmTimerTextPulse 2s infinite;
        }
        
        @keyframes alarmTimerTextPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .alarm-timer .timer-count {
            font-size: 48px;
            font-weight: bold;
            color: #ff0;
            text-shadow: 0 0 20px #ff0;
            animation: alarm-timer-pulse 1s infinite;
            margin-bottom: 15px;
        }
        
        @keyframes alarm-timer-pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .alarm-warning {
            color: #ff0;
            text-align: center;
            margin-top: 10px;
            font-size: 14px;
            animation: blink 1s infinite;
        }
        
        /* Стили для кнопки сброса прогресса */
        .reset-section {
            margin-top: 20px;
            padding: 12px;
            background-color: #200;
            border-radius: 0;
            font-size: 14px;
            border: 2px solid #500;
            text-align: center;
            transform: translateY(0);
            transition: all var(--transition-medium) ease;
            animation: reset-glow 4s infinite alternate;
        }

        @keyframes reset-glow {
            0% { box-shadow: 0 0 0px #500; }
            100% { box-shadow: 0 0 5px #500; }
        }

        .reset-section.appear {
            animation: resetAppear 0.6s ease-out 0.5s both;
        }
        
        @keyframes resetAppear {
            0% {
                opacity: 0;
                transform: translateY(20px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .reset-section p {
            margin: 15px 0;
            line-height: 1.5;
            color: #a00;
        }
        
        .reset-section h3 {
            margin-top: 0;
            text-align: center;
            color: #a00;
        }
        
        #resetProgressBtn {
            background-color: #200;
            color: #a00;
            border: 2px solid #a00;
            margin-top: 10px;
            transition: all var(--transition-fast) ease;
        }
        
        #resetProgressBtn:hover, #resetProgressBtn:active {
            background-color: #a00;
            color: #200;
            transform: scale(1.05);
            box-shadow: 0 0 15px #a00;
        }
        
        /* Модальное окно подтверждения сброса */
        .reset-confirm-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 400;
            display: none;
            justify-content: center;
            align-items: center;
        }

        .reset-confirm-overlay.active {
            display: flex;
            animation: overlayAppear 0.3s ease-out;
        }

        .reset-confirm-popup {
            background-color: var(--background-color);
            border: 3px solid #a00;
            padding: 25px;
            max-width: 90%;
            width: 400px;
            text-align: center;
            box-shadow: 0 0 20px #a00, 0 0 40px #a00;
            animation: resetConfirmAppear 0.5s ease-out;
        }

        @keyframes resetConfirmAppear {
            0% {
                transform: scale(0.8);
                opacity: 0;
            }
            70% {
                transform: scale(1.05);
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .reset-confirm-popup h3 {
            margin-top: 0;
            color: #a00;
            text-shadow: 0 0 10px #a00;
            font-size: 20px;
            animation: resetTitlePulse 2s infinite;
        }

        @keyframes resetTitlePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .reset-confirm-popup p {
            margin: 15px 0;
            color: #a00;
            line-height: 1.5;
        }

        .reset-confirm-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }

        .reset-confirm-btn {
            padding: 10px 20px;
            border: 2px solid;
            background-color: var(--background-color);
            font-family: 'Courier New', Courier, monospace;
            font-size: 16px;
            cursor: pointer;
            flex: 1;
            transition: all var(--transition-fast) ease;
        }

        #confirmResetBtn {
            color: #a00;
            border-color: #a00;
        }

        #confirmResetBtn:hover, #confirmResetBtn:active {
            background-color: #a00;
            color: var(--background-color);
            transform: scale(1.05);
            box-shadow: 0 0 10px #a00;
        }

        #cancelResetBtn {
            color: var(--secondary-color);
            border-color: var(--secondary-color);
        }

        #cancelResetBtn:hover, #cancelResetBtn:active {
            background-color: var(--secondary-color);
            color: var(--background-color);
            transform: scale(1.05);
            box-shadow: 0 0 10px var(--secondary-color);
        }

        /* Модальное окно подтверждения удаления предмета */
        .remove-confirm-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 450;
            display: none;
            justify-content: center;
            align-items: center;
        }

        .remove-confirm-overlay.active {
            display: flex;
            animation: overlayAppear 0.3s ease-out;
        }

        .remove-confirm-popup {
            background-color: var(--background-color);
            border: 3px solid #d00;
            padding: 25px;
            max-width: 90%;
            width: 400px;
            text-align: center;
            box-shadow: 0 0 20px #d00, 0 0 40px #d00;
            animation: removeConfirmAppear 0.5s ease-out;
        }

        @keyframes removeConfirmAppear {
            0% {
                transform: scale(0.8);
                opacity: 0;
            }
            70% {
                transform: scale(1.05);
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .remove-confirm-popup h3 {
            margin-top: 0;
            color: #d00;
            text-shadow: 0 0 10px #d00;
            font-size: 20px;
            animation: removeTitlePulse 2s infinite;
        }

        @keyframes removeTitlePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .remove-confirm-popup p {
            margin: 15px 0;
            color: #d00;
            line-height: 1.5;
        }

        .remove-confirm-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }

        .remove-confirm-btn {
            padding: 10px 20px;
            border: 2px solid;
            background-color: var(--background-color);
            font-family: 'Courier New', Courier, monospace;
            font-size: 16px;
            cursor: pointer;
            flex: 1;
            transition: all var(--transition-fast) ease;
        }

        #confirmRemoveBtn {
            color: #d00;
            border-color: #d00;
        }

        #confirmRemoveBtn:hover, #confirmRemoveBtn:active {
            background-color: #d00;
            color: var(--background-color);
            transform: scale(1.05);
            box-shadow: 0 0 10px #d00;
        }

        #cancelRemoveBtn {
            color: var(--secondary-color);
            border-color: var(--secondary-color);
        }

        #cancelRemoveBtn:hover, #cancelRemoveBtn:active {
            background-color: var(--secondary-color);
            color: var(--background-color);
            transform: scale(1.05);
            box-shadow: 0 0 10px var(--secondary-color);
        }

        .shop-section {
            margin-top: 20px;
            padding: 12px;
            background-color: #111;
            border-radius: 0;
            font-size: 14px;
            border: 2px solid #fff;
            text-align: center;
            transform: translateY(0);
            transition: all var(--transition-medium) ease;
            animation: shop-glow 4s infinite alternate;
        }
        
        @keyframes shop-glow {
            0% { box-shadow: 0 0 0px #fff; }
            100% { box-shadow: 0 0 5px #fff; }
        }
        
        .shop-section.appear {
            animation: shopSectionAppear 0.6s ease-out 0.4s both;
        }
        
        @keyframes shopSectionAppear {
            0% {
                opacity: 0;
                transform: translateY(20px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .shop-section h3 {
            margin-top: 0;
            text-align: center;
            color: #fff;
        }

        .shop-section p {
            margin: 15px 0;
            line-height: 1.5;
            color: #fff;
        }
        
        #shopBtn {
            background-color: #111;
            color: #fff;
            border: 2px solid #fff;
            margin-top: 10px;
            transition: all var(--transition-fast) ease;
        }
        
        #shopBtn:hover, #shopBtn:active {
            background-color: #fff;
            color: #111;
            transform: scale(1.05);
            box-shadow: 0 0 15px #fff;
        }
        
        /* Стили для модального окна магазина */
        .shop-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 400;
            display: none;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .shop-overlay.active {
            display: flex;
            opacity: 1;
            animation: overlayAppear 0.3s ease-out;
        }
        
        .shop-popup {
            background-color: var(--background-color);
            border: 3px solid #fff;
            padding: 25px;
            max-width: 90%;
            width: 500px;
            height: 80%;
            overflow: auto;
            text-align: center;
            box-shadow: 0 0 20px #fff, 0 0 40px #fff;
            animation: shop-appear 0.4s ease-out;
            transform: scale(0.9);
            opacity: 0;
            transition: all 0.3s ease;
        }
        
        .shop-overlay.active .shop-popup {
            transform: scale(1);
            opacity: 1;
        }
        
        @keyframes shop-appear {
            0% {
                transform: scale(0.7);
                opacity: 0;
            }
            70% {
                transform: scale(1.05);
                opacity: 0.8;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        .shop-popup h3 {
            margin-top: 0;
            color: #fff;
            text-shadow: 0 0 10px #fff;
            font-size: 20px;
            animation: shopTitlePulse 3s infinite;
        }
        
        @keyframes shopTitlePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .shop-popup p {
            margin: 15px 0;
            line-height: 1.5;
            color: #fff;
        }
        
        .shop-close-btn {
            padding: 10px 20px;
            border: 2px solid #fff;
            background-color: var(--background-color);
            color: #fff;
            font-family: 'Courier New', Courier, monospace;
            font-size: 16px;
            cursor: pointer;
            transition: all var(--transition-fast) ease;
            margin-top: 15px;
        }
        
        .shop-close-btn:hover, .shop-close-btn:active {
            background-color: #fff;
            color: var(--background-color);
            transform: scale(1.05);
            box-shadow: 0 0 10px #fff;
        }

        .shop-info {
            margin: 15px 0;
            padding: 10px;
            background-color: #222;
            border: 1px solid #fff;
            text-align: center;
            animation: shopInfoPulse 4s infinite;
        }
        
        @keyframes shopInfoPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }
        
        .shop-markup-value {
            font-size: 24px;
            font-weight: bold;
            color: #fff;
            text-shadow: 0 0 10px #fff;
            margin: 10px 0;
            animation: markupPulse 2s infinite alternate;
        }
        
        @keyframes markupPulse {
            0% { transform: scale(1); }
            100% { transform: scale(1.1); }
        }
        
        .shop-note {
            font-size: 12px;
            color: #aaa;
            margin-top: 10px;
        }

        .shop-markup-text {
            color: #fff;
            margin-top: 10px;
        }

        /* Стили для монеток */
        .coins-value {
            color: #ffffff !important;
            text-shadow: 0 0 10px #ffffff, 0 0 20px #ffffff, 0 0 30px #00ffff, 0 0 40px #00ffff;
            animation: coins-glow 2s infinite alternate;
            font-weight: bold;
            position: relative;
            display: inline-block;
            padding: 5px 10px;
            border-radius: 5px;
            background: linear-gradient(45deg, rgba(255,255,255,0.1), rgba(0,255,255,0.1));
            border: 1px solid rgba(255,255,255,0.3);
        }

        @keyframes coins-glow {
            0% {
                text-shadow: 0 0 5px #ffffff, 0 0 10px #ffffff, 0 0 15px #00ffff, 0 0 20px #00ffff;
                transform: scale(1);
            }
            100% {
                text-shadow: 0 0 10px #ffffff, 0 0 20px #ffffff, 0 0 30px #00ffff, 0 0 40px #00ffff, 0 0 50px #00ffff;
                transform: scale(1.05);
            }
        }

        .coins-value::before {
            content: "M";
            margin-right: 5px;
            display: inline-block;
            animation: coin-spin 3s infinite linear;
        }

        @keyframes coin-spin {
            0% { transform: rotateY(0deg); }
            100% { transform: rotateY(360deg); }
        }

        /* Эффект для увеличения счетчика монеток */
        @keyframes coins-count-up {
            0% { 
                transform: scale(1);
                text-shadow: 0 0 5px #ffffff;
            }
            50% { 
                transform: scale(1.3);
                text-shadow: 0 0 20px #ffff00, 0 0 30px #ffff00;
                color: #ffff00;
            }
            100% { 
                transform: scale(1);
                text-shadow: 0 0 10px #ffffff;
                color: #ffffff;
            }
        }

        .coins-count-up {
            animation: coins-count-up 0.5s ease-out;
        }

        /* Специальный стиль для монеток в магазине */
        .shop-coins-display {
            color: #ffffff !important;
            text-shadow: 0 0 10px #ffffff, 0 0 20px #ffff00, 0 0 30px #ffff00;
            animation: shop-coins-glow 3s infinite alternate;
            font-size: 24px !important;
            font-weight: bold;
            margin: 15px 0;
            padding: 10px;
            border-radius: 5px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.3);
        }

        @keyframes shop-coins-glow {
            0% {
                text-shadow: 0 0 5px #ffffff, 0 0 10px #ffff00, 0 0 15px #ffff00;
                transform: scale(1);
            }
            100% {
                text-shadow: 0 0 10px #ffffff, 0 0 20px #ffff00, 0 0 30px #ffff00, 0 0 40px #ffff00;
                transform: scale(1.05);
            }
        }

        .shop-coins-display::before {
            content: "M";
            margin-right: 10px;
            display: inline-block;
            animation: coin-spin 3s infinite linear;
        }

        /* Стили для товаров в магазине */
        .shop-items {
            margin: 20px 0;
        }

        .shop-item {
            padding: 15px;
            margin-bottom: 15px;
            background-color: #222;
            border: 1px solid #fff;
            border-radius: 0;
            text-align: left;
            transition: all var(--transition-medium) ease;
            position: relative;
            overflow: hidden;
            transform: translateY(0);
            opacity: 0;
            animation: shopItemAppear 0.5s ease-out forwards;
        }

        .shop-item:nth-child(1) { animation-delay: 0.1s; }
        .shop-item:nth-child(2) { animation-delay: 0.2s; }
        .shop-item:nth-child(3) { animation-delay: 0.3s; }
        .shop-item:nth-child(4) { animation-delay: 0.4s; }
        .shop-item:nth-child(5) { animation-delay: 0.5s; }
        .shop-item:nth-child(6) { animation-delay: 0.6s; }
        .shop-item:nth-child(7) { animation-delay: 0.7s; }
        .shop-item:nth-child(8) { animation-delay: 0.8s; }

        @keyframes shopItemAppear {
            0% {
                opacity: 0;
                transform: translateY(20px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .shop-item:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 10px 20px rgba(255, 255, 255, 0.2);
        }

        .shop-item.purchased {
            opacity: 0.7;
            border-color: #0f0;
            background-color: #151515;
            animation: purchasedPulse 2s infinite;
        }

        @keyframes purchasedPulse {
            0%, 100% { box-shadow: 0 0 5px #0f0; }
            50% { box-shadow: 0 0 15px #0f0; }
        }

        .shop-item-name {
            font-size: 18px;
            font-weight: bold;
            color: #fff;
            margin-bottom: 10px;
        }

        .shop-item-description {
            font-size: 14px;
            color: #aaa;
            margin-bottom: 10px;
            line-height: 1.4;
        }

        .shop-item-price {
            font-size: 16px;
            color: #ff0;
            margin-bottom: 10px;
        }
        
        .shop-original-price {
            text-decoration: line-through;
            color: #aaa;
            font-size: 14px;
            margin-right: 5px;
        }
        
        .shop-final-price {
            color: #ff0;
            font-weight: bold;
        }

        .shop-buy-btn {
            background-color: #333;
            color: #fff;
            border: 2px solid #fff;
            padding: 8px 15px;
            cursor: pointer;
            font-family: 'Courier New', Courier, monospace;
            transition: all var(--transition-fast) ease;
        }

        .shop-buy-btn:hover {
            background-color: #fff;
            color: #333;
            transform: scale(1.05);
        }

        .shop-buy-btn:disabled {
            background-color: #555;
            color: #888;
            border-color: #555;
            cursor: not-allowed;
            transform: none;
        }

        .shop-item-owned {
            color: #0f0;
            font-weight: bold;
            margin-top: 5px;
            animation: ownedPulse 2s infinite;
        }

        @keyframes ownedPulse {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }

        .purchase-animation {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, rgba(255,255,255,0.1), rgba(0,255,255,0.1));
            z-index: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            animation: purchase-glow 1s ease-out;
        }

        @keyframes purchase-glow {
            0% {
                opacity: 0;
                transform: scale(0.5);
            }
            50% {
                opacity: 1;
                transform: scale(1);
            }
            100% {
                opacity: 0;
                transform: scale(1.5);
            }
        }

        .purchase-text {
            color: #0ff;
            font-size: 24px;
            font-weight: bold;
            text-shadow: 0 0 10px #0ff;
            animation: purchase-text-pulse 1s ease-out;
        }

        @keyframes purchase-text-pulse {
            0% {
                transform: scale(0.5);
                opacity: 0;
            }
            70% {
                transform: scale(1.2);
                opacity: 1;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .inventory-section {
            margin-top: 20px;
            padding: 12px;
            background-color: #111;
            border-radius: 0;
            font-size: 14px;
            border: 2px solid #0a0;
            text-align: center;
            transform: translateY(0);
            transition: all var(--transition-medium) ease;
            animation: inventory-glow 4s infinite alternate;
        }

        @keyframes inventory-glow {
            0% { box-shadow: 0 0 0px #0a0; }
            100% { box-shadow: 0 0 5px #0a0; }
        }

        .inventory-section.appear {
            animation: inventoryAppear 0.6s ease-out 0.5s both;
        }
        
        @keyframes inventoryAppear {
            0% {
                opacity: 0;
                transform: translateY(20px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .inventory-section h3 {
            margin-top: 0;
            text-align: center;
            color: #0a0;
        }

        .inventory-section p {
            margin: 15px 0;
            line-height: 1.5;
            color: #0a0;
        }

        .inventory-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .inventory-item {
            padding: 12px;
            background-color: #051005;
            border: 1px solid #0a0;
            border-radius: 0;
            text-align: center;
            transition: all var(--transition-medium) ease;
            position: relative;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transform: translateY(20px);
            animation: inventory-item-appear 0.5s ease forwards;
        }

        .inventory-item:nth-child(1) { animation-delay: 0.1s; }
        .inventory-item:nth-child(2) { animation-delay: 0.2s; }
        .inventory-item:nth-child(3) { animation-delay: 0.3s; }
        .inventory-item:nth-child(4) { animation-delay: 0.4s; }
        .inventory-item:nth-child(5) { animation-delay: 0.5s; }
        .inventory-item:nth-child(6) { animation-delay: 0.6s; }
        .inventory-item:nth-child(7) { animation-delay: 0.7s; }
        .inventory-item:nth-child(8) { animation-delay: 0.8s; }

        @keyframes inventory-item-appear {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .inventory-item.empty {
            grid-column: 1 / -1;
            opacity: 0.7;
        }

        .inventory-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 255, 0, 0.2);
        }

        .inventory-icon {
            font-size: 24px;
            margin-bottom: 8px;
            transition: all var(--transition-medium) ease;
        }

        .inventory-item.active .inventory-icon {
            animation: item-active-pulse 1s infinite;
        }

        @keyframes item-active-pulse {
            0% {
                transform: scale(1);
                text-shadow: 0 0 5px currentColor;
            }
            50% {
                transform: scale(1.2);
                text-shadow: 0 0 15px currentColor, 0 0 20px currentColor;
            }
            100% {
                transform: scale(1);
                text-shadow: 0 0 5px currentColor;
            }
        }

        .inventory-name {
            font-weight: bold;
            color: #0f0;
            margin-bottom: 5px;
        }

        .inventory-description {
            font-size: 12px;
            color: #0a0;
            margin-bottom: 10px;
        }

        .inventory-count {
            position: absolute;
            top: 5px;
            right: 5px;
            background-color: #0f0;
            color: #000;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 12px;
            font-weight: bold;
            animation: countPulse 2s infinite;
        }

        @keyframes countPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .inventory-use-btn {
            background-color: #0a0;
            color: #000;
            border: none;
            padding: 5px 10px;
            font-size: 12px;
            cursor: pointer;
            font-family: 'Courier New', Courier, monospace;
            margin-top: 5px;
            transition: all var(--transition-fast) ease;
        }

        .inventory-use-btn:hover {
            background-color: #0f0;
            transform: scale(1.05);
        }

        .inventory-remove-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background-color: #9e0101;
            color: #fff;
            border: 1px solid #580000;
            border-radius: 0;
            width: 20px;
            height: 20px;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            z-index: 2;
        }

        .inventory-remove-btn:hover {
            background-color: #4b0000;
            transform: scale(1.1);
            box-shadow: 0 0 5px #ff0000;
        }

        /* Стили для инвентаря в режиме паники */
        .panic-mode .inventory-section {
            background-color: #300 !important;
            border: 2px solid #f00 !important;
        }

        .panic-mode .inventory-section h3,
        .panic-mode .inventory-section p {
            color: #f00 !important;
        }

        .panic-mode .inventory-item {
            background-color: #200 !important;
            border: 1px solid #f00 !important;
        }

        .panic-mode .inventory-name {
            color: #f00 !important;
        }

        .panic-mode .inventory-description {
            color: #a00 !important;
        }

        .panic-mode .inventory-count {
            background-color: #f00 !important;
            color: #000 !important;
        }

        .panic-mode .inventory-use-btn {
            background-color: #a00 !important;
            color: #000 !important;
        }

        .panic-mode .inventory-use-btn:hover {
            background-color: #f00 !important;
        }

        /* Стили для инвентаря в режиме тревоги */
        .alarm-mode .inventory-section {
            background-color: #333300 !important;
            border: 2px solid #ff0 !important;
        }

        .alarm-mode .inventory-section h3,
        .alarm-mode .inventory-section p {
            color: #ff0 !important;
        }

        .alarm-mode .inventory-item {
            background-color: #222200 !important;
            border: 1px solid #ff0 !important;
        }

        .alarm-mode .inventory-name {
            color: #ff0 !important;
        }

        .alarm-mode .inventory-description {
            color: #aa0 !important;
        }

        .alarm-mode .inventory-count {
            background-color: #ff0 !important;
            color: #000 !important;
        }

        .alarm-mode .inventory-use-btn {
            background-color: #aa0 !important;
            color: #000 !important;
        }

        .alarm-mode .inventory-use-btn:hover {
            background-color: #ff0 !important;
        }

        .shop-markup-note {
            font-size: 12px;
            color: #aaa;
            margin-top: 5px;
        }

        /* Стили для системы налога */
        .tax-notification {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 500;
            display: none;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .tax-notification.active {
            display: flex;
            opacity: 1;
            animation: taxNotificationAppear 0.5s ease-out;
        }
        
        @keyframes taxNotificationAppear {
            0% { opacity: 0; }
            100% { opacity: 1; }
        }
        
        .tax-popup {
            background-color: var(--background-color);
            border: 3px solid #f00;
            padding: 25px;
            max-width: 90%;
            width: 500px;
            text-align: center;
            box-shadow: 0 0 20px #f00, 0 0 40px #f00;
            animation: tax-appear 0.5s ease-out;
            transform: scale(0.9);
            opacity: 0;
        }
        
        .tax-notification.active .tax-popup {
            transform: scale(1);
            opacity: 1;
        }
        
        @keyframes tax-appear {
            0% {
                transform: scale(0.7);
                opacity: 0;
            }
            70% {
                transform: scale(1.05);
                opacity: 0.8;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        .tax-popup h3 {
            margin-top: 0;
            color: #f00;
            text-shadow: 0 0 10px #f00;
            font-size: 24px;
            animation: taxTitlePulse 2s infinite;
        }
        
        @keyframes taxTitlePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .tax-popup p {
            margin: 15px 0;
            line-height: 1.5;
            color: #f00;
        }
        
        .tax-amount {
            font-size: 32px;
            font-weight: bold;
            color: #f00;
            text-shadow: 0 0 15px #f00;
            margin: 20px 0;
            animation: tax-pulse 1s infinite alternate;
        }
        
        @keyframes tax-pulse {
            from { transform: scale(1); }
            to { transform: scale(1.1); }
        }
        
        .tax-formula {
            background-color: #300;
            padding: 10px;
            margin: 15px 0;
            border: 1px solid #f00;
            font-family: 'Courier New', Courier, monospace;
            font-size: 14px;
            color: #f00;
            animation: taxFormulaPulse 3s infinite;
        }
        
        @keyframes taxFormulaPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }
        
        .tax-pay-btn {
            background-color: #300;
            color: #f00;
            border: 2px solid #f00;
            padding: 12px 25px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 18px;
            cursor: pointer;
            transition: all var(--transition-fast) ease;
            margin-top: 15px;
        }
        
        .tax-pay-btn:hover, .tax-pay-btn:active {
            background-color: #f00;
            color: #300;
            transform: scale(1.05);
            box-shadow: 0 0 15px #f00;
        }
        
        .tax-pay-btn:disabled {
            background-color: #555;
            color: #888;
            border-color: #555;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .tax-counter {
            text-align: center;
            color: #f00;
            margin-bottom: 10px;
            font-size: 16px;
            padding: 8px;
            background-color: #200;
            border: 1px solid #f00;
            opacity: 0;
            transform: translateY(-10px);
            transition: all 0.3s ease;
        }
        
        .tax-counter.show {
            opacity: 1;
            transform: translateY(0);
            animation: taxCounterPulse 2s infinite;
        }
        
        @keyframes taxCounterPulse {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(0) scale(1.05); }
        }
        
        .tax-warning {
            color: #f00;
            text-align: center;
            margin-top: 10px;
            font-size: 14px;
            animation: blink 1s infinite;
        }

        /* Анимации для зачисления монет */
        .coins-earned-animation {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 600;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            pointer-events: none;
        }

        .coins-earned-value {
            font-size: 48px;
            font-weight: bold;
            color: #ffff00;
            text-shadow: 0 0 10px #ffff00, 0 0 20px #ffff00, 0 0 30px #ff9900;
            animation: coins-earned-float 2s ease-out forwards;
            margin-bottom: 10px;
        }

        @keyframes coins-earned-float {
            0% {
                transform: translateY(0) scale(0.5);
                opacity: 0;
            }
            20% {
                transform: translateY(-20px) scale(1.2);
                opacity: 1;
            }
            80% {
                transform: translateY(-80px) scale(1);
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) scale(0.8);
                opacity: 0;
            }
        }

        .coins-breakdown {
            display: flex;
            flex-direction: column;
            gap: 5px;
            margin-top: 10px;
            opacity: 0;
            animation: coins-breakdown-appear 0.5s ease 0.5s forwards;
        }

        @keyframes coins-breakdown-appear {
            to {
                opacity: 1;
            }
        }

        .coins-breakdown-item {
            display: flex;
            justify-content: space-between;
            font-size: 16px;
            color: #fff;
            padding: 5px 10px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 5px;
            min-width: 200px;
            opacity: 0;
            transform: translateY(10px);
            animation: breakdownItemAppear 0.3s ease-out forwards;
        }

        .coins-breakdown-item:nth-child(1) { animation-delay: 0.5s; }
        .coins-breakdown-item:nth-child(2) { animation-delay: 0.6s; }
        .coins-breakdown-item:nth-child(3) { animation-delay: 0.7s; }
        .coins-breakdown-item:nth-child(4) { animation-delay: 0.8s; }
        .coins-breakdown-item:nth-child(5) { animation-delay: 0.9s; }
        .coins-breakdown-item:nth-child(6) { animation-delay: 1.0s; }

        @keyframes breakdownItemAppear {
            0% {
                opacity: 0;
                transform: translateY(10px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .coins-breakdown-label {
            text-align: left;
        }

        .coins-breakdown-value {
            text-align: right;
            font-weight: bold;
        }

        .coins-breakdown-positive {
            color: #0f0;
        }

        .coins-breakdown-negative {
            color: #f00;
        }

        .coins-breakdown-bonus {
            color: #ff0;
        }

        /* Анимации для работы предметов */
        .item-activation {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 600;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            pointer-events: none;
        }

        .item-activation-icon {
            font-size: 64px;
            margin-bottom: 20px;
            animation: item-activation-pulse 1.5s ease-out forwards;
        }

        @keyframes item-activation-pulse {
            0% {
                transform: scale(0.5) rotate(0deg);
                opacity: 0;
            }
            30% {
                transform: scale(1.2) rotate(10deg);
                opacity: 1;
            }
            70% {
                transform: scale(1) rotate(-5deg);
                opacity: 1;
            }
            100% {
                transform: scale(1) rotate(0deg);
                opacity: 0;
            }
        }

        .item-activation-text {
            font-size: 24px;
            font-weight: bold;
            color: #fff;
            text-shadow: 0 0 10px currentColor;
            animation: item-activation-text-float 2s ease-out forwards;
        }

        @keyframes item-activation-text-float {
            0% {
                transform: translateY(0);
                opacity: 0;
            }
            30% {
                transform: translateY(-10px);
                opacity: 1;
            }
            70% {
                transform: translateY(-20px);
                opacity: 1;
            }
            100% {
                transform: translateY(-30px);
                opacity: 0;
            }
        }

        /* Стилизация скроллбара */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: var(--background-color);
            border: 1px solid var(--secondary-color);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 0;
            box-shadow: 0 0 5px var(--primary-color);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent-color);
            box-shadow: 0 0 10px var(--accent-color);
        }

        /* Стили для эффекта пепла */
        #ashCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 100;
            image-rendering: pixelated;
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideInFromRight {
            from { transform: translateX(100px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideInFromBottom {
            from { transform: translateY(100px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes slideInFromTop {
            from { transform: translateY(-100px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes scaleIn {
            from { transform: scale(0); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        @keyframes rotateIn {
            from { transform: rotate(-180deg) scale(0); opacity: 0; }
            to { transform: rotate(0) scale(1); opacity: 1; }
        }

        @keyframes bounceIn {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }

        @keyframes pulseIn {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* Анимации для кнопок */
        .btn-pulse {
            animation: btnPulse 2s infinite;
        }

        @keyframes btnPulse {
            0% { box-shadow: 0 0 0 0 rgba(0, 255, 0, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(0, 255, 0, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 255, 0, 0); }
        }

        /* Анимации для чисел */
        .number-animation {
            animation: numberScale 0.5s ease-out;
        }

        @keyframes numberScale {
            0% { transform: scale(1); }
            50% { transform: scale(1.5); }
            100% { transform: scale(1); }
        }

        /* Анимации для успешных действий */
        .success-animation {
            animation: successBounce 0.5s ease-out;
        }

        @keyframes successBounce {
            0% { transform: scale(1); }
            25% { transform: scale(1.2); }
            50% { transform: scale(0.9); }
            75% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* Анимации для ошибок */
        .error-animation {
            animation: errorShake 0.5s ease-out;
        }

        @keyframes errorShake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        /* Анимации для появления элементов с задержкой */
        .delay-1 { animation-delay: 0.1s; }
        .delay-2 { animation-delay: 0.2s; }
        .delay-3 { animation-delay: 0.3s; }
        .delay-4 { animation-delay: 0.4s; }
        .delay-5 { animation-delay: 0.5s; }
        .delay-6 { animation-delay: 0.6s; }
        .delay-7 { animation-delay: 0.7s; }
        .delay-8 { animation-delay: 0.8s; }
        .delay-9 { animation-delay: 0.9s; }
        .delay-10 { animation-delay: 1.0s; }

        /* Медиа-запросы для адаптивности */
        @media (min-width: 480px) {
            .buttons-container {
                flex-direction: row;
            }
            
            .stats {
                flex-direction: row;
            }
            
            .stats-row {
                flex: 1;
            }
        }
        
        @media (min-width: 768px) {
            body {
                padding: 20px;
            }
            
            .container {
                max-width: 700px;
                margin: 0 auto;
                padding: 25px;
            }
            
            h1 {
                font-size: 24px;
            }
            
            .game-area {
                padding: 15px;
            }
            
            .buttons-container {
                flex-direction: row;
            }
        }
        
        /* Отключение анимаций для пользователей, предпочитающих уменьшенное движение */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body class="crt-effect">
    <div class="scan-line"></div>
    <div class="crt-noise"></div>
    <div class="vignette"></div>
    <div class="power-light"></div>

    <!-- Эффект пепла -->
    <canvas id="ashCanvas"></canvas>

    <!-- Анимации для зачисления монет -->
    <div class="coins-earned-animation" id="coinsEarnedAnimation" style="display: none;">
        <div class="coins-earned-value" id="coinsEarnedValue">+0</div>
        <div class="coins-breakdown" id="coinsBreakdown">
            <!-- Будет заполнено динамически -->
        </div>
    </div>
    
    <!-- Анимации для работы предметов -->
    <div class="item-activation" id="itemActivation" style="display: none;">
        <div class="item-activation-icon" id="itemActivationIcon">⚡</div>
        <div class="item-activation-text" id="itemActivationText">Активирован!</div>
    </div>
    
    <!-- Счетчик до налога -->
    <div id="taxCounter" class="tax-counter">
        До налога осталось: <span id="taxCounterValue">10</span> игр
    </div>
    
    <!-- Уведомление о налоге -->
    <div id="taxNotification" class="tax-notification">
        <div class="tax-popup">
            <h3>НАЛОГОВАЯ СЛУЖБА</h3>
            <p>Вы достигли <span id="taxGamesPlayed">10</span> игр. Необходимо оплатить налог!</p>
            <div class="tax-amount" id="taxAmount">0 монеток</div>
            <div class="tax-formula" id="taxFormula">
                Формула налога: ((-Среднее * 3) + (Число игр * 10) - Анти-Рекорд) + Бонус Рекорда%
            </div>
            <p>Если налог не будет оплачен, весь прогресс будет сброшен!</p>
            <button id="payTaxBtn" class="tax-pay-btn">ОПЛАТИТЬ НАЛОГ</button>
        </div>
    </div>
    
    <!-- Новый элемент для подсказки -->
    <div class="hint-overlay" id="hintOverlay"></div>
    <div class="hint-popup" id="hintPopup">
        <div class="hint-title">ПОДСКАЗКА СИСТЕМЫ</div>
        <div>Попробуй число:</div>
        <div class="hint-value" id="hintNumber">500</div>
        <div class="hint-timer">Исчезнет через: <span id="hintTimer">5</span> сек.</div>
    </div>
    
    <!-- Таймер режима паники -->
    <div class="panic-timer" id="panicTimer">
        <div class="timer-text">РЕЖИМ ПАНИКИ!</div>
        <div class="timer-count" id="timerCount">10</div>
        <div class="timer-text">+15 попыток через:</div>
    </div>
    
    <!-- Таймер режима тревоги -->
    <div class="alarm-timer" id="alarmTimer">
        <div class="timer-text">РЕЖИМ ТРЕВОГИ!</div>
        <div class="timer-count" id="alarmTimerCount">20</div>
        <div class="timer-text">+10 попыток через:</div>
    </div>
    
    <!-- Окно подтверждения сброса прогресса -->
    <div class="reset-confirm-overlay" id="resetConfirmOverlay">
        <div class="reset-confirm-popup">
            <h3>СБРОС ПРОГРЕССА</h3>
            <p>Вы уверены, что хотите сбросить ВЕСЬ прогресс за ВСЕ игры?</p>
            <p>Это действие нельзя отменить!</p>
            <div class="reset-confirm-buttons">
                <button id="confirmResetBtn" class="reset-confirm-btn">ДА, СБРОСИТЬ</button>
                <button id="cancelResetBtn" class="reset-confirm-btn">ОТМЕНА</button>
            </div>
        </div>
    </div>

    <!-- Окно подтверждения удаления предмета -->
    <div class="remove-confirm-overlay" id="removeConfirmOverlay">
        <div class="remove-confirm-popup">
            <h3>УДАЛЕНИЕ ПРЕДМЕТА</h3>
            <p id="removeConfirmMessage">Вы уверены, что хотите уничтожить предмет?</p>
            <p>Цена предмета не вернётся вам обратно!</p>
            <div class="remove-confirm-buttons">
                <button id="confirmRemoveBtn" class="remove-confirm-btn">УНИЧТОЖИТЬ</button>
                <button id="cancelRemoveBtn" class="remove-confirm-btn">ОТМЕНА</button>
            </div>
        </div>
    </div>

    <!-- Окно подтверждения удаления предмета -->
    <div class="remove-confirm-overlay" id="removeConfirmOverlay">
        <div class="remove-confirm-popup">
            <h3>УДАЛЕНИЕ ПРЕДМЕТА</h3>
            <p id="removeConfirmMessage">Вы уверены, что хотите уничтожить предмет?</p>
            <p>Цена предмета не вернётся вам обратно!</p>
            <div class="remove-confirm-buttons">
                <button id="confirmRemoveBtn" class="remove-confirm-btn">УНИЧТОЖИТЬ</button>
                <button id="cancelRemoveBtn" class="remove-confirm-btn">ОТМЕНА</button>
            </div>
        </div>
    </div>

    <div class="shop-overlay" id="shopOverlay">
        <div class="shop-popup">
            <h3>МАГАЗИН</h3>
            <div class="shop-coins-display" id="shopCoinsDisplay">0</div>
            <div class="shop-info">
                <div class="shop-markup-text">Текущая наценка:</div>
                <div class="shop-markup-value" id="shopMarkup">0%</div>
                <div class="shop-note">Наценка равна среднему количеству попыток за все игры</div>
            </div>
            <div class="shop-items" id="shopItems">
                <!-- Товары будут добавляться динамически -->
            </div>
            <button class="shop-close-btn" id="shopCloseBtn">ЗАКРЫТЬ</button>
        </div>
    </div>
    
    <div class="container pixel-border appear">
        <h1 class="glitch-text" data-text="PROJECT 500">PROJECT 500</h1>
        <div class="subtitle terminal-text">МАКСИМ ЗАКИРОВ 0.10 | HTML EDITION</div>
        
        <div class="game-area pixel-border-reverse appear">
            <p>Я загадал число от 1 до 1000. Попробуй угадать его!</p>
            
            <input type="number" id="guessInput" min="1" max="1000" placeholder="Введите число от 1 до 1000" inputmode="numeric">
            
            <div class="buttons-container">
                <button id="guessBtn" class="pixel-border btn-pulse">ПРОВЕРИТЬ</button>
                <button id="newGameBtn" class="pixel-border btn-pulse">НОВАЯ ИГРА</button>
            </div>
            
            <div id="message" class="message"></div>
            <div id="attempts" class="attempts">Попытки: 0</div>
            
            <!-- Визуализация диапазона -->
            <div class="range-visualization appear" id="rangeVisualization">
                <div class="range-scale" id="rangeScale">
                    <div class="range-current" id="rangeCurrent"></div>
                    <!-- Маркеры будут добавляться динамически -->
                </div>
                <div class="range-numbers">
                    <span>1</span>
                    <span>1000</span>
                </div>
                <div class="stats">
                    <div class="stats-row">
                        <div>Минимум: <span id="minValue">1</span></div>
                        <div>Максимум: <span id="maxValue">1000</span></div>
                    </div>
                    <div class="stats-row">
                        <div>Текущий диапазон: <span id="currentRange">1-1000</span></div>
                    </div>
                </div>
                <div id="panicWarning" class="panic-warning" style="display: none;">
                    ВНИМАНИЕ! Диапазон сужается! Скоро активируется режим паники!
                </div>
                <div id="alarmWarning" class="alarm-warning" style="display: none;">
                    ВНИМАНИЕ! Следующая активация режима тревоги через: <span id="alarmAttemptsLeft">2</span> попыток
                </div>
            </div>
            
            <!-- Секция истории -->
            <div class="history-section appear">
                <h3>ИСТОРИЯ ПОПЫТОК:</h3>
                <div id="historyList" class="history-list">
                    <!-- История будет добавляться сюда -->
                </div>
            </div>
            
            <!-- Секция статистики -->
            <div class="stats-section appear">
                <h3>СТАТИСТИКА:</h3>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-label">СЫГРАНО ИГР</div>
                        <div class="stat-value" id="gamesPlayed">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">РЕКОРД</div>
                        <div class="stat-value" id="bestScore">-</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">МОНЕТКИ</div>
                        <div class="stat-value coins-value" id="coins">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">АНТИ-РЕКОРД</div>
                        <div class="stat-value" id="worstScore">-</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">СРЕДНЕЕ</div>
                        <div class="stat-value" id="averageAttempts">-</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">ПОСЛЕДНЯЯ</div>
                        <div class="stat-value" id="lastAttempts">-</div>
                    </div>
                </div>
            </div>

            <div class="shop-section appear">
                <h3>МАГАЗИН</h3>
                <p>Тратьте заработанные монетки на улучшения!</p>
                <button id="shopBtn" class="pixel-border">ОТКРЫТЬ МАГАЗИН</button>
            </div>
            
            <div class="inventory-section appear">
                <h3>ИНВЕНТАРЬ</h3>
                <p>Здесь отображаются ваши приобретенные улучшения</p>
                <div id="inventoryList" class="inventory-list">
                    <div class="inventory-item empty">
                        <div class="inventory-icon">📦</div>
                        <div class="inventory-name">Инвентарь пуст</div>
                        <div class="inventory-description">Купите улучшения в магазине</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="rules pixel-border-reverse appear">
            <h3>ПРАВИЛА ИГРЫ:</h3>
            <ul>
                <li>Компьютер загадывает случайное число от 1 до 1000</li>
                <li>Вы вводите число в поле выше и нажимаете "ПРОВЕРИТЬ"</li>
                <li>Компьютер подскажет, больше или меньше загаданное число</li>
                <li>Цель - угадать число за минимальное количество попыток</li>
                <li>За каждую игру вы получаете монетки, количество равным загаданному числу</li>
                <li>Каждая попытка стоит 1 монетку</li>
                <li>Бонусы за рекорды: ≤2 попыток = +40%, ≤6 попыток = +20%, ≤8 попыток = +15%</li>
                <li>Для начала новой игры нажмите кнопку "НОВАЯ ИГРА"</li>
                <li>Все ваши попытки сохраняются в истории ниже</li>
                <li>Диапазон возможных чисел сужается после каждой попытки</li>
                <li>Когда диапазон становится узким, он начинает светиться!</li>
                <li>При сужении диапазона до 10 чисел активируется режим паники!</li>
                <li>После 10 попыток и затем каждые 2 попытки активируется режим тревоги!</li>
                <li>Каждые 5 попыток система предлагает подсказку</li>
                <li>Режим тревоги отключается после ввода числа</li>
                <li>В магазине можно приобрести улучшения за монетки</li>
                <li>Предмет "Бонусная Сложность": каждая попытка с вероятностью 50% активирует режим тревоги на 5 секунд. Если таймер истекает, добавляется 5 попыток. Если успеваете ввести число до истечения таймера, получаете +25% монеток. Работает до 3 раз за игру.</li>
                <li>Предмет "Успокаивающие": увеличивает таймер паники до 15 секунд</li>
                <li>Предмет "Отличник": повышает вероятность появления цифры 5 в загаданном числе на 30%</li>
                <li>Предмет "Золотые Пятёрки": даёт +10 монет за каждую цифру 5 в загаданном числе</li>
                <li>Предмет "Монетка": с вероятностью 1% удваивает все бонусы в конце игры</li>
                <li>Предмет "Пятроица": увеличивает заработок в 5 раз, если загаданное число равно 555</li>
                <li>Предмет "Project 500": при наличии в инвентаре загаданное число будет в районе 500-599 включительно</li>
                <li>Каждую 10-ю игру взимается налог: ((-Среднее * 3) + (Число игр * 10) - Анти-Рекорд) + Бонус Рекорда%</li>
                <li>Если налог не оплачен, весь прогресс сбрасывается</li>
            </ul>
        </div>
        
        <!-- Новая секция с кнопкой сброса прогресса -->
        <div class="reset-section appear">
            <h3>ОПАСНАЯ ЗОНА</h3>
            <p>Нажатие этой кнопки полностью сбросит всю статистику и прогресс</p>
            <button id="resetProgressBtn" class="pixel-border">СБРОСИТЬ ВЕСЬ ПРОГРЕСС</button>
        </div>

        <!-- Глобальная статистика -->
        <div class="stats-section global-stats-section appear">
            <h3>ГЛОБАЛЬНАЯ СТАТИСТИКА</h3>
            <p>Накопительная статистика за все игры, которая никогда не сбрасывается</p>
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-label">ВСЕ ИГРЫ ВООБЩЕ</div>
                    <div class="stat-value" id="totalGamesEver">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">ЛУЧШИЙ РЕКОРД ВООБЩЕ</div>
                    <div class="stat-value" id="bestScoreEver">-</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">АНТИ-РЕКОРД ВООБЩЕ</div>
                    <div class="stat-value" id="worstScoreEver">-</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">СРЕДНЕЕ ВООБЩЕ</div>
                    <div class="stat-value" id="averageAttemptsEver">-</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        /* ===========================================
           ИГРОВЫЕ ПЕРЕМЕННЫЕ И КОНСТАНТЫ
           =========================================== */

        // Переменные для удаления предметов
        let itemToRemove = null;

        // Основные переменные игрового состояния
        let targetNumber;          // Загаданное число
        let attempts;              // Текущее количество попыток
        let gameActive;            // Флаг активности игры
        let guessHistory;          // История попыток

        // Константы диапазона чисел
        const minRange = 1;        // Минимальное возможное число
        const maxRange = 1000;     // Максимальное возможное число

        // Переменные текущего диапазона поиска
        let currentMin;            // Текущая нижняя граница
        let currentMax;            // Текущая верхняя граница

        // Переменные режима паники
        let panicModeActive = false;
        let panicTimer;
        let panicTimeLeft = 10;
        
        // Переменные для режима тревоги
        let alarmModeActive = false;
        let alarmTimer;
        let alarmTimeLeft = 30;
        let nextAlarmAttempt = 10; // Первая активация на 10-й попытке
        
        // Переменные для системы подсказок
        let hintActive = false;
        let hintTimer;
        let hintTimeLeft = 5;
        
        // Статистика
        let gamesPlayed = 0;
        let bestScore = null;
        let worstScore = null;
        let totalAttempts = 0;
        let lastAttempts = 0;
        let coins = 0;

        // Глобальная статистика (не сбрасывается никогда)
        let totalGamesEver = 0;
        let bestScoreEver = null;
        let worstScoreEver = null;
        let totalAttemptsEver = 0;
        let averageAttemptsEver = 0;
        
        // Система налога
        let taxActive = false;
        let taxAmount = 0;
        let taxGamesPlayed = 0;
        
        // Инвентарь и магазин
        let inventory = [];
        let shopItems = [
            {
                id: 'bonus_difficulty',
                name: 'Бонусная Сложность',
                description: 'Каждая попытка с вероятностью 50% активирует режим тревоги на 5 секунд. Если таймер истекает, добавляется 5 попыток. Если успеваете ввести число до истечения таймера, получаете +25% монеток. Работает до 3 раз за игру.',
                price: 1000,
                icon: '⚡',
                owned: false
            },
            {
                id: 'calming_pills',
                name: 'Успокаивающие',
                description: 'Увеличивает таймер паники до 15 секунд, давая больше времени на реакцию.',
                price: 100,
                icon: '💊',
                owned: false
            },
            {
                id: 'switch',
                name: 'Выключатель',
                description: 'С вероятностью 50% за игру отключает режим тревоги на всю текущую игру.',
                price: 500,
                icon: '🔌',
                owned: false
            },
            {
                id: 'attempts_falsification',
                name: 'Фальсификация Попыток',
                description: 'Снижает наценку в магазине на 20%, делая товары дешевле.',
                price: 150,
                icon: '📉',
                owned: false
            },
            {
                id: 'five_bonus',
                name: 'Пятёрочка выручает',
                description: 'Добавляет бонус 35% монеток от имеющихся в конце игры, если в загаданном числе присутствует цифра 5.',
                price: 55,
                icon: '5️',
                owned: false
            },
            {
                id: 'golden_fives',
                name: 'Золотые Пятёрки',
                description: 'Даёт +10 монет за каждую цифру 5 в загаданном числе',
                price: 155,
                icon: '💰',
                owned: false
            },
            {
                id: 'excellent_student',
                name: 'Отличник',
                description: 'Повышает вероятность появления цифры 5 в загаданном числе на 60%',
                price: 100,
                icon: '🎓',
                owned: false
            },
            {
                id: 'lucky_coin',
                name: 'Монетка',
                description: 'С вероятностью 1% удваивает все бонусы в конце игры',
                price: 800,
                icon: '🪙',
                owned: false
            },
            {
                id: 'triad',
                name: 'Пятроица',
                description: 'Увеличивает заработок в 5 раз, если загаданное число равно 555.',
                price: 5555,
                icon: '✨',
                owned: false
            },
            {
                id: 'project_500',
                name: 'Project 500',
                description: 'При наличии в инвентаре загаданное число будет в районе 500-599 включительно.',
                price: 500,
                icon: '🎯',
                owned: false
            }
        ];
        
        // Переменные для бонусной сложности
        let bonusDifficultyActive = false;
        let bonusDifficultyTimer;
        let bonusDifficultyTimeLeft = 5;
        let bonusDifficultyUses = 0;
        const maxBonusDifficultyUses = 3;
        
        // Элементы DOM
        const guessInput = document.getElementById('guessInput');
        const guessBtn = document.getElementById('guessBtn');
        const newGameBtn = document.getElementById('newGameBtn');
        const messageEl = document.getElementById('message');
        const attemptsEl = document.getElementById('attempts');
        const historyListEl = document.getElementById('historyList');
        const rangeScaleEl = document.getElementById('rangeScale');
        const rangeCurrentEl = document.getElementById('rangeCurrent');
        const minValueEl = document.getElementById('minValue');
        const maxValueEl = document.getElementById('maxValue');
        const currentRangeEl = document.getElementById('currentRange');
        const rangeVisualizationEl = document.getElementById('rangeVisualization');
        const panicTimerEl = document.getElementById('panicTimer');
        const timerCountEl = document.getElementById('timerCount');
        const panicWarningEl = document.getElementById('panicWarning');
        const bodyEl = document.body;
        const shopBtn = document.getElementById('shopBtn');
        const shopOverlay = document.getElementById('shopOverlay');
        const shopCloseBtn = document.getElementById('shopCloseBtn');
        const shopCoinsDisplay = document.getElementById('shopCoinsDisplay');
        const shopItemsEl = document.getElementById('shopItems');
        const inventoryListEl = document.getElementById('inventoryList');
        
        // Элементы для режима тревоги
        const alarmTimerEl = document.getElementById('alarmTimer');
        const alarmTimerCountEl = document.getElementById('alarmTimerCount');
        const alarmWarningEl = document.getElementById('alarmWarning');
        const alarmAttemptsLeftEl = document.getElementById('alarmAttemptsLeft');
        
        // Элементы для подсказок
        const hintPopup = document.getElementById('hintPopup');
        const hintOverlay = document.getElementById('hintOverlay');
        const hintNumberEl = document.getElementById('hintNumber');
        const hintTimerEl = document.getElementById('hintTimer');
        
        // Элементы статистики
        const gamesPlayedEl = document.getElementById('gamesPlayed');
        const bestScoreEl = document.getElementById('bestScore');
        const worstScoreEl = document.getElementById('worstScore');
        const coinsEl = document.getElementById('coins');
        const averageAttemptsEl = document.getElementById('averageAttempts');
        const lastAttemptsEl = document.getElementById('lastAttempts');
        
        // Элементы для сброса прогресса
        const resetProgressBtn = document.getElementById('resetProgressBtn');
        const resetConfirmOverlay = document.getElementById('resetConfirmOverlay');
        const confirmResetBtn = document.getElementById('confirmResetBtn');
        const cancelResetBtn = document.getElementById('cancelResetBtn');

        // Элементы для системы налога
        const taxCounter = document.getElementById('taxCounter');
        const taxCounterValue = document.getElementById('taxCounterValue');
        const taxNotification = document.getElementById('taxNotification');
        const taxGamesPlayedEl = document.getElementById('taxGamesPlayed');
        const taxAmountEl = document.getElementById('taxAmount');
        const payTaxBtn = document.getElementById('payTaxBtn');

        // Элементы для анимаций
        const coinsEarnedAnimation = document.getElementById('coinsEarnedAnimation');
        const coinsEarnedValue = document.getElementById('coinsEarnedValue');
        const coinsBreakdown = document.getElementById('coinsBreakdown');
        const itemActivation = document.getElementById('itemActivation');
        const itemActivationIcon = document.getElementById('itemActivationIcon');
        const itemActivationText = document.getElementById('itemActivationText');

        // Элементы для удаления предметов
        const removeConfirmOverlay = document.getElementById('removeConfirmOverlay');
        const confirmRemoveBtn = document.getElementById('confirmRemoveBtn');
        const cancelRemoveBtn = document.getElementById('cancelRemoveBtn');
        const removeConfirmMessage = document.getElementById('removeConfirmMessage');

        // Функции для анимаций
        function showCoinsEarnedAnimation(coinsCalculation) {
            // Устанавливаем значение
            coinsEarnedValue.textContent = `+${coinsCalculation.total}`;
            
            // Создаем разбивку заработка
            coinsBreakdown.innerHTML = '';
            
            // Базовая сумма
            const baseItem = document.createElement('div');
            baseItem.className = 'coins-breakdown-item';
            baseItem.innerHTML = `
                <span class="coins-breakdown-label">Базовая сумма:</span>
                <span class="coins-breakdown-value coins-breakdown-positive">+${coinsCalculation.base}</span>
            `;
            coinsBreakdown.appendChild(baseItem);
            
            // Штраф за попытки
            const penaltyItem = document.createElement('div');
            penaltyItem.className = 'coins-breakdown-item';
            penaltyItem.innerHTML = `
                <span class="coins-breakdown-label">Штраф за попытки:</span>
                <span class="coins-breakdown-value coins-breakdown-negative">-${coinsCalculation.penalty}</span>
            `;
            coinsBreakdown.appendChild(penaltyItem);
            
            // Бонус за рекорд (если есть)
            if (coinsCalculation.bonusPercent > 0) {
                const bonusItem = document.createElement('div');
                bonusItem.className = 'coins-breakdown-item';
                bonusItem.innerHTML = `
                    <span class="coins-breakdown-label">Бонус за рекорд (${coinsCalculation.bonusPercent}%):</span>
                    <span class="coins-breakdown-value coins-breakdown-bonus">+${coinsCalculation.bonus}</span>
                `;
                coinsBreakdown.appendChild(bonusItem);
            }
            
            // Бонус "Пятёрочка" (если есть)
            if (coinsCalculation.fiveBonus > 0) {
                const fiveBonusItem = document.createElement('div');
                fiveBonusItem.className = 'coins-breakdown-item';
                fiveBonusItem.innerHTML = `
                    <span class="coins-breakdown-label">Бонус "Пятёрочка":</span>
                    <span class="coins-breakdown-value coins-breakdown-bonus">+${coinsCalculation.fiveBonus}</span>
                `;
                coinsBreakdown.appendChild(fiveBonusItem);
            }
            
            // Бонус: Золотые Пятёрки (если есть)
            if (coinsCalculation.goldenFives > 0) {
                const goldenFivesItem = document.createElement('div');
                goldenFivesItem.className = 'coins-breakdown-item';
                const fivesCount = countFivesInNumber(targetNumber);
                goldenFivesItem.innerHTML = `
                    <span class="coins-breakdown-label">Золотые Пятёрки (${fivesCount} × 10):</span>
                    <span class="coins-breakdown-value coins-breakdown-bonus">+${coinsCalculation.goldenFives}</span>
                `;
                coinsBreakdown.appendChild(goldenFivesItem);
            }
            
            // Бонус: Монетка (если сработала)
            if (coinsCalculation.luckyCoin) {
                const luckyCoinItem = document.createElement('div');
                luckyCoinItem.className = 'coins-breakdown-item';
                luckyCoinItem.innerHTML = `
                    <span class="coins-breakdown-label">УДВОЕНИЕ МОНЕТКОЙ!</span>
                    <span class="coins-breakdown-value coins-breakdown-bonus">×2</span>
                `;
                coinsBreakdown.appendChild(luckyCoinItem);

                // Добавляем особый эффект к анимации
                coinsEarnedValue.style.color = '#ff0';
                coinsEarnedValue.style.textShadow = '0 0 20px #ff0, 0 0 30px #ff0, 0 0 40px #ff9900';
            }

            // Бонус: Пятроица (если сработала)
            if (coinsCalculation.triad) {
                const triadItem = document.createElement('div');
                triadItem.className = 'coins-breakdown-item';
                triadItem.innerHTML = `
                    <span class="coins-breakdown-label">ПЯТРОИЦА!</span>
                    <span class="coins-breakdown-value coins-breakdown-bonus">×5</span>
                `;
                coinsBreakdown.appendChild(triadItem);
            }

            // Показываем анимацию
            coinsEarnedAnimation.style.display = 'flex';
            
            // Скрываем анимацию через 3 секунды
            setTimeout(() => {
                coinsEarnedAnimation.style.display = 'none';
                // Сбрасываем стили
                coinsEarnedValue.style.color = '';
                coinsEarnedValue.style.textShadow = '';
            }, 3000);
        }
        
        function showItemActivationAnimation(itemName, itemIcon) {
            // Устанавливаем иконку и текст
            itemActivationIcon.textContent = itemIcon;
            itemActivationText.textContent = `${itemName} активирован!`;

            // Показываем анимацию
            itemActivation.style.display = 'flex';

            // Скрываем анимацию через 2 секунды
            setTimeout(() => {
                itemActivation.style.display = 'none';
            }, 2000);
        }

        // Функции для подтверждения удаления предметов
        function showRemoveConfirm(itemId) {
            const item = shopItems.find(i => i.id === itemId);
            if (!item) return;

            itemToRemove = itemId;
            removeConfirmMessage.textContent = `Вы уверены, что хотите уничтожить "${item.name}"?`;
            removeConfirmOverlay.classList.add('active');
        }

        function confirmRemoveItem() {
            if (!itemToRemove) return;

            const item = shopItems.find(i => i.id === itemToRemove);
            if (item) {
                inventory = inventory.filter(id => id !== itemToRemove);
                item.owned = false;
                saveStats();
                updateInventoryDisplay();
                updateShopDisplay();
                messageEl.textContent = `Предмет "${item.name}" удалён!`;
                messageEl.className = 'message hint';
            }

            itemToRemove = null;
            removeConfirmOverlay.classList.remove('active');
        }

        function cancelRemoveItem() {
            itemToRemove = null;
            removeConfirmOverlay.classList.remove('active');
        }

        function generateTargetNumber() {
            let number;

            // Если предмет "Project 500" куплен, загаданное число будет в районе 500-599
            if (inventory.includes('project_500')) {
                number = Math.floor(Math.random() * 100) + 500; // 500-599
            } else {
                // Обычная логика
                // Если предмет "Отличник" куплен, увеличиваем вероятность цифры 5
                if (inventory.includes('excellent_student')) {
                    // 80% шанс сгенерировать число с цифрой 5
                    if (Math.random() < 0.8) {
                        // Генерируем число, гарантированно содержащее цифру 5
                        const numbersWithFive = [];

                        // Собираем все числа от 1 до 1000, содержащие цифру 5
                        for (let i = 1; i <= 1000; i++) {
                            if (i.toString().includes('5')) {
                                numbersWithFive.push(i);
                            }
                        }

                        // Выбираем случайное число из этого списка
                        number = numbersWithFive[Math.floor(Math.random() * numbersWithFive.length)];
                    } else {
                        // Обычная генерация
                        number = Math.floor(Math.random() * (maxRange - minRange + 1)) + minRange;
                    }
                } else {
                    // Обычная генерация
                    number = Math.floor(Math.random() * (maxRange - minRange + 1)) + minRange;
                }
            }

            return number;
        }

        function countFivesInNumber(number) {
            return number.toString().split('').filter(digit => digit === '5').length;
        }

        // Функция для проверки срабатывания Монетки
        function checkLuckyCoin() {
            if (inventory.includes('lucky_coin') && Math.random() < 0.01) {
                return true;
            }
            return false;
        }
        
        function showPurchaseAnimation(itemElement) {
            // Создаем элемент анимации покупки
            const purchaseAnimation = document.createElement('div');
            purchaseAnimation.className = 'purchase-animation';
            
            const purchaseText = document.createElement('div');
            purchaseText.className = 'purchase-text';
            purchaseText.textContent = 'КУПЛЕНО!';
            
            purchaseAnimation.appendChild(purchaseText);
            itemElement.appendChild(purchaseAnimation);
            
            // Удаляем анимацию после завершения
            setTimeout(() => {
                purchaseAnimation.remove();
            }, 1000);
        }

        // Функции для системы налога
        function calculateTax() {
            // Формула налога: ((-Среднее * 3) + (Число игр * 10) - Анти-Рекорд) + Бонус Рекорда%
            const average = gamesPlayed > 0 ? totalAttempts / gamesPlayed : 0;
            const gamesCount = taxGamesPlayed; // Число игр, на которое приходит налог (10, 20, 30...)
            const worst = worstScore || 0;
            
            // Бонус рекорда%
            let bonusPercent = 0;
            if (bestScore !== null) {
                if (bestScore <= 2) {
                    bonusPercent = 40;
                } else if (bestScore <= 6) {
                    bonusPercent = 20;
                } else if (bestScore <= 8) {
                    bonusPercent = 15;
                }
            }
            
            // Расчет налога
            let tax = ((-average * 3) + (gamesCount * 10) - worst);
            
            // Добавляем бонус рекорда%
            tax = tax + (tax * bonusPercent / 100);
            
            // Округляем и убеждаемся, что налог не отрицательный
            tax = Math.round(Math.max(0, tax));
            
            return tax;
        }
        
        function checkTax() {
            // Проверяем, не настало ли время для налога (каждые 10 игр)
            if (gamesPlayed > 0 && gamesPlayed % 10 === 0 && gamesPlayed !== taxGamesPlayed) {
                taxGamesPlayed = gamesPlayed;
                taxAmount = calculateTax();
                activateTax();
            }
            
            // Обновляем счетчик до следующего налога
            updateTaxCounter();
        }
        
        function updateTaxCounter() {
            if (taxActive) {
                taxCounter.classList.remove('show');
                return;
            }
            
            const gamesUntilTax = 10 - (gamesPlayed % 10);
            taxCounterValue.textContent = gamesUntilTax;
            
            if (gamesUntilTax < 10) {
                taxCounter.classList.add('show');
            } else {
                taxCounter.classList.remove('show');
            }
        }
        
        function activateTax() {
            taxActive = true;
            
            // Блокируем игровые кнопки
            guessInput.disabled = true;
            guessBtn.disabled = true;
            newGameBtn.disabled = true;
            
            // Показываем уведомление о налоге
            taxGamesPlayedEl.textContent = taxGamesPlayed;
            taxAmountEl.textContent = `${taxAmount} монеток`;
            taxNotification.classList.add('active');
            
            // Сохраняем состояние налога
            saveStats();
        }
        
        function payTax() {
            if (coins >= taxAmount) {
                // Списываем налог
                coins -= taxAmount;
                
                // Деактивируем налог
                taxActive = false;
                taxNotification.classList.remove('active');
                
                // Разблокируем игровые кнопки
                guessInput.disabled = false;
                guessBtn.disabled = false;
                newGameBtn.disabled = false;
                
                // Обновляем отображение статистики
                updateStatsDisplay(true);
                
                // Сохраняем состояние
                saveStats();
                
                // Показываем сообщение
                messageEl.textContent = `Налог оплачен! Списано ${taxAmount} монеток.`;
                messageEl.className = 'message success';
            } else {
                // Недостаточно монеток для оплаты налога - сбрасываем прогресс
                messageEl.textContent = 'Недостаточно монеток для оплаты налога! Прогресс будет сброшен.';
                messageEl.className = 'message hint';
                
                // Сбрасываем прогресс через небольшую задержку
                setTimeout(resetProgress, 3000);
            }
        }
        
        // Функции для магазина
        function openShop() {
            updateShopDisplay();
            shopOverlay.classList.add('active');
        }
        
        function closeShop() {
            shopOverlay.classList.remove('active');
        }
        
        function updateShopDisplay() {
            // Обновляем отображение монеток в магазине
            shopCoinsDisplay.textContent = coins;
            
            // Обновляем наценку
            const shopMarkupEl = document.getElementById('shopMarkup');
            let markup = 0;
            
            if (gamesPlayed > 0) {
                // Наценка равна среднему количеству попыток (округляем до целого)
                markup = Math.round(totalAttempts / gamesPlayed);
            }
            
            // Фальсификация Попыток снижает наценку на 20%
            if (inventory.includes('attempts_falsification')) {
                markup = markup - 20;
            }
            
            shopMarkupEl.textContent = `${markup}%`;
            
            // Обновляем список товаров
            renderShopItems(markup);
        }
        
        function renderShopItems(markup) {
            shopItemsEl.innerHTML = '';
            
            shopItems.forEach(item => {
                const shopItemEl = document.createElement('div');
                shopItemEl.className = 'shop-item';
                if (item.owned) {
                    shopItemEl.classList.add('purchased');
                }
                
                const owned = inventory.includes(item.id);
                
                // Рассчитываем окончательную цену с учетом наценки
                const finalPrice = Math.round(item.price * (1 + markup / 100));
                
                shopItemEl.innerHTML = `
                    <div class="shop-item-name">${item.icon} ${item.name}</div>
                    <div class="shop-item-description">${item.description}</div>
                    <div class="shop-item-price">
                        <span class="shop-original-price">${item.price} монеток</span>
                        <span class="shop-final-price">${finalPrice} монеток</span>
                    </div>
                    <div class="shop-markup-note">(Наценка: +${markup}%)</div>
                    ${owned ? 
                        '<div class="shop-item-owned">✓ УЖЕ КУПЛЕНО</div>' : 
                        `<button class="shop-buy-btn" data-item="${item.id}" data-price="${finalPrice}" ${coins < finalPrice ? 'disabled' : ''}>КУПИТЬ</button>`
                    }
                `;
                
                shopItemsEl.appendChild(shopItemEl);
            });
            
            // Добавляем обработчики событий для кнопок покупки
            document.querySelectorAll('.shop-buy-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const itemId = this.getAttribute('data-item');
                    const price = parseInt(this.getAttribute('data-price'));
                    buyItem(itemId, price, this.closest('.shop-item'));
                });
            });
        }
        
        function buyItem(itemId, price, itemElement) {
            const item = shopItems.find(i => i.id === itemId);
            
            if (!item) return;
            
            if (coins < price) {
                messageEl.textContent = 'Недостаточно монеток для покупки!';
                messageEl.className = 'message hint';
                return;
            }
            
            if (inventory.includes(itemId)) {
                messageEl.textContent = 'Этот предмет уже куплен!';
                messageEl.className = 'message hint';
                return;
            }
            
            // Покупка предмета
            coins -= price;
            inventory.push(itemId);
            item.owned = true;
            
            // Показываем анимацию покупки
            showPurchaseAnimation(itemElement);
            
            // Сохраняем обновленные данные
            saveStats();
            updateStatsDisplay(true);
            updateShopDisplay();
            updateInventoryDisplay();
            
            messageEl.textContent = `Поздравляем! Вы купили "${item.name}"!`;
            messageEl.className = 'message success';
            
    // Показываем анимацию активации предмета
    setTimeout(() => {
        showItemActivationAnimation(item.name, item.icon);
    }, 500);
        }
        
        // Функции для инвентаря
        function updateInventoryDisplay() {
            inventoryListEl.innerHTML = '';

            if (inventory.length === 0) {
                inventoryListEl.innerHTML = `
                    <div class="inventory-item empty">
                        <div class="inventory-icon">📦</div>
                        <div class="inventory-name">Инвентарь пуст</div>
                        <div class="inventory-description">Купите улучшения в магазине</div>
                    </div>
                `;
                return;
            }

            inventory.forEach(itemId => {
                const item = shopItems.find(i => i.id === itemId);
                if (!item) return;

                const inventoryItemEl = document.createElement('div');
                inventoryItemEl.className = 'inventory-item';

                // Добавляем класс активности для предметов, которые могут быть активны
                if (itemId === 'bonus_difficulty' && bonusDifficultyActive) {
                    inventoryItemEl.classList.add('active');
                }

                inventoryItemEl.innerHTML = `
                    <div class="inventory-icon">${item.icon}</div>
                    <div class="inventory-name">${item.name}</div>
                    <div class="inventory-description">${item.description}</div>
                `;

                // Добавляем кнопку удаления
                const removeBtn = document.createElement('button');
                removeBtn.className = 'inventory-remove-btn';
                removeBtn.textContent = '🧺';
                removeBtn.onclick = (e) => {
                    e.stopPropagation();
                    showRemoveConfirm(itemId);
                };

                inventoryItemEl.appendChild(removeBtn);
                inventoryListEl.appendChild(inventoryItemEl);
            });
        }
        
        // Функции для бонусной сложности
        function activateBonusDifficulty() {
            if (bonusDifficultyActive || !inventory.includes('bonus_difficulty') || bonusDifficultyUses >= maxBonusDifficultyUses) return;
            
            // С вероятностью 50% активируем бонусную сложность
            if (Math.random() < 0.5) {
                bonusDifficultyActive = true;
                bonusDifficultyUses++;
                
                // Показываем анимацию активации
                showItemActivationAnimation('Бонусная Сложность', '⚡');
                
                bodyEl.classList.add('alarm-mode');
                alarmTimerEl.classList.add('active');
                bonusDifficultyTimeLeft = 5;
                alarmTimerCountEl.textContent = bonusDifficultyTimeLeft;
                
                // Обновляем текст для бонусной сложности
                document.querySelector('.alarm-timer .timer-text').textContent = 'БОНУСНАЯ СЛОЖНОСТЬ!';
                document.querySelectorAll('.alarm-timer .timer-text')[1].textContent = '+25% монеток если успеете!';
                
                // Обновляем инвентарь для отображения активности предмета
                updateInventoryDisplay();
                
                // Запускаем таймер
                bonusDifficultyTimer = setInterval(function() {
                    bonusDifficultyTimeLeft--;
                    alarmTimerCountEl.textContent = bonusDifficultyTimeLeft;
                    
                    if (bonusDifficultyTimeLeft <= 0) {
                        deactivateBonusDifficulty(false);
                        attempts += 5;
                        attemptsEl.textContent = `Попытки: ${attempts}`;
                        messageEl.textContent = 'Время вышло! +5 попыток!';
                        messageEl.className = 'message hint';
                    }
                }, 1000);
            }
        }
        
        function deactivateBonusDifficulty(success) {
            bonusDifficultyActive = false;
            bodyEl.classList.remove('alarm-mode');
            alarmTimerEl.classList.remove('active');
            clearInterval(bonusDifficultyTimer);
            
            // Обновляем инвентарь для снятия активности предмета
            updateInventoryDisplay();
            
            // Восстанавливаем стандартный текст для режима тревоги
            document.querySelector('.alarm-timer .timer-text').textContent = 'РЕЖИМ ТРЕВОГИ!';
            document.querySelectorAll('.alarm-timer .timer-text')[1].textContent = '+10 попыток через:';
            
            if (success) {
                // Начисляем бонусные монетки
                const bonusCoins = Math.floor(coins * 0.25);
                coins += bonusCoins;
                updateStatsDisplay(true);
                messageEl.textContent = `Отлично! Вы успели! +${bonusCoins} монеток!`;
                messageEl.className = 'message success';
            }
        }
        
        // Функция сброса прогресса
        function resetProgress() {
            // Сброс статистики
            gamesPlayed = 0;
            bestScore = null;
            worstScore = null;
            totalAttempts = 0;
            lastAttempts = 0;
            coins = 0;
            inventory = [];
            taxActive = false;
            taxGamesPlayed = 0;
            
            // Сброс состояния предметов магазина
            shopItems.forEach(item => {
                item.owned = false;
            });
            
            // Очистка localStorage
            localStorage.removeItem('project500_stats');
            
            // Обновление отображения статистики
            updateStatsDisplay();
            updateInventoryDisplay();
            updateTaxCounter();
            
            // Скрываем уведомление о налоге
            taxNotification.classList.remove('active');
            
            // Перезапуск игры
            initGame();
            
            // Закрытие окна подтверждения
            resetConfirmOverlay.classList.remove('active');
            
            // Показ сообщения о сбросе
            messageEl.textContent = 'ПРОГРЕСС СБРОШЕН!';
            messageEl.className = 'message hint';
        }
        
        // Показать окно подтверждения сброса
        function showResetConfirm() {
            resetConfirmOverlay.classList.add('active');
        }
        
        // Скрыть окно подтверждения сброса
        function hideResetConfirm() {
            resetConfirmOverlay.classList.remove('active');
        }
        
        // Функции для системы подсказок
        function showHint() {
            if (!gameActive || hintActive || taxActive) return;
            
            // Вычисляем подсказку - среднее между текущим минимумом и максимумом
            const hintNumber = Math.round((currentMin + currentMax) / 2);
            hintNumberEl.textContent = hintNumber;
            hintTimeLeft = 5;
            hintTimerEl.textContent = hintTimeLeft;
            
            // Активируем подсказку
            hintActive = true;
            hintOverlay.classList.add('active');
            hintPopup.classList.add('active');
            
            // Если активен режим паники или тревоги, добавляем соответствующий стиль
            if (panicModeActive) {
                hintPopup.classList.add('panic-mode');
            } else if (alarmModeActive || bonusDifficultyActive) {
                hintPopup.classList.add('alarm-mode');
            } else {
                hintPopup.classList.remove('panic-mode', 'alarm-mode');
            }
            
            // Запускаем таймер подсказки
            hintTimer = setInterval(function() {
                hintTimeLeft--;
                hintTimerEl.textContent = hintTimeLeft;
                
                if (hintTimeLeft <= 0) {
                    hideHint();
                }
            }, 1000);
        }
        
        function hideHint() {
            hintActive = false;
            hintOverlay.classList.remove('active');
            hintPopup.classList.remove('active');
            clearInterval(hintTimer);
        }
        
        // Функции для режима тревоги
        function activateAlarmMode() {
            // Проверка: Выключатель
            if (inventory.includes('switch')) {
                // С вероятностью 50% отключаем режим тревоги на всю игру
                if (Math.random() < 0.5) {
                    // Отключаем режим тревоги на эту игру
                    nextAlarmAttempt = 99999; // Очень большое число, чтобы тревога не активировалась
                    messageEl.textContent = 'ВЫКЛЮЧАТЕЛЬ СРАБОТАЛ! Режим тревоги отключен на эту игру!';
                    messageEl.className = 'message success';
                    return;
                }
            }
            
            if (alarmModeActive || (currentMax - currentMin) < 15 || bonusDifficultyActive || taxActive) return;
            
            alarmModeActive = true;
            bodyEl.classList.add('alarm-mode');
            alarmTimerEl.classList.add('active');
            alarmTimeLeft = 20;
            alarmTimerCountEl.textContent = alarmTimeLeft;
            
            // Если подсказка активна, обновляем ее стиль
            if (hintActive) {
                hintPopup.classList.add('alarm-mode');
            }
            
            // Запускаем таймер
            alarmTimer = setInterval(function() {
                alarmTimeLeft--;
                alarmTimerCountEl.textContent = alarmTimeLeft;
                
                if (alarmTimeLeft <= 0) {
                    deactivateAlarmMode();
                    attempts += 15;
                    attemptsEl.textContent = `Попытки: ${attempts}`;
                    messageEl.textContent = 'РЕЖИМ ТРЕВОГИ ЗАВЕРШЕН! +15 попыток!';
                    messageEl.className = 'message hint';
                    
                    // Устанавливаем следующую активацию через 2 попытки
                    nextAlarmAttempt = attempts + 2;
                }
            }, 1000);
        }
        
        function deactivateAlarmMode() {
            alarmModeActive = false;
            bodyEl.classList.remove('alarm-mode');
            alarmTimerEl.classList.remove('active');
            clearInterval(alarmTimer);
            
            // Если подсказка активна, убираем стиль тревоги
            if (hintActive) {
                hintPopup.classList.remove('alarm-mode');
            }
        }
        
        // Функции для режима паники
        function activatePanicMode() {
            if (panicModeActive || taxActive) return;
            
            panicModeActive = true;
            bodyEl.classList.add('panic-mode', 'shake-screen');
            panicTimerEl.classList.add('active');
            
            // Устанавливаем время паники в зависимости от наличия предмета "Успокаивающие"
            panicTimeLeft = inventory.includes('calming_pills') ? 15 : 10;
            timerCountEl.textContent = panicTimeLeft;
            
            // Если подсказка активна, обновляем ее стиль
            if (hintActive) {
                hintPopup.classList.add('panic-mode');
            }
            
            // Запускаем таймер
            panicTimer = setInterval(function() {
                panicTimeLeft--;
                timerCountEl.textContent = panicTimeLeft;
                
                if (panicTimeLeft <= 0) {
                    deactivatePanicMode();
                    attempts += 10;
                    attemptsEl.textContent = `Попытки: ${attempts}`;
                    messageEl.textContent = 'РЕЖИМ ПАНИКИ ЗАВЕРШЕН! +10 попыток!';
                    messageEl.className = 'message hint';
                }
            }, 1000);
        }
        
        function deactivatePanicMode() {
            panicModeActive = false;
            bodyEl.classList.remove('panic-mode', 'shake-screen');
            panicTimerEl.classList.remove('active');
            clearInterval(panicTimer);
            
            // Если подсказка активна, убираем стиль паники
            if (hintActive) {
                hintPopup.classList.remove('panic-mode');
            }
        }
        
        // Загрузка статистики из localStorage
        function loadStats() {
            const savedStats = localStorage.getItem('project500_stats');
            if (savedStats) {
                const stats = JSON.parse(savedStats);
                gamesPlayed = stats.gamesPlayed || 0;
                bestScore = stats.bestScore || null;
                worstScore = stats.worstScore || null;
                totalAttempts = stats.totalAttempts || 0;
                lastAttempts = stats.lastAttempts || 0;
                coins = stats.coins || 0;
                inventory = stats.inventory || [];
                taxActive = stats.taxActive || false;
                taxGamesPlayed = stats.taxGamesPlayed || 0;

                // Обновляем состояние предметов магазина
                shopItems.forEach(item => {
                    item.owned = inventory.includes(item.id);
                });

                // Если налог активен, активируем его
                if (taxActive) {
                    taxAmount = calculateTax();
                    activateTax();
                }
            }

            // Загрузка глобальной статистики
            loadGlobalStats();

            updateStatsDisplay();
            updateInventoryDisplay();
            updateTaxCounter();
        }
        
        // Загрузка глобальной статистики
        function loadGlobalStats() {
            const savedGlobalStats = localStorage.getItem('project500_global_stats');
            if (savedGlobalStats) {
                const globalStats = JSON.parse(savedGlobalStats);
                totalGamesEver = globalStats.totalGamesEver || 0;
                bestScoreEver = globalStats.bestScoreEver || null;
                worstScoreEver = globalStats.worstScoreEver || null;
                totalAttemptsEver = globalStats.totalAttemptsEver || 0;
            }
            updateGlobalStatsDisplay();
        }

        // Сохранение глобальной статистики
        function saveGlobalStats() {
            const globalStats = {
                totalGamesEver,
                bestScoreEver,
                worstScoreEver,
                totalAttemptsEver
            };
            localStorage.setItem('project500_global_stats', JSON.stringify(globalStats));
        }

        // Обновление глобальной статистики
        function updateGlobalStats() {
            totalGamesEver++;
            totalAttemptsEver += attempts;

            if (bestScoreEver === null || attempts < bestScoreEver) {
                bestScoreEver = attempts;
            }

            if (worstScoreEver === null || attempts > worstScoreEver) {
                worstScoreEver = attempts;
            }

            saveGlobalStats();
            updateGlobalStatsDisplay();
        }

        // Обновление отображения глобальной статистики
        function updateGlobalStatsDisplay() {
            const totalGamesEverEl = document.getElementById('totalGamesEver');
            const bestScoreEverEl = document.getElementById('bestScoreEver');
            const worstScoreEverEl = document.getElementById('worstScoreEver');
            const averageAttemptsEverEl = document.getElementById('averageAttemptsEver');

            if (totalGamesEverEl) totalGamesEverEl.textContent = totalGamesEver;

            if (bestScoreEver !== null) {
                if (bestScoreEverEl) bestScoreEverEl.textContent = bestScoreEver;
            } else {
                if (bestScoreEverEl) bestScoreEverEl.textContent = '-';
            }

            if (worstScoreEver !== null) {
                if (worstScoreEverEl) worstScoreEverEl.textContent = worstScoreEver;
            } else {
                if (worstScoreEverEl) worstScoreEverEl.textContent = '-';
            }

            if (totalGamesEver > 0) {
                const average = (totalAttemptsEver / totalGamesEver).toFixed(1);
                if (averageAttemptsEverEl) averageAttemptsEverEl.textContent = average;
            } else {
                if (averageAttemptsEverEl) averageAttemptsEverEl.textContent = '-';
            }
        }

        // Сохранение статистики в localStorage
        function saveStats() {
            const stats = {
                gamesPlayed,
                bestScore,
                worstScore,
                totalAttempts,
                lastAttempts,
                coins,
                inventory,
                taxActive,
                taxGamesPlayed
            };
            localStorage.setItem('project500_stats', JSON.stringify(stats));
        }
        
        // Функция для обновления отображения монеток с анимацией
        function updateCoinsDisplay(withAnimation = false) {
            if (withAnimation) {
                coinsEl.classList.add('coins-count-up');
                setTimeout(() => {
                    coinsEl.classList.remove('coins-count-up');
                }, 500);
            }
            
            coinsEl.textContent = coins;
            
            // Обновляем отображение монеток в магазине, если он открыт
            if (shopOverlay.classList.contains('active')) {
                shopCoinsDisplay.textContent = coins;
            }
        }
        
        // Обновление отображения статистики
        function updateStatsDisplay(withCoinAnimation = false) {
            gamesPlayedEl.textContent = gamesPlayed;
            
            if (bestScore !== null) {
                bestScoreEl.textContent = bestScore;
            } else {
                bestScoreEl.textContent = '-';
            }
            
            if (worstScore !== null) {
                worstScoreEl.textContent = worstScore;
            } else {
                worstScoreEl.textContent = '-';
            }
            
            // Обновляем отображение монеток с возможной анимацией
            updateCoinsDisplay(withCoinAnimation);
            
            if (gamesPlayed > 0) {
                const average = (totalAttempts / gamesPlayed).toFixed(1);
                averageAttemptsEl.textContent = average;
            } else {
                averageAttemptsEl.textContent = '-';
            }
            
            if (lastAttempts > 0) {
                lastAttemptsEl.textContent = lastAttempts;
            } else {
                lastAttemptsEl.textContent = '-';
            }
        }
        
        function calculateCoinsEarned() {
            // Базовое количество монеток пропорционально загаданному числу
            let baseCoins = Math.floor(targetNumber / 10);
            
            // Вычитаем 1 монетку за каждую попытку
            let coinsEarned = baseCoins - attempts;
            
            // Не позволяем уйти в отрицательное значение
            if (coinsEarned < 0) coinsEarned = 0;
            
            // Применяем бонусы за рекорд
            let bonusPercent = 0;
            if (bestScore <= 2) {
                bonusPercent = 40; // +40% за 2 и менее попыток
            } else if (bestScore <= 6) {
                bonusPercent = 20;  // +20% за 6 и менее попыток
            } else if (bestScore <= 8) {
                bonusPercent = 15;  // +15% за 8 и менее попыток
            }
            
            // Добавляем бонус за рекорд
            const bonusAmount = Math.floor(coinsEarned * bonusPercent / 100);
            coinsEarned += bonusAmount;
            
            // Бонус "Пятёрочка выручает"
            let fiveBonusAmount = 0;
            if (inventory.includes('five_bonus')) {
                // Проверяем, есть ли цифра 5 в загаданном числе
                const targetString = targetNumber.toString();
                if (targetString.includes('5')) {
                    fiveBonusAmount = Math.floor(coinsEarned * 0.35);
                    coinsEarned += fiveBonusAmount;
                }
            }
            
            // Бонус: Золотые Пятёрки
            let goldenFivesBonus = 0;
            if (inventory.includes('golden_fives')) {
                const fivesCount = countFivesInNumber(targetNumber);
                goldenFivesBonus = fivesCount * 10;
                coinsEarned += goldenFivesBonus;
            }
            
            // Бонус: Монетка (удвоение всех бонусов с вероятностью 1%)
            let luckyCoinMultiplier = 1;
            let luckyCoinActive = false;
            if (checkLuckyCoin()) {
                luckyCoinMultiplier = 2;
                luckyCoinActive = true;
                // Удваиваем только бонусные части, а не базовые монетки
                const basePart = baseCoins - attempts;
                const bonusPart = coinsEarned - basePart;
                coinsEarned = basePart + (bonusPart * 2);
            }
            
            // Предмет "Пятроица"
            let triadMultiplier = 1;
            let triadActive = false;
            if (inventory.includes('triad') && targetNumber === 555) {
                triadMultiplier = 5;
                triadActive = true;
                coinsEarned *= triadMultiplier;
            }
            
            return {
                base: baseCoins,
                penalty: attempts,
                bonus: bonusAmount,
                total: coinsEarned,
                bonusPercent: bonusPercent,
                fiveBonus: fiveBonusAmount,
                goldenFives: goldenFivesBonus,
                luckyCoin: luckyCoinActive,
                luckyCoinMultiplier: luckyCoinMultiplier,
                triad: triadActive,
                triadMultiplier: triadMultiplier
            };
        }
        
        // Обновление статистики после победы
        function updateStats() {
            gamesPlayed++;
            totalAttempts += attempts;
            lastAttempts = attempts;

            if (bestScore === null || attempts < bestScore) {
                bestScore = attempts;
            }

            if (worstScore === null || attempts > worstScore) {
                worstScore = attempts;
            }

            // Обновляем глобальную статистику
            updateGlobalStats();

            // Расчет заработанных монеток
            const coinsCalculation = calculateCoinsEarned();

            // Показываем анимацию зачисления монет
            showCoinsEarnedAnimation(coinsCalculation);

            coins += coinsCalculation.total;

            // Обновляем статистику с анимацией для монеток
            updateStatsDisplay(true);
            saveStats();

            // Проверяем, не настало ли время для налога
            checkTax();

            // Показываем сообщение о победе с информацией о монетках
            let messageHTML = `ПОЗДРАВЛЯЕМ! Вы угадали число ${targetNumber} за ${attempts} попыток!<br>Получено монеток: ${coinsCalculation.total} (базово: ${coinsCalculation.base} - штраф: ${coinsCalculation.penalty}`;

            if (coinsCalculation.bonusPercent > 0) {
                messageHTML += ` + бонус ${coinsCalculation.bonusPercent}%: ${coinsCalculation.bonus}`;
            }

            // Добавляем информацию о бонусе "Пятёрочка выручает"
            if (coinsCalculation.fiveBonus > 0) {
                messageHTML += ` + бонус "Пятёрочка": ${coinsCalculation.fiveBonus}`;
            }

            // Добавляем информацию о бонусе "Золотые Пятёрки"
            if (coinsCalculation.goldenFives > 0) {
                const fivesCount = countFivesInNumber(targetNumber);
                messageHTML += ` + Золотые Пятёрки (${fivesCount}×10): ${coinsCalculation.goldenFives}`;
            }

            // Добавляем информацию о срабатывании Монетки
            if (coinsCalculation.luckyCoin) {
                messageHTML += ` + УДВОЕНИЕ МОНЕТКОЙ!`;
            }

            messageHTML += `)`;

            messageEl.innerHTML = messageHTML;

            // Специальное сообщение если сработала Монетка
            if (coinsCalculation.luckyCoin) {
                setTimeout(() => {
                    messageEl.innerHTML += `<br><span style="color: #ff0; text-shadow: 0 0 10px #ff0;">✨ УДАЧА! МОНЕТКА УДВОИЛА ВАШИ БОНУСЫ! ✨</span>`;
                }, 1000);
            }
        }
        
        // Инициализация игры
        function initGame() {
            // Если активен налог, не начинаем новую игру
            if (taxActive) {
                messageEl.textContent = 'Сначала оплатите налог для продолжения игры!';
                messageEl.className = 'message hint';
                return;
            }
            
            currentMin = minRange;
            currentMax = maxRange;
            targetNumber = Math.floor(Math.random() * (maxRange - minRange + 1)) + minRange;
            attempts = 0;
            gameActive = true;
            guessHistory = [];
            
            // Сбрасываем режимы
            deactivatePanicMode();
            deactivateAlarmMode();
            deactivateBonusDifficulty(false);
            hideHint();
            
            // Сбрасываем счетчик использования бонусной сложности
            bonusDifficultyUses = 0;
            
            // Сбрасываем следующую активацию тревоги
            nextAlarmAttempt = 10;
            targetNumber = generateTargetNumber();
            
            // Обновление UI
            messageEl.textContent = '';
            messageEl.className = 'message';
            attemptsEl.textContent = 'Попытки: 0';
            historyListEl.innerHTML = '';
            guessInput.value = '';
            guessInput.disabled = false;
            guessBtn.disabled = false;
            guessInput.min = minRange;
            guessInput.max = maxRange;
            guessInput.placeholder = `Введите число от ${minRange} до ${maxRange}`;
            panicWarningEl.style.display = 'none';
            alarmWarningEl.style.display = 'none';
            
            // Убираем эффект свечения диапазона
            rangeVisualizationEl.classList.remove('narrow-range');
            
            // Обновление визуализации диапазона
            updateRangeVisualization();
            
            // Фокус на поле ввода
            guessInput.focus();
            
            console.log('Загаданное число: ' + targetNumber); // Для отладки
        }
        
        // Обновление визуализации диапазона
        function updateRangeVisualization() {
            // Очистка предыдущих маркеров
            const markers = document.querySelectorAll('.range-marker');
            markers.forEach(marker => marker.remove());
            
            // Обновление текущего диапазона
            const rangeWidth = ((currentMax - currentMin) / (maxRange - minRange)) * 100;
            const rangeLeft = ((currentMin - minRange) / (maxRange - minRange)) * 100;
            
            rangeCurrentEl.style.width = rangeWidth + '%';
            rangeCurrentEl.style.left = rangeLeft + '%';
            
            // Обновление статистики
            minValueEl.textContent = currentMin;
            maxValueEl.textContent = currentMax;
            currentRangeEl.textContent = `${currentMin}-${currentMax}`;
            
            // Проверка на узкий диапазон для эффекта свечения
            const rangeDiff = currentMax - currentMin;
            if (rangeDiff <= 50) {
                rangeVisualizationEl.classList.add('narrow-range');
            } else {
                rangeVisualizationEl.classList.remove('narrow-range');
            }
            
            // Проверка на активацию режима паники
            if (rangeDiff <= 10 && gameActive && !panicModeActive && !taxActive) {
                activatePanicMode();
            }
            
            // Показ предупреждения о приближающемся режиме паники
            if (rangeDiff <= 20 && rangeDiff > 10 && gameActive && !panicModeActive && !taxActive) {
                panicWarningEl.style.display = 'block';
            } else {
                panicWarningEl.style.display = 'none';
            }
            
            // Показ предупреждения о приближающемся режиме тревоги
            if (attempts >= 8 && attempts < nextAlarmAttempt && gameActive && !alarmModeActive && rangeDiff >= 10 && !taxActive) {
                alarmWarningEl.style.display = 'block';
                alarmAttemptsLeftEl.textContent = nextAlarmAttempt - attempts;
            } else {
                alarmWarningEl.style.display = 'none';
            }
            
            // Добавление маркеров для каждой попытки
            guessHistory.forEach(attempt => {
                const marker = document.createElement('div');
                marker.className = 'range-marker';
                
                // Позиционирование маркера
                const markerPosition = ((attempt.guess - minRange) / (maxRange - minRange)) * 100;
                marker.style.left = markerPosition + '%';
                
                // Определение типа маркера
                if (attempt.result === 'correct') {
                    marker.classList.add('correct');
                } else if (attempt.result === 'higher') {
                    marker.classList.add('higher');
                } else {
                    marker.classList.add('lower');
                }
                
                // Добавление подписи
                const label = document.createElement('div');
                label.className = 'marker-label';
                label.textContent = attempt.guess;
                marker.appendChild(label);
                
                rangeScaleEl.appendChild(marker);
            });
        }
        
        // Обновление истории
        function updateHistory() {
            historyListEl.innerHTML = '';
            
            if (guessHistory.length === 0) {
                historyListEl.innerHTML = '<div class="history-item">История пуста</div>';
                return;
            }
            
            // Показываем историю в обратном порядке (последние попытки сверху)
            guessHistory.slice().reverse().forEach(item => {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                
                let resultText = '';
                if (item.result === 'correct') {
                    resultText = '✓ УГАДАЛ';
                } else if (item.result === 'higher') {
                    resultText = '↑ БОЛЬШЕ';
                } else {
                    resultText = '↓ МЕНЬШЕ';
                }
                
                historyItem.textContent = `Попытка ${item.attempt}: ${item.guess} - ${resultText}`;
                historyListEl.appendChild(historyItem);
            });
        }
        
        // Обработка попытки угадать
        function makeGuess() {
            if (!gameActive || taxActive) return;
            
            // Если активно окно подсказки, скрываем его
            if (hintActive) {
                hideHint();
            }
            
            // Если активна бонусная сложность, деактивируем ее с успехом
            if (bonusDifficultyActive) {
                deactivateBonusDifficulty(true);
            }
            
            // Отключаем режим тревоги при вводе числа
            if (alarmModeActive) {
                deactivateAlarmMode();
                // Устанавливаем следующую активацию через 2 попытки
                nextAlarmAttempt = attempts + 2;
            }
            
            const userGuess = parseInt(guessInput.value);
            
            // Проверка ввода
            if (isNaN(userGuess) || userGuess < minRange || userGuess > maxRange) {
                messageEl.textContent = `Пожалуйста, введите число от ${minRange} до ${maxRange}!`;
                messageEl.className = 'message hint error-animation';
                return;
            }
            
            attempts++;
            attemptsEl.textContent = `Попытки: ${attempts}`;
            
            // Проверяем, нужно ли активировать режим тревоги
            if (attempts === nextAlarmAttempt && (currentMax - currentMin) >= 10 && !taxActive) {
                activateAlarmMode();
            }
            
            // Проверяем, нужно ли показать подсказку (каждые 5 попыток)
            if (attempts % 5 === 0 && attempts > 0 && !taxActive) {
                // Показываем подсказку через небольшую задержку
                setTimeout(showHint, 500);
            }
            
            // Проверяем, нужно ли активировать бонусную сложность
            if (inventory.includes('bonus_difficulty') && bonusDifficultyUses < maxBonusDifficultyUses && !taxActive) {
                activateBonusDifficulty();
            }
            
            // Записываем попытку в историю
            let result;
            if (userGuess === targetNumber) {
                result = 'correct';
                gameActive = false;
                guessInput.disabled = true;
                guessBtn.disabled = true;
                
                // Деактивируем режимы при победе
                deactivatePanicMode();
                deactivateAlarmMode();
                deactivateBonusDifficulty(false);
                hideHint();
                
                // Обновляем статистику
                updateStats();
                
                messageEl.className = 'message success success-animation';
            } else if (userGuess < targetNumber) {
                result = 'higher';
                messageEl.textContent = 'Загаданное число БОЛЬШЕ!';
                messageEl.className = 'message hint';
                // Обновляем минимальное значение диапазона
                if (userGuess > currentMin) {
                    currentMin = userGuess + 1;
                }
            } else {
                result = 'lower';
                messageEl.textContent = 'Загаданное число МЕНЬШЕ!';
                messageEl.className = 'message hint';
                // Обновляем максимальное значение диапазона
                if (userGuess < currentMax) {
                    currentMax = userGuess - 1;
                }
            }
            
            // Добавляем попытку в историю
            guessHistory.push({
                attempt: attempts,
                guess: userGuess,
                result: result
            });
            
            // Обновляем отображение истории и диапазона
            updateHistory();
            updateRangeVisualization();
            
            guessInput.value = '';
            guessInput.focus();
        }
        
        // Обработчики событий
        guessBtn.addEventListener('click', makeGuess);
        
        newGameBtn.addEventListener('click', initGame);
        
        guessInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                makeGuess();
            }
        });
        
        // Закрытие подсказки при клике на оверлей
        hintOverlay.addEventListener('click', hideHint);
        
        // Обработчики для сброса прогресса
        resetProgressBtn.addEventListener('click', showResetConfirm);
        cancelResetBtn.addEventListener('click', hideResetConfirm);
        confirmResetBtn.addEventListener('click', resetProgress);
        
        // Закрытие окна подтверждения при клике на оверлей
        resetConfirmOverlay.addEventListener('click', function(e) {
            if (e.target === resetConfirmOverlay) {
                hideResetConfirm();
            }
        });
        
        // Обработчики событий для магазина
        shopBtn.addEventListener('click', openShop);
        shopCloseBtn.addEventListener('click', closeShop);
        
        // Закрытие магазина при клике на оверлей
        shopOverlay.addEventListener('click', function(e) {
            if (e.target === shopOverlay) {
                closeShop();
            }
        });

                // Обработчики для удаления предметов
        confirmRemoveBtn.addEventListener('click', confirmRemoveItem);
        cancelRemoveBtn.addEventListener('click', cancelRemoveItem);

        // Закрытие окна подтверждения удаления при клике на оверлей
        removeConfirmOverlay.addEventListener('click', function(e) {
            if (e.target === removeConfirmOverlay) {
                cancelRemoveItem();
            }
        });
        
        // Обработчик для оплаты налога
        payTaxBtn.addEventListener('click', payTax);
        
        // Система команд консоли
        window.Project500 = function(command) {
            if (!command) {
                console.log('Список команд Project 500:');
                console.log('give money <число> - добавить монетки');
                console.log('remove money <число> - убрать монетки');
                console.log('give item <item_id> - добавить предмет');
                console.log('remove item <item_id> - убрать предмет');
                console.log('animate <тип> - запустить анимацию (win, lose, panic, alarm, coins)');
                console.log('panic - активировать режим паники');
                console.log('alarm - активировать режим тревоги');
                console.log('hint - показать подсказку');
                console.log('stats - показать статистику');
                console.log('reset - сбросить игру');
                return;
            }

            const parts = command.toLowerCase().split(' ');
            const action = parts[0];
            const target = parts[1];
            const value = parts[2];

            try {
                switch (action) {
                    case 'give':
                        if (target === 'money') {
                            const amount = parseInt(value);
                            if (!isNaN(amount)) {
                                coins += amount;
                                console.log(`Добавлено ${amount} монеток. Всего: ${coins}`);
                                updateStatsDisplay(true);
                                saveStats();
                                showCoinsEarnedAnimation({
                                    total: amount,
                                    base: amount,
                                    penalty: 0,
                                    bonus: 0,
                                    bonusPercent: 0,
                                    fiveBonus: 0,
                                    goldenFives: 0,
                                    luckyCoin: false
                                });
                            } else {
                                console.log('Неверное количество монеток');
                            }
                        } else if (target === 'item') {
                            if (value && shopItems.find(item => item.id === value)) {
                                if (!inventory.includes(value)) {
                                    inventory.push(value);
                                    shopItems.find(item => item.id === value).owned = true;
                                    console.log(`Предмет "${shopItems.find(item => item.id === value).name}" добавлен в инвентарь`);
                                    updateInventoryDisplay();
                                    saveStats();
                                    showItemActivationAnimation(shopItems.find(item => item.id === value).name, shopItems.find(item => item.id === value).icon);
                                } else {
                                    console.log('Предмет уже есть в инвентаре');
                                }
                            } else {
                                console.log('Неверный ID предмета');
                            }
                        }
                        break;

                    case 'remove':
                        if (target === 'money') {
                            const amount = parseInt(value);
                            if (!isNaN(amount)) {
                                if (coins >= amount) {
                                    coins -= amount;
                                    console.log(`Убрано ${amount} монеток. Осталось: ${coins}`);
                                    updateStatsDisplay(true);
                                    saveStats();
                                } else {
                                    console.log('Недостаточно монеток');
                                }
                            } else {
                                console.log('Неверное количество монеток');
                            }
                        } else if (target === 'item') {
                            if (value && inventory.includes(value)) {
                                inventory = inventory.filter(id => id !== value);
                                shopItems.find(item => item.id === value).owned = false;
                                console.log(`Предмет "${shopItems.find(item => item.id === value).name}" удален из инвентаря`);
                                updateInventoryDisplay();
                                saveStats();
                            } else {
                                console.log('Предмет не найден в инвентаре');
                            }
                        }
                        break;

                    case 'animate':
                        if (target === 'win') {
                            messageEl.textContent = 'ПОЗДРАВЛЯЕМ! Вы угадали число!';
                            messageEl.className = 'message success';
                            setTimeout(() => {
                                messageEl.textContent = '';
                                messageEl.className = 'message';
                            }, 3000);
                            console.log('Активирована анимация победы');
                        } else if (target === 'lose') {
                            messageEl.textContent = 'ИГРА ЗАКОНЧЕНА!';
                            messageEl.className = 'message hint';
                            setTimeout(() => {
                                messageEl.textContent = '';
                                messageEl.className = 'message';
                            }, 3000);
                            console.log('Активирована анимация поражения');
                        } else if (target === 'panic') {
                            bodyEl.classList.add('panic-mode', 'shake-screen');
                            setTimeout(() => {
                                bodyEl.classList.remove('panic-mode', 'shake-screen');
                            }, 3000);
                            console.log('Активирована анимация паники');
                        } else if (target === 'alarm') {
                            bodyEl.classList.add('alarm-mode');
                            setTimeout(() => {
                                bodyEl.classList.remove('alarm-mode');
                            }, 3000);
                            console.log('Активирована анимация тревоги');
                        } else if (target === 'coins') {
                            showCoinsEarnedAnimation({
                                total: 100,
                                base: 100,
                                penalty: 0,
                                bonus: 0,
                                bonusPercent: 0,
                                fiveBonus: 0,
                                goldenFives: 0,
                                luckyCoin: false
                            });
                            console.log('Активирована анимация монеток');
                        } else {
                            console.log('Неверный тип анимации. Доступные: win, lose, panic, alarm, coins');
                        }
                        break;

                    case 'panic':
                        if (gameActive && !panicModeActive && !taxActive) {
                            activatePanicMode();
                            console.log('Режим паники активирован');
                        } else {
                            console.log('Невозможно активировать режим паники');
                        }
                        break;

                    case 'alarm':
                        if (gameActive && !alarmModeActive && !bonusDifficultyActive && !taxActive) {
                            activateAlarmMode();
                            console.log('Режим тревоги активирован');
                        } else {
                            console.log('Невозможно активировать режим тревоги');
                        }
                        break;

                    case 'hint':
                        if (gameActive) {
                            showHint();
                            console.log('Подсказка показана');
                        } else {
                            console.log('Игра не активна');
                        }
                        break;

                    case 'stats':
                        console.log('Текущая статистика:');
                        console.log(`Игры сыграно: ${gamesPlayed}`);
                        console.log(`Рекорд: ${bestScore || 'Нет'}`);
                        console.log(`Анти-рекорд: ${worstScore || 'Нет'}`);
                        console.log(`Среднее: ${(gamesPlayed > 0 ? (totalAttempts / gamesPlayed).toFixed(1) : 0)}`);
                        console.log(`Последняя игра: ${lastAttempts || 'Нет'}`);
                        console.log(`Монетки: ${coins}`);
                        console.log(`Предметы: ${inventory.join(', ') || 'Нет'}`);
                        break;

                    case 'reset':
                        if (confirm('Вы уверены, что хотите сбросить текущую игру?')) {
                            initGame();
                            console.log('Игра сброшена');
                        }
                        break;

                    default:
                        console.log('Неизвестная команда. Используйте Project500() без параметров для списка команд.');
                }
            } catch (error) {
                console.log('Произошла ошибка при выполнении команды:', error.message);
            }
        };



        /* ===========================================
           ЭФФЕКТ ПЕПЛА
           =========================================== */

        // Переменные для эффекта пепла
        const ashCanvas = document.getElementById('ashCanvas');
        const ashCtx = ashCanvas.getContext('2d');

        // Настройка Canvas на полный экран
        function resizeAshCanvas() {
            ashCanvas.width = window.innerWidth;
            ashCanvas.height = window.innerHeight;
        }
        resizeAshCanvas();
        window.addEventListener('resize', resizeAshCanvas);

        // Класс частицы пепла
        class AshParticle {
            constructor() {
                this.reset();
            }

            reset() {
                this.x = Math.random() * ashCanvas.width;
                this.y = ashCanvas.height + Math.random() * 50; // Начало ниже экрана
                this.dy = -(Math.random() * 0.5 + 0.2); // Вверх, скорость 0.2-0.7
                this.dx = (Math.random() - 0.5) * 0.2; // Небольшое боковое движение
                this.size = Math.random() * 2 + 1; // Размер 1-3 пикселя
                this.alpha = Math.random() * 0.5 + 0.3; // Прозрачность 0.3-0.8
                this.color = this.getRandomAshColor();
            }

            getRandomAshColor() {
                const colors = [
                    'rgba(69, 69, 69, ',     // Темно-серый
                    'rgba(105, 105, 105, ',  // Серый
                    'rgba(128, 128, 128, ',  // Светло-серый
                    'rgba(169, 169, 169, ',  // Темно-серый
                    'rgba(211, 211, 211, '   // Светло-серый
                ];
                return colors[Math.floor(Math.random() * colors.length)];
            }

            update() {
                this.y += this.dy;
                this.x += this.dx;

                // Добавляем легкую синусоидальную анимацию для более естественного движения
                this.x += Math.sin(this.y * 0.01) * 0.1;

                // Если частица вышла за верхнюю границу, пересоздаем её внизу
                if (this.y < -this.size) {
                    this.reset();
                }
            }

            draw() {
                ashCtx.globalAlpha = this.alpha;
                ashCtx.fillStyle = this.color + this.alpha + ')';
                ashCtx.fillRect(this.x - this.size / 2, this.y - this.size / 2, this.size, this.size);
            }
        }

        // Массив частиц пепла
        const ashParticles = [];
        const particleCount = 150; // Количество частиц (увеличено для заметности)

        // Инициализация частиц
        function initAshParticles() {
            ashParticles.length = 0;
            for (let i = 0; i < particleCount; i++) {
                ashParticles.push(new AshParticle());
            }
        }

        // Анимация пепла
        function animateAsh() {
            ashCtx.clearRect(0, 0, ashCanvas.width, ashCanvas.height);

            ashParticles.forEach(particle => {
                particle.update();
                particle.draw();
            });

            requestAnimationFrame(animateAsh);
        }

        // Начало игры при загрузке страницы
        window.onload = function() {
            loadStats();
            initGame();
            initAshParticles();
            animateAsh();
        };
    </script>
</body>
</html>
